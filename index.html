<!-- Version 02052020
Website: koreanreader.com
Copyright ¬© 2020 Rohan Scott
This source file is free software, available under the following license:
MIT license - https://mit-license.org/
This software uses the following plugins:
	jQuery						JS Foundation & other contributors	jquery.org												MIT license
	mark.js						Julian K√ºhnel						https://markjs.io/										MIT license
	IndexedDB-getAll-shim.js	dumbmatter							https://www.npmjs.com/package/indexeddb-getall-shim		MIT license
	aromanize.js				Fajar Chandra						https://github.com/fujaru/aromanize-js					MIT license
	chart.js					Chart.js Contributors				https://www.chartjs.org									MIT license
	datatables					SpryMedia Ltd						http://www.datatables.net								MIT license				
	javascript-css-font-detect	Lalit Patel							http://www.lalit.org/lab/javascript-css-font-detect/	Apache Software License 2.0
-->
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<link rel="apple-touch-icon" sizes="57x57" href="icons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="icons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="icons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="icons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="icons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="icons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="icons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="icons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="icons/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="icons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="icons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
<link rel="manifest" href="icons/manifest.json">
<meta name="msapplication-TileColor" content="#0066CC">
<meta name="msapplication-TileImage" content="icons/ms-icon-144x144.png">
<meta name="theme-color" content="#0066CC">

	<link rel="stylesheet" type="text/css" href="style.css">
	<link rel="stylesheet" type="text/css" href="DataTables-1.10.20/datatables.min.css">
	<link href="fonts/Song+Myung.css" type="text/css" rel="stylesheet">
	<link href="fonts/Gamja+Flower.css" type="text/css" rel="stylesheet">
	<link href="fonts/Hi+Melody.css"  type="text/css" rel="stylesheet">
	<link href="fonts/Nanum+Pen+Script.css" type="text/css" rel="stylesheet">
	<link href="fonts/Sunflower.css" type="text/css" rel="stylesheet">
	<link href="fonts/Nanum+Myeongjo.css" type="text/css" rel="stylesheet">
	<link href="fonts/Cute+Font.css" type="text/css" rel="stylesheet">
	<link href="fonts/Poor+Story.css" type="text/css" rel="stylesheet">
	<link href="fonts/Yeon+Sung.css" type="text/css" rel="stylesheet">
	<link href="fonts/Stylish.css" type="text/css" rel="stylesheet">
	<link href="fonts/Gothic+A1.css" type="text/css" rel="stylesheet">
	<meta charset="UTF-8">
	<meta name="description" content="home">
	<meta name="author" content="Rohan Scott">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="mark/mark.min.js" charset="UTF-8"></script>
	<script src="jQuery-3.3.1/jquery-3.3.1.min.js"></script>
	<script src="DataTables-1.10.20/js/jquery.dataTables.min.js"></script>
	<script src="IndexedDB-getAll-shim/IndexedDB-getAll-shim.js"></script>
	<script src="Chart/Chart.bundle.min.js"></script>
	<script src="Chart/Chart.min.js"></script>
	<script src="Select-1.3.1/js/dataTables.select.min.js"></script>
	<script type="text/javascript" src="wordlists/stopik1.js"></script>
	<script type="text/javascript" src="wordlists/stopik2.js"></script>
	<script type="text/javascript" src="wordlists/stopik3.js"></script>
	<script type="text/javascript" src="wordlists/topikI.js"></script>
	<script type="text/javascript" src="wordlists/topikII.js"></script>
	<script type="text/javascript" src="aromanize/aromanize.js"></script>
	
	
	
	<script type="text/javascript">
		var all_marked;
		var db;
		var enableHighlighting;
		var replaceCharacters;
		var lookingUp;
		var knownArray = [];
		var unknownArray= [];
		var learningArray= [];
		var allArray= [];
		var jumpMarked;
		var jumpAttempts;
		var compareLoopTimeout=[];
		var colourTimeout;
		var scrollTimeout;
		var vocabularyTimeout;
		var displaySortTimeout;
		var displayComparisonTimeout;
		var statisticsTimeout;
		var highlightTimeout;
		var unmarkJumpTimeout;
		var calculateStatisticsTimeout;
		var openedTab="";
		var limiters;
		var limitersHangeul; 
		const fontSizeDefault = 3;
		var fontSize;
		var romanisationMode;
		var regExp;
		var replaceCharactersHangeul;
		var convertedHTML;
		var colourPrimary;
		var colourSecondary;
		var colourTertiary;
		var colourJump;
		const colourPrimaryDefault= "#F5A9E1";
		const colourSecondaryDefault= "#FFFF66";
		const colourTertiaryDefault= "#99FF00";
		const colourJumpDefault = "#00ffff";
		var enableVoice;
		var voicePitch;
		var voiceVolume;
		var voiceSpeed;
		var selectedVocabulary;
		var selectedIndex=-1;
		var selectedWord="";
		var myChart;
		var global_total_words;
		var timeCalculateStatisticsBegin;
		var timeCalculateStatisticsEnd;
		var initialisationComplete = false;
		var unknownWordsTabUpToDate = false;
		var learningWordsTabUpToDate = false;
		var knownWordsTabUpToDate = false;
		var allWordsTabUpToDate = false;
		var lastUsedStatsTab;
		var browser ="unknown";
		var pendingLookup;
		var imagesLookingUp;
		var dictionaryLookingUp;
		const printJSON = false;
		var dictionaryLanguage;
		const dictionaryLanguageDefault="English";
		var sidebarVisible;
		var menuVisible;
		var compareLoop;
		var startingMarkDefault;
		var startingMark;
		
		const sort_by = (field, reverse, primer) => {

		  const key = primer ?
			function(x) {
			  return primer(x[field])
			} :
			function(x) {
			  return x[field]
			};

		  reverse = !reverse ? 1 : -1;

		  return function(a, b) {
			return a = key(a), b = key(b), reverse * ((a > b) - (b > a));
		  }
		}
		
		
		
		function BrowserCheck() //allow all browsers for testing purposes 
		{
			browser = IsFirefoxOrChrome();
			if(browser=="unknown")
			{
				if (document.documentMode || /Edge/.test(navigator.userAgent)) {
				   browser="edge";
				}
			}
			console.log("Detected browser: "+browser);
			init(); 
		}
		
		function IsFirefoxOrChrome()
		{
			var isFirefox = typeof InstallTrigger !== 'undefined';
			var isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
			if(isFirefox)
			{
				return "firefox";
			}
			else if(isChrome)
			{
				return "chrome";
			}
			else
			{
				return "unknown";
			}
		}
		
		function init()
		{
			var pasteArea = document.getElementById ("pasteArea");
			pasteArea.contentEditable = false;
			jumpMarked = false;
			romanisationMode = 0;
			voicePitch = 1;
			voiceVolume = 1;
			enableVoice=false;
			voiceSpeed = 1;
			fontSize = 6;
			lookingUp="";
			convertedHTML="";
			all_marked = false;
			colourPrimary = colourPrimaryDefault;
			colourSecondary = colourSecondaryDefault;
			colourTertiary = colourTertiaryDefault;
			colourJump = colourJumpDefault;
			selectedVocabulary=[];
			global_total_words = 0;
			calculateStatisticsTimeout = 50;
			lastUsedStatsTab = "UnknownWordsTab";
			pendingLookup = "";
			imagesLookingUp="";
			dictionaryLookingUp="";
			dictionaryLanguage = "English";
			sidebarVisible = true;
			menuVisible=false;
			compareLoop=false;
			startingMarkDefault=0;
			startingMark = startingMarkDefault;
			
			enableHighlighting = true; 
			replaceCharactersHangeul = /[\0-\‚îÇ\:\‚Ä¶\ÔºΩ\<\>\,\'\+\~\s+\d\/\‚Äù\]\Ôºç\_\‚óÜ\|\„Ö°\r\n|\n|\r\„Äë\‚ñ†\„Äê\„Äé\„Äè\‚Äï\‚ô°\‚îÄ\¬Æ\‚ô™\„Äà\‚ñ≥\‚ô•\‚ñ∂\‚ñº\‚óÄ\&\„Äâ\(\)\„Äå\„Äî\{\}\„â°\*\„â¢\1\2\3\4\5\6\7\8\9\0\„â£\=\„éè\¬∑\„Äç\%\„Äã\[\„Äï\~\‚àº\„Ää\ÔΩû\‚Äú\‚ù∑\‚ù∂\‚ù∏\‚ùπ\‚óè\„éû\‚óã\„â†\#\$\?\.\‚Äò\‚Äô\üíõ\x1F\x7F-\x9F\xAD\u0378\ufeff\u0379\u037F-\u0383\u038B\u038D\u03A2\u0528-\u0530\u0557\u0558\u0560\u0588\u058B-\u058E\u0590\u05C8-\u05CF\u05EB-\u05EF\u05F5-\u0605\u061C\u061D\u06DD\u070E\u070F\u074B\u074C\u07B2-\u07BF\u07FB-\u07FF\u082E\u082F\u083F\u085C\u085D\u085F-\u089F\u08A1\u08AD-\u08E3\u08FF\u0978\u0980\u0984\u098D\u098E\u0991\u0992\u09A9\u09B1\u09B3-\u09B5\u09BA\u09BB\u09C5\u09C6\u09C9\u09CA\u09CF-\u09D6\u09D8-\u09DB\u09DE\u09E4\u09E5\u09FC-\u0A00\u0A04\u0A0B-\u0A0E\u0A11\u0A12\u0A29\u0A31\u0A34\u0A37\u0A3A\u0A3B\u0A3D\u0A43-\u0A46\u0A49\u0A4A\u0A4E-\u0A50\u0A52-\u0A58\u0A5D\u0A5F-\u0A65\u0A76-\u0A80\u0A84\u0A8E\u0A92\u0AA9\u0AB1\u0AB4\u0ABA\u0ABB\u0AC6\u0ACA\u0ACE\u0ACF\u0AD1-\u0ADF\u0AE4\u0AE5\u0AF2-\u0B00\u0B04\u0B0D\u0B0E\u0B11\u0B12\u0B29\u0B31\u0B34\u0B3A\u0B3B\u0B45\u0B46\u0B49\u0B4A\u0B4E-\u0B55\u0B58-\u0B5B\u0B5E\u0B64\u0B65\u0B78-\u0B81\u0B84\u0B8B-\u0B8D\u0B91\u0B96-\u0B98\u0B9B\u0B9D\u0BA0-\u0BA2\u0BA5-\u0BA7\u0BAB-\u0BAD\u0BBA-\u0BBD\u0BC3-\u0BC5\u0BC9\u0BCE\u0BCF\u0BD1-\u0BD6\u0BD8-\u0BE5\u0BFB-\u0C00\u0C04\u0C0D\u0C11\u0C29\u0C34\u0C3A-\u0C3C\u0C45\u0C49\u0C4E-\u0C54\u0C57\u0C5A-\u0C5F\u0C64\u0C65\u0C70-\u0C77\u0C80\u0C81\u0C84\u0C8D\u0C91\u0CA9\u0CB4\u0CBA\u0CBB\u0CC5\u0CC9\u0CCE-\u0CD4\u0CD7-\u0CDD\u0CDF\u0CE4\u0CE5\u0CF0\u0CF3-\u0D01\u0D04\u0D0D\u0D11\u0D3B\u0D3C\u0D45\u0D49\u0D4F-\u0D56\u0D58-\u0D5F\u0D64\u0D65\u0D76-\u0D78\u0D80\u0D81\u0D84\u0D97-\u0D99\u0DB2\u0DBC\u0DBE\u0DBF\u0DC7-\u0DC9\u0DCB-\u0DCE\u0DD5\u0DD7\u0DE0-\u0DF1\u0DF5-\u0E00\u0E3B-\u0E3E\u0E5C-\u0E80\u0E83\u0E85\u0E86\u0E89\u0E8B\u0E8C\u0E8E-\u0E93\u0E98\u0EA0\u0EA4\u0EA6\u0EA8\u0EA9\u0EAC\u0EBA\u0EBE\u0EBF\u0EC5\u0EC7\u0ECE\u0ECF\u0EDA\u0EDB\u0EE0-\u0EFF\u0F48\u0F6D-\u0F70\u0F98\u0FBD\u0FCD\u0FDB-\u0FFF\u10C6\u10C8-\u10CC\u10CE\u10CF\u1249\u124E\u124F\u1257\u1259\u125E\u125F\u1289\u128E\u128F\u12B1\u12B6\u12B7\u12BF\u12C1\u12C6\u12C7\u12D7\u1311\u1316\u1317\u135B\u135C\u137D-\u137F\u139A-\u139F\u13F5-\u13FF\u169D-\u169F\u16F1-\u16FF\u170D\u1715-\u171F\u1737-\u173F\u1754-\u175F\u176D\u1771\u1774-\u177F\u17DE\u17DF\u17EA-\u17EF\u17FA-\u17FF\u180F\u181A-\u181F\u1878-\u187F\u18AB-\u18AF\u18F6-\u18FF\u191D-\u191F\u192C-\u192F\u193C-\u193F\u1941-\u1943\u196E\u196F\u1975-\u197F\u19AC-\u19AF\u19CA-\u19CF\u19DB-\u19DD\u1A1C\u1A1D\u1A5F\u1A7D\u1A7E\u1A8A-\u1A8F\u1A9A-\u1A9F\u1AAE-\u1AFF\u1B4C-\u1B4F\u1B7D-\u1B7F\u1BF4-\u1BFB\u1C38-\u1C3A\u1C4A-\u1C4C\u1C80-\u1CBF\u1CC8-\u1CCF\u1CF7-\u1CFF\u1DE7-\u1DFB\u1F16\u1F17\u1F1E\u1F1F\u1F46\u1F47\u1F4E\u1F4F\u1F58\u1F5A\u1F5C\u1F5E\u1F7E\u1F7F\u1FB5\u1FC5\u1FD4\u1FD5\u1FDC\u1FF0\u1FF1\u1FF5\u1FFF\u200B-\u200F\u202A-\u202E\u2060-\u206F\u2072\u2073\u208F\u209D-\u209F\u20BB-\u20CF\u20F1-\u20FF\u218A-\u218F\u23F4-\u23FF\u2427-\u243F\u244B-\u245F\u2700\u2B4D-\u2B4F\u2B5A-\u2BFF\u2C2F\u2C5F\u2CF4-\u2CF8\u2D26\u2D28-\u2D2C\u2D2E\u2D2F\u2D68-\u2D6E\u2D71-\u2D7E\u2D97-\u2D9F\u2DA7\u2DAF\u2DB7\u2DBF\u2DC7\u2DCF\u2DD7\u2DDF\u2E3C-\u2E7F\u2E9A\u2EF4-\u2EFF\u2FD6-\u2FEF\u2FFC-\u2FFF\u3040\u3097\u3098\u3100-\u3104\u312E-\u3130\u318F\u31BB-\u31BF\u31E4-\u31EF\u321F\u32FF\u4DB6-\u4DBF\u9FCD-\u9FFF\uA48D-\uA48F\uA4C7-\uA4CF\uA62C-\uA63F\uA698-\uA69E\uA6F8-\uA6FF\uA78F\uA794-\uA79F\uA7AB-\uA7F7\uA82C-\uA82F\uA83A-\uA83F\uA878-\uA87F\uA8C5-\uA8CD\uA8DA-\uA8DF\uA8FC-\uA8FF\uA954-\uA95E\uA97D-\uA97F\uA9CE\uA9DA-\uA9DD\uA9E0-\uA9FF\uAA37-\uAA3F\uAA4E\uAA4F\uAA5A\uAA5B\uAA7C-\uAA7F\uAAC3-\uAADA\uAAF7-\uAB00\uAB07\uAB08\uAB0F\uAB10\uAB17-\uAB1F\uAB27\uAB2F-\uABBF\uABEE\uABEF\uABFA-\uABFF\uD7A4-\uD7AF\uD7C7-\uD7CA\uD7FC-\uF8FF\uFA6E\uFA6F\uFADA-\uFAFF\uFB07-\uFB12\uFB18-\uFB1C\uFB37\uFB3D\uFB3F\uFB42\uFB45\uFBC2-\uFBD2\uFD40-\uFD4F\uFD90\uFD91\uFDC8-\uFDEF\uFDFE\uFDFF\uFE1A-\uFE1F\uFE27-\uFE2F\uFE53\uFE67\uFE6C-\uFE6F\uFE75\uFEFD-\uFF00\uFFBF-\uFFC1\uFFC8\uFFC9\uFFD0\uFFD1\uFFD8\uFFD9\uFFDD-\uFFDF\uFFE7\uFFEF-\uFFFB\uFFFE\uFFFF]/g;
			
			limitersHangeul = ["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",
			"a","b","c","d","e","f","g","h","i","j","k","‚àº","¬Æ","‚óÜ","|","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z",
			"„â¢","„â£","‚ñ≥","‚óã","%","‚ù∑","‚ù∏","ÔºΩ","Ôºç","‚ù∂","‚ô°","‚ùπ","‚Äï","‚óè","„â†","„Äé","„Äê","„Äë","„Äè","„â°","~","‚Äã","„Äâ","ÔΩû","„Äå","„Äà","$","/","„Äî","‚îÇ","‚Ä¶","„Äç","‚Äú",":","‚Äù","#","-","üíõ",",", "„éû",".","?","!","+","\"","\'","‚ñ†","‚îÄ",")","‚ñ∂","‚ñº","‚ô•","‚óÄ","‚ô™","„Äã","„Ö°","&","_","„Ää","{","}","¬∑","[","=","]","*","(","~","^","„éè","1","2","3","4","5","6","7","8","9","0","‚Äò","‚Äô","<",">"];
			
			limiters = limitersHangeul;
			replaceCharacters = replaceCharactersHangeul;
			regExp = /^\S*$/;
			document.getElementById("DictionaryTabButton").click();
			window.addEventListener('resize', OnResize);

			$(document).ready(function() {
				var table = $('#unknownWordsDataTable').DataTable( {
					"paging":         true,
					"scrollCollapse": false,
					"deferRender": true,
					"info": false,
					"order": [[ 0, "desc" ]],
					select: 'single',
					columns: [
						{ title: "Count" },
						{ title: "Word" },
						{ title: "Frequency" },
						{ title: "TOPIK" },
					],
					columnDefs: [
						{type: 'non-empty-string', targets: 3} // define 'name' column as non-empty-string type
					]
				} );

							var table2 = $('#learningWordsDataTable').DataTable( {
					"paging":         true,
					"scrollCollapse": false,
					"deferRender": true,
					"info": false,
					"order": [[ 0, "desc" ]],
					select: 'single',
					columns: [
						{ title: "Count" },
						{ title: "Word" },
						{ title: "Frequency" },
						{ title: "TOPIK" },
					],
					columnDefs: [
						{type: 'non-empty-string', targets: 3} // define 'name' column as non-empty-string type
					]
				} );
				
							var table3 = $('#knownWordsDataTable').DataTable( {
					"paging":         true,
					"scrollCollapse": false,
					"deferRender": true,
					"info": false,
					"order": [[ 0, "desc" ]],
					select: 'single',
					columns: [
						{ title: "Count" },
						{ title: "Word" },
						{ title: "Frequency" },
						{ title: "TOPIK" },
					],
					columnDefs: [
						{type: 'non-empty-string', targets: 3} // define 'name' column as non-empty-string type
					]
				} );
				
							var table4 = $('#allWordsDataTable').DataTable( {
					"paging":         true,
					"scrollCollapse": false,
					"deferRender": true,
					"info": false,
					"order": [[ 0, "desc" ]],
					select: 'single',
					columns: [
						{ title: "Count" },
						{ title: "Word" },
						{ title: "Frequency" },
						{ title: "TOPIK" },
					],
					columnDefs: [
						{type: 'non-empty-string', targets: 3} // define 'name' column as non-empty-string type
					]
				} );
				
							var table5 = $('#vocabularyDataTable').DataTable( {
				    "scrollY":        300,
					"scrollCollapse": false,
					"paging":         false,
					"deferRender": true,
					"info": false,
					"order": [[ 0, "desc" ]],
					select: true,
					columns: [
						{ title: "Word" },
						{ title: "State" }
					]
				} );
				
							var table6 = $('#compareDataTable').DataTable( {
					"scrollCollapse": false,
					"paging":         false,
					"deferRender": true,
					"searching": false,
					"info": false,
					"order": [[ 3, "desc" ]],
					select: false,
					columns: [
						{ title: "Word List" },
						{ title: "Unknown %" },
						{ title: "Learning %" },
						{ title: "Known %" },
						{ title: "Unknown Unique Words" },
						{ title: "Total Unique Words" }
					]
				} );
				
				var table7 = $('#unknownWordsDataTableSummary').DataTable( {
					"scrollCollapse": false,
					"paging":         false,
					"targets": 'no-sort',
					"bSort": false,
					"order": [],
					"searching": false,
					"info": false,
					columns: [
						{ title: "Unknown Words" },
						{ title: "Total Words" },
						{ title: "Unique Unknown Words" },
						{ title: "Total Unique Words" }
					]
				} );
				
							var table8 = $('#learningWordsDataTableSummary').DataTable( {
				    "scrollCollapse": false,
					"paging":         false,
					"targets": 'no-sort',
					"bSort": false,
					"order": [],
					"searching": false,
					"info": false,
					columns: [
						{ title: "Learning Words" },
						{ title: "Total Words" },
						{ title: "Unique Learning Words" },
						{ title: "Total Unique Words" }
					]
				} );
				
							var table9 = $('#knownWordsDataTableSummary').DataTable( {
				    "scrollCollapse": false,
					"paging":         false,
					"targets": 'no-sort',
					"bSort": false,
					"order": [],
					"searching": false,
					"info": false,
					columns: [
						{ title: "Known Words" },
						{ title: "Total Words" },
						{ title: "Unique Known Words" },
						{ title: "Total Unique Words" }
					]
				} );
				
							var table10 = $('#allWordsDataTableSummary').DataTable( {
				    "scrollCollapse": false,
					"paging":         false,
					"targets": 'no-sort',
					"bSort": false,
					"order": [],
					"searching": false,
					"info": false,
					columns: [
						{ title: "Total Words" },
						{ title: "Total Unique Words" }
					]
				} );
				
					var table11 = $('#vocabularyDataTableSummary').DataTable( {
				    "scrollCollapse": false,
					"paging":         false,
					"targets": 'no-sort',
					"bSort": false,
					"order": [],
					"searching": false,
					"info": false,
					columns: [
						{ title: "Unknown" },
						{ title: "Learning" },
						{ title: "Known" },
						{ title: "Total"},
						{ title: "Total Learning + Known"}
					]
				} );
				
				var events = $('#events');
				
				table
				.on( 'select', function ( e, dt, type, indexes ) {
					var rowData = table.rows( indexes ).data().toArray();
					table.rows( { selected: true } ).deselect();
					selectedWord = rowData[0][1];
					selectedIndex = indexes[0];
					JumpTo(rowData[0][1]);
				} );

				
							table2
				.on( 'select', function ( e, dt, type, indexes ) {
					var rowData = table2.rows( indexes ).data().toArray();
					table2.rows( { selected: true } ).deselect();
					selectedWord = rowData[0][1];
					selectedIndex = indexes[0];
					JumpTo(rowData[0][1]);
				} );

				
							table3
				.on( 'select', function ( e, dt, type, indexes ) {
					var rowData = table3.rows( indexes ).data().toArray();
					table3.rows( { selected: true } ).deselect();
					selectedWord = rowData[0][1];
					selectedIndex = indexes[0];					
					JumpTo(rowData[0][1]);
				} );

         				
							table4
				.on( 'select', function ( e, dt, type, indexes ) {
					var rowData = table4.rows( indexes ).data().toArray();
					table4.rows( { selected: true } ).deselect();
					selectedWord = rowData[0][1];
					selectedIndex = indexes[0];
					JumpTo(rowData[0][1]);
				} );

				
										table5
				.on( 'select', function ( e, dt, type, indexes ) {
					var rowData = table5.rows( indexes ).data().toArray();
					for(var i=0;i<rowData.length;i++)
					{
						selectedVocabulary[i] = rowData[i][0];
					}
				} );
				
				table5
				.on( 'deselect', function ( e, dt, type, indexes ) {
					selectedVocabulary = [];
				} );
				jQuery.extend( jQuery.fn.dataTableExt.oSort, {
				"non-empty-string-asc": function (str1, str2) {
					if(str1 == "")
						return 1;
					if(str2 == "")
						return -1;
					return ((str1 < str2) ? -1 : ((str1 > str2) ? 1 : 0));
				},
			 
				"non-empty-string-desc": function (str1, str2) {
					if(str1 == "")
						return 1;
					if(str2 == "")
						return -1;
					return ((str1 < str2) ? 1 : ((str1 > str2) ? -1 : 0));
				}
			} );
				


				initdb();
			}
	
			);
			

			var contentArea = document.getElementById ("content");
			
					if (contentArea.addEventListener) {
					contentArea.addEventListener ("mouseup", function (event) {
						if(menuVisible)
						{
							ShowMenu(false);
						}
					
						if (event.altKey||event.ctrlKey||event.metaKey)
						{
							mouseUp(0);
						}
						else
						{
							switch (event.which) {
							case 1:
								mouseUp(1);
								break;
							case 2:
								//mouseUp(1);
								break;
							case 3:
								//mouseUp(2);
								break;
							default:
								mouseUp(1);
						}

						}
	
					}, false);
				}


					var sidebar2 = document.getElementById ("sidebar2");
					if (sidebar2.addEventListener) {
					sidebar2.addEventListener ("mouseup", function (event)
					{
						if(menuVisible)
						{
							ShowMenu(false);
						}
	
					}, false);
				}	

				
		}
		
		function InitialiseHighlighting()
		{
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.get("enableHighlighting$");
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
	        request.onsuccess = function(event) {          
	          if(request.result) {
					var a = request.result.appearances;
					if(a==0)
					{
						enableHighlighting = false;
						document.getElementById("enableHighlighting").checked = false;
					}
					else
					{
						enableHighlighting = true;
						document.getElementById("enableHighlighting").checked = true;
					}
			}
					else
					{
						if(enableHighlighting)
						{
							addwordtodb("enableHighlighting$",1);
							document.getElementById("enableHighlighting").checked = true;
						}
						else
						{
							addwordtodb("enableHighlighting$",0);
							document.getElementById("enableHighlighting").checked = false;
						}
					}
			}
		}
		
		function initdb()
		{
			if (!window.indexedDB) {
				alert("Your browser doesn't support a stable version of IndexedDB");
				console.log("Your browser doesn't support a stable version of IndexedDB");
			}
		else
		{			
			
			var request = indexedDB.open("wordsdb",3);
			
	
			request.onupgradeneeded = function() {
			  db = request.result;
			  var store = db.createObjectStore("wordsdb", {keyPath: "word"});
			  var appearancesIndex = store.createIndex("by_appearance", "appearance");
			  
	
			  
			};
			request.onerror = function(event) 
			{
			  console.log("Database error: " + event.target.errorCode);
			};
			request.onsuccess = function() {
			  db = request.result;
			  InitialiseColourInputField();
			  InitialiseStartingMark();
			  InitialiseHighlighting();
			  InitialiseFontSize();
			  InitialiseRomanisation();
			  InitialiseVoice();
			  InitialiseFontType(0);
			  InitialiseDictLanguage();
			  InitialiseHighlightingKnown();
			  
			  
			  var pasteArea = document.getElementById ("pasteArea");
			  pasteArea.innerText = "";	
			  LoadHTML();
			  OnResize();
			  initialisationComplete = true;
			  pasteArea.contentEditable = true;
			document.getElementById("DictionaryTabButton").click();
				
			};
			}
		}
		
		$(window).keydown(function(e) {
		//console.log(e.keyCode);
		  switch (e.keyCode) {
		  
			case 49: if(openedTab!="OptionsTab"){document.getElementById("DictionaryTabButton").click(); e.preventDefault();} break; 
			case 50: if(openedTab!="OptionsTab"){document.getElementById("ImagesTabButton").click(); e.preventDefault();} break; 
			case 51: if(openedTab!="OptionsTab"){document.getElementById("StatisticsTabButton").click(); e.preventDefault();} break; 
			case 52: if(openedTab!="OptionsTab"){document.getElementById("UnknownWordsTabButton").click(); e.preventDefault();} break;
			case 53: if(openedTab!="OptionsTab"){document.getElementById("LearningWordsTabButton").click(); e.preventDefault();} break;
			case 54: if(openedTab!="OptionsTab"){document.getElementById("KnownWordsTabButton").click(); e.preventDefault();} break;
			case 55: if(openedTab!="OptionsTab"){document.getElementById("AllWordsTabButton").click(); e.preventDefault();} break;
			case 56: if(openedTab!="OptionsTab"){document.getElementById("VocabularyTabButton").click(); e.preventDefault();} break;
			case 57: if(openedTab!="OptionsTab"){document.getElementById("CompareTabButton").click(); e.preventDefault();} break;
			case 48: if(openedTab!="OptionsTab"){document.getElementById("GraphTabButton").click(); e.preventDefault();} break;
			case 97: if(openedTab!="OptionsTab"){document.getElementById("DictionaryTabButton").click(); e.preventDefault();} break; 
			case 98: if(openedTab!="OptionsTab"){document.getElementById("ImagesTabButton").click(); e.preventDefault();} break; 
			case 99: if(openedTab!="OptionsTab"){document.getElementById("StatisticsTabButton").click(); e.preventDefault();} break; 
			case 100: if(openedTab!="OptionsTab"){document.getElementById("UnknownWordsTabButton").click(); e.preventDefault();} break;
			case 101: if(openedTab!="OptionsTab"){document.getElementById("LearningWordsTabButton").click(); e.preventDefault();} break;
			case 102: if(openedTab!="OptionsTab"){document.getElementById("KnownWordsTabButton").click(); e.preventDefault();} break;
			case 103: if(openedTab!="OptionsTab"){document.getElementById("AllWordsTabButton").click(); e.preventDefault();} break;
			case 104: if(openedTab!="OptionsTab"){document.getElementById("VocabularyTabButton").click(); e.preventDefault();} break;
			case 105: if(openedTab!="OptionsTab"){document.getElementById("CompareTabButton").click(); e.preventDefault();} break;
			case 96: if(openedTab!="OptionsTab"){document.getElementById("GraphTabButton").click(); e.preventDefault();} break;
			
			
			case 46: DeleteVocabulary(); break;
			case 8: DeleteVocabulary(); break;
			case 27: Reset(); e.preventDefault(); break;

			  return;
		  }
		});
		
		function DeleteVocabulary()
		{
			if(enableHighlighting && openedTab=="VocabularyTab") {
				if(selectedVocabulary.length>0)
				{
					for(var i=0;i<selectedVocabulary.length;i++)
					{
						var transaction = db.transaction(["wordsdb"], "readwrite");
						transaction.onerror = function(event) {
							console.log('Transaction not opened due to error: ' + transaction.error);
						  };
						var objectStore = transaction.objectStore("wordsdb");
						var objectStoreRequest = objectStore.delete(selectedVocabulary[i]);
					}
						
						
						
						
	
						}
						selectedVocabulary = [];
						OnInput();
						
						var t = $('#vocabularyDataTable').DataTable();
						t.clear().draw();
						if(vocabularyTimeout)
						{	
							clearTimeout(vocabularyTimeout);
						}
						vocabularyTimeout = setTimeout(function() {
							CalculateVocabulary();
						}, 50);
				}
		
		}
		
		/**
			 * JavaScript code to detect available availability of a
			 * particular font in a browser using JavaScript and CSS.
			 *
			 * Author : Lalit Patel
			 * Website: http://www.lalit.org/lab/javascript-css-font-detect/
			 * License: Apache Software License 2.0
			 *          http://www.apache.org/licenses/LICENSE-2.0
			 * Version: 0.15 (21 Sep 2009)
			 *          Changed comparision font to default from sans-default-default,
			 *          as in FF3.0 font of child element didn't fallback
			 *          to parent element if the font is missing.
			 * Version: 0.2 (04 Mar 2012)
			 *          Comparing font against all the 3 generic font families ie,
			 *          'monospace', 'sans-serif' and 'sans'. If it doesn't match all 3
			 *          then that font is 100% not available in the system
			 * Version: 0.3 (24 Mar 2012)
			 *          Replaced sans with serif in the list of baseFonts
			 */

			/**
			 * Usage: d = new Detector();
			 *        d.detect('font name');
			 */
			var Detector = function() {
				// a font will be compared against all the three default fonts.
				// and if it doesn't match all 3 then that font is not available.
				var baseFonts = ['monospace', 'sans-serif', 'serif'];

				//we use m or w because these two characters take up the maximum width.
				// And we use a LLi so that the same matching fonts can get separated
				var testString = "mmmmmmmmmmlli";

				//we test using 72px font size, we may use any size. I guess larger the better.
				var testSize = '72px';

				var h = document.getElementsByTagName("body")[0];

				// create a SPAN in the document to get the width of the text we use to test
				var s = document.createElement("span");
				s.style.fontSize = testSize;
				s.innerHTML = testString;
				var defaultWidth = {};
				var defaultHeight = {};
				for (var index in baseFonts) {
					//get the default width for the three base fonts
					s.style.fontFamily = baseFonts[index];
					h.appendChild(s);
					defaultWidth[baseFonts[index]] = s.offsetWidth; //width for the default font
					defaultHeight[baseFonts[index]] = s.offsetHeight; //height for the defualt font
					h.removeChild(s);
				}

				function detect(font) {
					var detected = false;
					for (var index in baseFonts) {
						s.style.fontFamily = font + ',' + baseFonts[index]; // name of the font along with the base font for fallback.
						h.appendChild(s);
						var matched = (s.offsetWidth != defaultWidth[baseFonts[index]] || s.offsetHeight != defaultHeight[baseFonts[index]]);
						h.removeChild(s);
						detected = detected || matched;
					}
					return detected;
				}

				this.detect = detect;
			};

		function sleep(ms) {
		  return new Promise(resolve => setTimeout(resolve, ms));
		}

		function InitialiseFontType(attempts)
		{
			
		
			var fontTypeDropDown = document.getElementById("fontTypeOption");
			
			for (a in fontTypeDropDown.options) { fontTypeDropDown.options.remove(0); }
			
			d = new Detector();
			
			
			var fontList = [
			'Arial, Helvetica, sans-serif',
			'Gamja Flower',
			'Song Myung',
			'Hi Melody',
			'Nanum Pen Script',
			'Sunflower',
			'Nanum Myeongjo',
			'Cute Font',
			'Poor Story',
			'Yeon Sung',
			'Stylish',
			'Gothic A1'
			];
			
			var chosenFont = 'Arial, Helvetica, sans-serif';
			
			for(var i=0;i<fontList.length;i++)
			{
				var detection = d.detect(fontList[i]);
				if(detection)
				{
					var opt = document.createElement('option');
					opt.value = fontList[i];
					opt.innerHTML = fontList[i];
					fontTypeDropDown.appendChild(opt);
				
					
					if(i==6)
					{
						fontTypeDropDown.value=fontList[i];
						chosenFont= fontList[i];
					}
					
				}
				else if(attempts<30)
				{
					sleep(500).then(() => { InitialiseFontType(attempts+1); });
					return;
				}
			}
			
			var objectStore3 = db.transaction(["wordsdb"]).objectStore("wordsdb");
			var request3 = objectStore3.get("fonttype$");
			request3.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
				request3.onsuccess = function(event) {
				if(request3.result) {
						var a = request3.result.appearances;
					for(var i=0;i<fontTypeDropDown.options.length;i++)
					{
						if(fontTypeDropDown.options[i].value==a)
						{
							fontTypeDropDown.value=a;
							chosenFont= a;
						}
					}
						document.documentElement.style.setProperty('--font-type', chosenFont);
					}
	
				};
				
				
		}
		
		function InitialiseDictLanguage()
		{
				var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("dictlanguage$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
					
					
				request.onsuccess = function(event) {
				if(request.result) {
						var a = request.result.appearances;
						dictionaryLanguage = a;					
					}
					else
					{
						dictionaryLanguage = dictionaryLanguageDefault;
					}
					var dropDown = document.getElementById("dictLanguageOption");
					dropDown.value = dictionaryLanguage;
				};
		}

		
		
		function Reset(deleteWords)
		{
			clearTimeout(colourTimeout);
			clearTimeout(scrollTimeout);
			clearTimeout(vocabularyTimeout);
			clearTimeout(displaySortTimeout);
			clearTimeout(statisticsTimeout);
			clearTimeout(highlightTimeout);
			clearTimeout(unmarkJumpTimeout);
			clearTimeout(calculateStatisticsTimeout);
			if(deleteWords)
			{
			SaveHTML("");
			}
			var container = document.getElementById ("pasteArea");
			container.innerHTML="";
			ClearStatistics();
		}
		
		function CreateGraph(data,data2)
		{
			if(myChart)
			{
				myChart.destroy();
			}
			data.sort(sort_by('occurances', true, parseInt));
			data2.sort(sort_by('occurances', true, parseInt));
			var accumulativeWords = [];
			var xAxis=[];
			var total=0;
			for(var i=0;i<data.length;i++)
			{
				
				total+=data[i].occurances
				xAxis.push(i+1);
				accumulativeWords.push(total);
			}
			var accumulativeWords2 = [];
			var xAxis2=[];
			var total2=0;
			for(var i=0;i<data2.length;i++)
			{
				
				total2+=data2[i].occurances
				xAxis2.push(i+1);
				accumulativeWords2.push(total2);
			}
			
			var customTooltips = function(tooltip) {
			// Tooltip Element
			var tooltipEl = document.getElementById('chartjs-tooltip');

			if (!tooltipEl) {
				tooltipEl = document.createElement('div');
				tooltipEl.id = 'chartjs-tooltip';
				tooltipEl.innerHTML = '<table></table>';
				this._chart.canvas.parentNode.appendChild(tooltipEl);
			}

			// Hide if no tooltip
			if (tooltip.opacity === 0) {
				tooltipEl.style.opacity = 0;
				return;
			}

			// Set caret Position
			tooltipEl.classList.remove('above', 'below', 'no-transform');
			if (tooltip.yAlign) {
				tooltipEl.classList.add(tooltip.yAlign);
			} else {
				tooltipEl.classList.add('no-transform');
			}

			function getBody(bodyItem) {
				return bodyItem.lines;
			}

			// Set Text
			if (tooltip.body) {
				var titleLines = tooltip.title || [];
				var bodyLines = tooltip.body.map(getBody);

				var innerHtml = '<thead>';
				
				titleLines.forEach(function(title) {
					innerHtml += '<tr><th>' +"Unique Words: "+ title +" ("+(Math.round(((title/data.length)*100 + Number.EPSILON) * 100) / 100)+"%)"+'</th></tr>';
				});
				
				
				
				innerHtml += '</thead><tbody>';

				bodyLines.forEach(function(body, i) {
					var colors = tooltip.labelColors[i];
					var style = 'background:' + colors.backgroundColor;
					style += '; border-color:' + colors.borderColor;
					style += '; border-width: 2px';
					var b = []
					var body = (""+body);
					b = body.trim().split(/[, ]+/);
					innerHtml += '<tr><td>' +span+ b[2] +" ("+(Math.round(((b[2]/total)*100 + Number.EPSILON) * 100) / 100)+"%)"+ '</td></tr>';
				});
				innerHtml += '</tbody>';

				var tableRoot = tooltipEl.querySelector('table');
				tableRoot.innerHTML = innerHtml;
			}

			var positionY = this._chart.canvas.offsetTop;
			var positionX = this._chart.canvas.offsetLeft;

			// Display, position, and set styles for font
			tooltipEl.style.opacity = 1;
			tooltipEl.style.left = positionX + tooltip.caretX + 'px';
			tooltipEl.style.top = positionY + tooltip.caretY + 'px';
			tooltipEl.style.fontFamily = tooltip._bodyFontFamily;
			tooltipEl.style.fontSize = tooltip.bodyFontSize + 'px';
			tooltipEl.style.fontStyle = tooltip._bodyFontStyle;
			tooltipEl.style.padding = tooltip.yPadding + 'px ' + tooltip.xPadding + 'px';
		};
			
			
			var ctx = document.getElementById('myChart').getContext('2d');
			myChart = new Chart(ctx, {
				type: 'line',
				data: {
					labels: xAxis,
					datasets: [{
					label: "Current Text",
						data: accumulativeWords,
						backgroundColor: 'rgba(153, 102, 255, .5)',
						borderColor: 'rgba(153, 102, 255, .5)',
						fill: true,
				}, {
					label: "My Vocabulary",
						data: accumulativeWords2,
						backgroundColor: 'rgba(255, 159, 64, .5)',
						borderColor: 'rgba(255, 159, 64, .5)',
						fill: true,
				}]
				},
				options: {
					responsive: true,
				title: {
					display: true,
					text: 'Total Words vs Unique Words'
				},
				tooltips: {
						enabled: false,
						mode: 'index',
						position: 'nearest',
						custom: customTooltips
					},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Unique Words'
						}
					}],
					yAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Cumulative Word Total'
						}
					}]
				}
				}
			});
		}
		
		function InitialiseVoice()
		{
			var sliderPitch = document.getElementById("voicePitchSlider");
			var outputPitch = document.getElementById("pitchOutput");
			
			var objectStore4 = db.transaction(["wordsdb"]).objectStore("wordsdb");
			var request4 = objectStore4.get("voicePitch$");
			request4.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
					
				outputPitch.innerHTML = (sliderPitch.value/10);
				
				request4.onsuccess = function(event) {
					if(request4.result) 
					{
							var a = request4.result.appearances;
							sliderPitch.value = a*10;
							outputPitch.innerHTML = a;
							voicePitch = a;
					}
	
				};
			
			sliderPitch.oninput = function() {
				var value = this.value/10;
			  outputPitch.innerHTML = (value);
			  voicePitch = (value);
			  
				var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("voicePitch$");
				request.onerror = function(event) {
					alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "voicePitch$",appearances: value});
					}
					else
					{
						addwordtodb("voicePitch$",value);
					}
				}
			}
			
			var sliderVolume = document.getElementById("voiceVolumeSlider");
			var outputVolume = document.getElementById("volumeOutput");
			
			
			var objectStore5 = db.transaction(["wordsdb"]).objectStore("wordsdb");
			var request5 = objectStore5.get("voiceVolume$");
			request5.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
					
				outputVolume.innerHTML = (sliderVolume.value/10); 
				
				request5.onsuccess = function(event) {
					if(request5.result) 
					{
							var a = request5.result.appearances;
							sliderVolume.value = a*10;
							outputVolume.innerHTML = a;
							voiceVolume = a;
							
					}
	
				};
			
			
			sliderVolume.oninput = function() {
			var value = this.value/10;
			  outputVolume.innerHTML = (value);
			  voiceVolume = (value);
			  
			  			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("voiceVolume$");
				request.onerror = function(event) {
					alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "voiceVolume$",appearances: value});
					}
					else
					{
						addwordtodb("voiceVolume$",value);
					}
				}
			}
			
			var sliderSpeed = document.getElementById("voiceSpeedSlider");
			var outputSpeed = document.getElementById("speedOutput");
			
					var objectStore6 = db.transaction(["wordsdb"]).objectStore("wordsdb");
			var request6 = objectStore6.get("voiceSpeed$");
			request6.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
					
						outputSpeed.innerHTML = (sliderSpeed.value/10);
				
				request6.onsuccess = function(event) {
					if(request6.result) 
					{
							var a = request6.result.appearances;
							sliderSpeed.value = a*10;
							outputSpeed.innerHTML = a;
							voiceSpeed = a;
							
					}
	
				};
			sliderSpeed.oninput = function() {
			var value = this.value/10;
			  outputSpeed.innerHTML = (value);
			  voiceSpeed = (value);
			  
			  			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("voiceSpeed$");
				request.onerror = function(event) {
					alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "voiceSpeed$",appearances: value});
					}
					else
					{
						addwordtodb("voiceSpeed$",value);
					}
				}
			}
		
			var objectStore2 = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request2 = objectStore2.get("enableVoice$");
	        request2.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
	        request2.onsuccess = function(event) {          
	          if(request2.result) {
					var a = request2.result.appearances;
					if(a==0)
					{
						enableVoice = false;
						document.getElementById("enableVoice").checked = false;
					}
					else
					{
						enableVoice = true;
						document.getElementById("enableVoice").checked = true;
					}
			}
					else
					{
						if(enableVoice)
						{
							addwordtodb("enableVoice$",1);
							document.getElementById("enableVoice").checked = true;
						}
						else
						{
							addwordtodb("enableVoice$",0);
							document.getElementById("enableVoice").checked = false;
						}
					}
			};
			
			var voices;
			if(window.speechSynthesis.getVoices().length == 0) {
				window.speechSynthesis.addEventListener('voiceschanged', function() {
					voices = window.speechSynthesis.getVoices();
					PopulateVoiceDropDown(voices);
				});
			}
			else {
				voices = window.speechSynthesis.getVoices();
				PopulateVoiceDropDown(voices);
			}
		}
		
		function PopulateVoiceDropDown(voices)
		{
			var voiceDropDown = document.getElementById("voiceOption");
			var length = voiceDropDown.options.length;
			for (i = length-1; i >= 0; i--) {
			  voiceDropDown.options[i] = null;
			}
				voices.forEach(function(voice) {
				if(voice.lang=="ko-KR")
				{
					var opt = document.createElement('option');
					opt.value = voice.name;
					opt.innerHTML = voice.name;
					voiceDropDown.appendChild(opt);
				}
			});
			
					var objectStore3 = db.transaction(["wordsdb"]).objectStore("wordsdb");
			var request3 = objectStore3.get("voice$");
			request3.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
				
				request3.onsuccess = function(event) {
				if(request3.result) {
						var a = request3.result.appearances;
					for(var i=0;i<voiceDropDown.options.length;i++)
					{
						if(voiceDropDown.options[i].value==a)
						{
							voiceDropDown.value=voiceDropDown.options[i].value;
						}
					}
						
					}
	
				};
		}
		
		function GetIndexOfVoice(name)
		{
			var index =-1;
			var voices = window.speechSynthesis.getVoices();
			for(var i=0;i<voices.length;i++)
			{
				if(name==voices[i].name)
				{
					index=i;
					break;
				}
			}
			return index;
		}
		
		function SpeakWord(word)
		{
			var voiceDropDown = document.getElementById("voiceOption").value;
			var voiceIndex=GetIndexOfVoice(voiceDropDown); //TODO move elsewhere?
			if(voiceIndex==-1)
			{
				alert("Voice not found");
			}
			else
			{
				speechSynthesis.cancel();
				var msg = new SpeechSynthesisUtterance();
				var voices = window.speechSynthesis.getVoices();
				msg.voice = voices[voiceIndex]; // Note: some voices don't support altering params
	
				msg.voiceURI = 'native';
				msg.volume = voiceVolume;
				msg.rate = voiceSpeed;
				msg.pitch = voicePitch;
				msg.text = word;
				speechSynthesis.speak(msg);
			}
		}
		
		function AsyncChangeColour(word, incrementByOne, skipJump)
		{
		
							if(colourTimeout)
						{	
							clearTimeout(colourTimeout);
						}
						colourTimeout = setTimeout(function() {
							ChangeColour(word, incrementByOne, skipJump);
						}, 50);
		}
	
		
		function ChangeColour(word, incrementByOne, skipJump)
		{

		
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.get(word);
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
	        request.onsuccess = function(event) {          
	          if(request.result) {
					var w = request.result.word;
					var a;
						if(incrementByOne)
						{
							a = request.result.appearances+1;
						}
						else
						{
							a = request.result.appearances;
						}
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: w,appearances: a});
					
					var remainder = a%3;
					if(remainder==0)
					{
						unknownWordsTabUpToDate = false;
						knownWordsTabUpToDate = false;
						GetPageAndHighlight(w,0,skipJump);
						
					}
					else if(remainder==1)
					{	
						unknownWordsTabUpToDate = false;
						learningWordsTabUpToDate = false;
						GetPageAndHighlight(w,1,skipJump);
						
					}
					else if(remainder==2)
					{
						knownWordsTabUpToDate = false;
						learningWordsTabUpToDate = false;
						GetPageAndHighlight(w,2,skipJump);
						
					}
	
	          } else {
					unknownWordsTabUpToDate = false;
					addwordtodb(word);
					GetPageAndHighlight(word,((startingMark+1)%3),skipJump);
					
	          }

			  AsyncCalculateStatistics();
			 
	        };
		}
		
		function setCurrentColour(word,pageNo)
		{
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.get(word);
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
	        request.onsuccess = function(event) {          
	          if(request.result) {
					var w = request.result.word;
					var a = request.result.appearances;
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: w,appearances: a});
					
					var remainder = a%3;
					if(remainder==0)
					{
						AsyncHighlight(w,0,true,pageNo);
					}
					else if(remainder==1)
					{
						AsyncHighlight(w,1,true,pageNo);
					}
					else if(remainder==2)
					{
						AsyncHighlight(w,2,true,pageNo);
					}
	
	          } else {
					addwordtodb(word,startingMark);
					AsyncHighlight(word,startingMark,true,pageNo);
	          }
	        };
		}
		
		function UnmarkJump(items)
		{
		
			var word="";
			if(items.length > 0)
			{
				word=(items[0].innerText);
			}
		
			var optionsDeleteJump = {
			"className": 'jump'
			}
			
			if(word!="")
			{
				ChangeColour(word,false,true);
			}
			
			var instance = new Mark(document.querySelector("div.content"));
			instance.unmark(optionsDeleteJump);
			
			
		}
		
		function JumpTo(word)
		{
				if(browser=="edge")
				{
					return false;
				}
				
				var container = document.getElementById ("pasteArea");
				const items = container.getElementsByClassName('jump');
				if(items.length > 0)
				{
					if(items[0].innerText==word)
					{
						jumpAttempts=(jumpAttempts+1)%items.length;
					}
					else
					{
						jumpAttempts = 0;
					}
					
				}
				else
				{
					jumpAttempts = 0;
				}
				UnmarkJump(items);
				var optionsJump = {
					"accuracy": {
						"value": "exactly",
						"limiters": limiters
					}, "className": 'jump'
				};
		
			var instance = new Mark(document.querySelector("div.content"));
			instance.mark(word,optionsJump);
			
			
			if(enableVoice)
			{
				SpeakWord(word);
			}
			dictionaryLookup(word);
			imagesLookup(word);
			pendingLookup = word;
	
			
			if (items.length > 0) {
			  scrollTo({
				top: items[jumpAttempts].offsetTop,
			behavior: 'auto'
			  });
			}
			jumpMarked = true;
		}
		
		function GetPageAndHighlight(word,colorIndex, skipJump)
		{
			var divs = document.getElementsByClassName("individualPage");
			var pageTop = $(window).scrollTop();
			var pageBot = pageTop + $(window).height();
					//var toMark = [];
					for(var i=0;i<divs.length;i++)
					{
						var divTop = divs[i].offsetTop;
						var divBot = divTop+divs[i].offsetHeight;
	
						if(divBot>pageTop-800&&divTop<pageBot+800)
						{
							if(divs[i].marked)
							{	
								AsyncHighlight(word,colorIndex,skipJump,i);
							}
						}
					}
		}
		
		function AsyncHighlight(word, colourIndex, skipJump, pageNo)
		{
			
						highlightTimeout = setTimeout(function() {
							Highlight(word, colourIndex, skipJump,pageNo);
						}, 100);
			
		}
		
		function Highlight(word, colourIndex, skipJump, pageNo)
		{
				if(skipJump)
				{
						var optionsTertiary = {
						"accuracy": {
							"value": "exactly",
							"limiters": limiters
						}, "className": 'tertiary',
						"exclude":['.jump']
					};
			
					var optionsSecondary = {
						"accuracy": {
							"value": "exactly",
							"limiters": limiters
						}, "className": 'secondary',
						"exclude":['.jump']
					};
					
					var optionsPrimary = {
						"accuracy": {
							"value": "exactly",
							"limiters": limiters
						}, "className": 'primary',
						"exclude":['.jump']
					};
				}
				else
				{
						var optionsTertiary = {
						"accuracy": {
							"value": "exactly",
							"limiters": limiters
						}, "className": 'tertiary'
					};
			
					var optionsSecondary = {
						"accuracy": {
							"value": "exactly",
							"limiters": limiters
						}, "className": 'secondary'
					};
					
					var optionsPrimary = {
						"accuracy": {
							"value": "exactly",
							"limiters": limiters
						}, "className": 'primary'
					};
				}

						var instance = new Mark(GetPage(pageNo));
					
					
					if(colourIndex==0)
					{
						instance.mark(word,optionsPrimary);
					}
					else if (colourIndex==1)
					{
						instance.mark(word,optionsSecondary);
					}
					else if (colourIndex==2)
					{
						instance.mark(word,optionsTertiary);
					}
				//}
		}
		
		function unmark()
		{
			if(all_marked)
			{
				var instance = new Mark(document.querySelector("div.content"));
				instance.unmark();
				all_marked = false;
			}
		}
	
		
		function markAll(toMark)
		{
				for(var i=0;i<toMark.length;i++)
				{	
					var page = GetPage(toMark[i]);
					if(page.marked==false)
					{
						var words = page.textContent;
						words=words.replace(replaceCharacters," ");
	
						var wordArray = words.trim().split(/[, ]+/);
						for(var j=0;j<wordArray.length;j++)
						{
							setCurrentColour(wordArray[j],toMark[i]);
						}
						page.marked = true;
					}
				}
				all_marked = true;
		}
	
		function addwordtodb(w,a)
		{
			var request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").add({ word: w,appearances: a});
	                                 
	        request.onsuccess = function(e) {
	        };
	         
	        request.onerror = function(e) {     
	        }   
	
		}
		
		function mouseUp(modifier){
		

		
			if(!all_marked&&enableHighlighting)
			{
				onScroll();
			}
			
			var selectedText = getSelectionText();
			
			
			if(jumpMarked)
			{
				var container = document.getElementById ("pasteArea");
				const items = container.getElementsByClassName('jump');
				
				
				unmarkJumpTimeout = setTimeout(function() {
							UnmarkJump(items);
						}, 200);
				
				
				
				jumpMarked = false;
			}
			else if(modifier==0||modifier==1)
			{
				if(selectedText!="")
				{

						if(enableVoice)
						{
							SpeakWord(selectedText);
						}
						dictionaryLookup(selectedText);
						imagesLookup(selectedText);
						pendingLookup = selectedText;
				}
				else
				{
					var selection = window.getSelection();	
					if (!selection || selection.rangeCount < 1) return true;
					var range = selection.getRangeAt(0);
					var node = selection.anchorNode;
					var word_regexp = regExp;
					
					while ((range.startOffset > 0) && range.toString().match(word_regexp)) {
					  range.setStart(node, (range.startOffset - 1));
					}
					if (!range.toString().match(word_regexp)) {
					  range.setStart(node, range.startOffset + 1);
					}
					while ((range.endOffset < node.length) && range.toString().match(word_regexp)) {
					  range.setEnd(node, range.endOffset + 1);
					}
					if (!range.toString().match(word_regexp)) {
					  range.setEnd(node, range.endOffset - 1);
					}
				
					var word = range.toString(); 
					word=word.replace(replaceCharacters,"");
					if(word==""&&browser=="chrome")
					{
					   var t = '';
						if (window.getSelection && (sel = window.getSelection()).modify) {
							// Webkit, Gecko
							var s = window.getSelection();
								s.modify('extend', 'forward', 'word');
								t = s.toString();
							
							t=t.replace(replaceCharacters," ");
							t=t.trim();
							for (var i = 0; i < t.length; i++) {
							  if(t.charAt(i)==" ")
							  {
								t = t.substring(0,i);
								break;
							  }
							}
								
							word = t;
						}
					}	
					if(word!="")
					{
							if(modifier==1&&enableHighlighting)
							{
								
								AsyncChangeColour(word, true,false);
							}
							if(enableVoice)
								{
									SpeakWord(word);
								}	
							
							dictionaryLookup(word);
							imagesLookup(word);
							pendingLookup = word;
							
							var selection = window.getSelection ? window.getSelection() : document.selection ? document.selection : null;
							if(!!selection) selection.empty ? selection.empty() : selection.removeAllRanges();
					}
						
					
				}
				
				if(modifier==0)
				{
					if(openedTab!="DictionaryTab")
					{
						document.getElementById("DictionaryTabButton").click();
					}
					
				}
				
			}
			else
			{
				selectedText=selectedText.replace(replaceCharacters,"");
				if(selectedText!="")
				{
					if(enableHighlighting)
					{
						AsyncChangeColour(selectedText, true,false);
					}
					if(enableVoice)
					{
						SpeakWord(selectedText);
					}
					dictionaryLookup(selectedText);
					imagesLookup(selectedText);
					pendingLookup = selectedText;
				}
				var selection = window.getSelection ? window.getSelection() : document.selection ? document.selection : null;
				if(!!selection) selection.empty ? selection.empty() : selection.removeAllRanges();
			}
		}
	
		function getSelectionText() {
			var text = "";
			if (window.getSelection) {
				text = window.getSelection().toString();
			} else if (document.selection && document.selection.type != "Control") {
				text = document.selection.createRange().text;
			}
			return text;
		}
		
		
		function dictionaryLookup(word)
		{

			if(openedTab=="DictionaryTab")
			{
				var maxLength = 30;
				if(word.length>maxLength)
				{
					word = word.substring(0, maxLength);	
				}
				
				if(dictionaryLookingUp!=word)
				{
					
					changeDictionarySrc(word);
				}
				dictionaryLookingUp = word;
			}
		}
		
		function RemoveSelection(index)
		{
			if(index==0)
			{
				var naverIframe = document.getElementById('naverIframe');
				naverIframe.blur();
			}
			else
			{
				var body = document.getElementById('body');
				body.blur;
			}
		}
		
		function imagesLookup(word)
		{	
			if(openedTab=="ImagesTab")
			{
				var maxLength = 30;
				if(word.length>maxLength)
				{
					word = word.substring(0, maxLength);	
				}
				
				if(imagesLookingUp!=word)
				{
					
					changeImagesSrc(word);
				}
				imagesLookingUp = word;
				
			}
		}
		
		function ConvertLangCode(w)
		{
			var code;
			switch(w)
			{
				case "Korean-Korean":code="ko"; break;
				case "English":code="en"; break;
				case "Japanese":code="ja"; break;
				case "Chinese":code="zh"; break;
				case "French":code="frkodict"; break;
				case "Spanish":code="eskodict"; break;
				case "German":code="dekodict"; break;
				case "Vietnamese":code="vikodict"; break;
				case "Nepali":code="nekodict"; break;
				case "Mongolian":code="mnkodict"; break;
				case "Burmese":code="mykodict"; break;
				case "Swahili":code="swkodict"; break;
				case "Arabic":code="arkodict"; break;
				case "Uzbek":code="uzkodict"; break;
				case "Bahasa Indonesian":code="idkodict"; break;
				case "Cambodian":code="kmkodict"; break;
				case "Thai":code="thkodict"; break;
				case "Tetum":code="tetkodict"; break;
				case "Persian":code="fakodict"; break;
				case "Ancient Hebrew":code="hbokodict"; break;
				case "Hindi":code="hikodict"; break;
				case "Modern Greek":code="elkodict"; break;
				case "Ancient Greek":code="grckodict"; break;
				case "Dutch":code="nlkodict"; break;
				case "Latin":code="lakodict"; break;
				case "Russian":code="rukodict"; break;
				case "Romanian":code="rokodict"; break;
				case "Swedish":code="svkodict"; break;
				case "Albanian":code="sqkodict"; break;
				case "Ukrainian":code="ukkodict"; break;
				case "Italian":code="itkodict"; break;
				case "Gruziya":code="kakodict"; break;
				case "Czech":code="cskodict"; break;
				case "Turkish":code="trkodict"; break;
				case "Portuguese":code="ptkodict"; break;
				case "Polish":code="plkodict"; break;
				case "Finnish":code="fikodict"; break;
				case "Hungarian":code="hukodict"; break;
				default: alert("Language code not found");
			}
			return code;
		}
		
		function changeDictionarySrc(text)
		{

			
			var loc;
			
			var langCode = ConvertLangCode(dictionaryLanguage);
			if(langCode.length==2)
			{
				loc = "https://"+langCode+".dict.naver.com/#/mini/search?query="+text;
			}
			else
			{ 
				loc = "https://dict.naver.com/"+langCode+"/#/mini/search?query="+text;
			}
			var naverIframe = document.getElementById('naverIframe');
			naverIframe.src = loc;
			
			setTimeout(function() {RemoveSelection(0);},100);
			setTimeout(function() {RemoveSelection(0);},200);
			setTimeout(function() {RemoveSelection(0);},300);
			setTimeout(function() {RemoveSelection(0);},400);
			setTimeout(function() {RemoveSelection(0);},500);
			setTimeout(function() {RemoveSelection(0);},600);
			setTimeout(function() {RemoveSelection(0);},700);
			setTimeout(function() {RemoveSelection(0);},800);
			setTimeout(function() {RemoveSelection(0);},900);
			setTimeout(function() {RemoveSelection(0);},1000);
			setTimeout(function() {RemoveSelection(0);},1500);
			setTimeout(function() {RemoveSelection(0);},2000);
	
			
			//}
		}
		
		function changeImagesSrc(text)
		{

			var loc;
			loc = "https://www.bing.com/images/search?q="+text;
			imagesIframe = document.getElementById('imagesIframe');
			imagesIframe.src = loc;

			
			setTimeout(function() {RemoveSelection(1);},100);
			setTimeout(function() {RemoveSelection(1);},200);
			setTimeout(function() {RemoveSelection(1);},300);
			setTimeout(function() {RemoveSelection(1);},400);
			setTimeout(function() {RemoveSelection(1);},500);
			setTimeout(function() {RemoveSelection(1);},600);
			setTimeout(function() {RemoveSelection(1);},700);
			setTimeout(function() {RemoveSelection(1);},800);
			setTimeout(function() {RemoveSelection(1);},900);
			setTimeout(function() {RemoveSelection(1);},1000);
			setTimeout(function() {RemoveSelection(1);},1500);
			setTimeout(function() {RemoveSelection(1);},2000);
		}
		
		function toggleEnableVoice()
		{
			if(document.getElementById("enableVoice").checked)
			{
				enableVoice=true;
			
				var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("enableVoice$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "enableVoice$",appearances: 1});
					}
					else
					{
						addwordtodb("enableVoice$",1);
					}
				}
	
						
			}
			else
			{
				enableVoice=false;
				speechSynthesis.cancel();	
				var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("enableVoice$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "enableVoice$",appearances: 0});
					}
											else
					{
						addwordtodb("enableVoice$",0);
					}
				}
		
			}
		}
		
		
		function toggleEnableHighlighting()
		{
		if(document.getElementById("enableHighlighting").checked)
			{
				enableHighlighting=true;
				all_marked=false;
			
				var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("enableHighlighting$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "enableHighlighting$",appearances: 1});
					}
					else
					{
						addwordtodb("enableHighlighting$",1);
					}
				}
	
						
			}
			else
			{
				enableHighlighting=false;
				all_marked=true;
				unmark();
				
				ClearStatistics();
				
				
					
				var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("enableHighlighting$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "enableHighlighting$",appearances: 0});
					}
											else
					{
						addwordtodb("enableHighlighting$",0);
					}
				}
		
			}
			OnInput();
		}
	
	
	function ClearStatistics()
	{
		var tt = $('#unknownWordsDataTableSummary').DataTable();
					tt.clear().draw();

				var t = $('#unknownWordsDataTable').DataTable();
					t.clear().draw();
					
					var tt2 = $('#learningWordsDataTableSummary').DataTable();
					tt2.clear().draw();

				var t2 = $('#learningWordsDataTable').DataTable();
					t2.clear().draw();
					
					var tt3 = $('#knownWordsDataTableSummary').DataTable();
					tt3.clear().draw();

				var t3 = $('#knownWordsDataTable').DataTable();
					t3.clear().draw();
					
					var tt4 = $('#allWordsDataTableSummary').DataTable();
					tt4.clear().draw();

				var t4 = $('#allWordsDataTable').DataTable();
					t4.clear().draw();
					
				var t5 = $('#vocabularyDataTable').DataTable();
				t5.clear().draw();
				
			var tt5 = $('#vocabularyDataTableSummary').DataTable();
			tt5.clear().draw();
			
				var t6 = $('#compareDataTable').DataTable();
				t6.clear().draw();
						
				if(myChart)
				{
					myChart.destroy();
				}
				
			document.getElementById("UnknownWordsTabButton").innerText="Unknown Words [4]";
			document.getElementById("LearningWordsTabButton").innerText="Learning Words [5]";
			document.getElementById("KnownWordsTabButton").innerText="Known Words [6]";
	}
	
	function openTab(evt, tabName, tabLink) {
	
	if(!initialisationComplete)
	{
		return false;
	}
	
	ShowMenu(false);
	
	if((openedTab==tabName&&(tabName=="OptionsTab"||tabName=="DictionaryTab"||tabName=="AboutTab"||tabName=="ImagesTab"||tabName=="StatisticsTab"))
	||
	((tabName=="StatisticsTab")&&(openedTab!=""&&openedTab!="OptionsTab"&&openedTab!="DictionaryTab"&&openedTab!="AboutTab"&&openedTab!="ImagesTab"))
	)
	{
		ShowSidebar(false); 
		openedTab="";
		tabcontent = document.getElementsByClassName("tabcontent");
		  for (i = 0; i < tabcontent.length; i++) {
			tabcontent[i].style.display = "none";
		  }
		  tablinks = document.getElementsByClassName(tabLink);
		  for (i = 0; i < tablinks.length; i++) {
			tablinks[i].className = tablinks[i].className.replace(" active", "");
		  }
		  return;
	}
	else
	{
		ShowSidebar(true);
		openedTab = tabName;
		  var i, tabcontent, tablinks;
		
		  tabcontent = document.getElementsByClassName("tabcontent");
		  for (i = 0; i < tabcontent.length; i++) {
			tabcontent[i].style.display = "none";
		  }
		  tablinks = document.getElementsByClassName(tabLink);
		  for (i = 0; i < tablinks.length; i++) {
			tablinks[i].className = tablinks[i].className.replace(" active", "");
		  }
		  document.getElementById(tabName).style.display = "block";
		  evt.currentTarget.className += " active";
		  
	  }
	  
	
	  
	  
	  if(tabName=="OptionsTab"||tabName=="DictionaryTab"||tabName=="AboutTab"||tabName=="ImagesTab")
	  {
		document.documentElement.style.setProperty('--tab-top-percent', '0%');
		document.documentElement.style.setProperty('--tab-bot-percent', '100%');
		/*document.getElementById("UnknownWordsTabButton").style.display="none";
		document.getElementById("KnownWordsTabButton").style.display="none";
		document.getElementById("AllWordsTabButton").style.display="none";
		document.getElementById("LearningWordsTabButton").style.display="none";
		document.getElementById("VocabularyTabButton").style.display="none";
		document.getElementById("CompareTabButton").style.display="none";
		document.getElementById("GraphTabButton").style.display="none";*/
		
	  }
	  else
	  {
	  tablinks = document.getElementsByClassName('topbarbutton');
		for (i = 0; i < tablinks.length; i++)
		{
			
			tablinks[i].className = tablinks[i].className.replace(" active", "");

			
			if(tablinks[i].id=="StatisticsTabButton")
			{
				tablinks[i].className+= " active";
			}
			
			//console.log(tablinks[i]);
			//tablinks[i].className = tablinks[i].className.replace(" active", "");
		}
	  
		document.documentElement.style.setProperty('--tab-top-percent', '15%');
		document.documentElement.style.setProperty('--tab-bot-percent', '85%');
		/*document.getElementById("UnknownWordsTabButton").style.display="block";
		document.getElementById("KnownWordsTabButton").style.display="block";
		document.getElementById("AllWordsTabButton").style.display="block";
		document.getElementById("LearningWordsTabButton").style.display="block";
			document.getElementById("VocabularyTabButton").style.display="block";
		document.getElementById("CompareTabButton").style.display="block";
		document.getElementById("GraphTabButton").style.display="block";*/
	  }
	  
	  if(tabName=="StatisticsTab")
	  {
		var button = "UnknownWordsTabButton";
		
		switch(lastUsedStatsTab)
		{
			case "LearningWordsTab": button = "LearningWordsTabButton"; break;
			case "KnownWordsTab": button = "KnownWordsTabButton"; break;
			case "AllWordsTab": button = "AllWordsTabButton"; break;
			case "VocabularyTab": button = "VocabularyTabButton"; break;
			case "CompareTab": button = "CompareTabButton"; break;
			case "GraphTab": button = "GraphTabButton"; break;
			
		}
		document.getElementById(button).click();
	  }
	  else if((tabName=="UnknownWordsTab"||tabName=="LearningWordsTab"||tabName=="KnownWordsTab"||tabName=="AllWordsTab"||tabName=="GraphTab")
	  && enableHighlighting)
	  {
		AsyncCalculateStatistics();
	  }
	  else if (tabName=="VocabularyTab" && enableHighlighting)
	  {
		var t = $('#vocabularyDataTable').DataTable();
		t.clear().draw();
	  
	  
	  					if(vocabularyTimeout)
						{	
							clearTimeout(vocabularyTimeout);
						}
						vocabularyTimeout = setTimeout(function() {
							CalculateVocabulary();
						}, 200);
						
	  }
	  else if(tabName=="CompareTab" && enableHighlighting)
	  {
		CompareVocabulary();
		
	  }
	  else if(tabName=="DictionaryTab")
	  {
		dictionaryLookup(pendingLookup);
		setTimeout(function() {RemoveSelection(0);},100);
		setTimeout(function() {RemoveSelection(0);},200);
		setTimeout(function() {RemoveSelection(0);},300);
		setTimeout(function() {RemoveSelection(0);},400);
		setTimeout(function() {RemoveSelection(0);},500);
		setTimeout(function() {RemoveSelection(0);},600);
		setTimeout(function() {RemoveSelection(0);},700);
		setTimeout(function() {RemoveSelection(0);},800);
		setTimeout(function() {RemoveSelection(0);},900);
		setTimeout(function() {RemoveSelection(0);},1000);
		setTimeout(function() {RemoveSelection(0);},1500);
		setTimeout(function() {RemoveSelection(0);},2000);
	  }
	  else if(tabName=="ImagesTab")
	  {
		imagesLookup(pendingLookup);
	  }
	  
	  switch(tabName)
	  {
			case "UnknownWordsTab": lastUsedStatsTab = "UnknownWordsTab"; break;
			case "LearningWordsTab": lastUsedStatsTab = "LearningWordsTab"; break;
			case "KnownWordsTab": lastUsedStatsTab = "KnownWordsTab"; break;
			case "AllWordsTab": lastUsedStatsTab = "AllWordsTab"; break;
			case "VocabularyTab": lastUsedStatsTab = "VocabularyTab"; break;
			case "CompareTab": lastUsedStatsTab = "CompareTab"; break;
			case "GraphTab": lastUsedStatsTab = "GraphTab"; break;
		}
	  
	  
	}
	
	
	function AsyncCalculateStatistics()
	{
						if(statisticsTimeout)
						{	
							clearTimeout(statisticsTimeout);
						}
						statisticsTimeout = setTimeout(function() {

							CalculateStatistics();
						}, global_total_words/2);
	}
	
	
	function CalculateStatistics()
	{
			var words = document.getElementById ("content").textContent;
			words=words.replace(replaceCharacters," ");
	
			var wordArray = words.trim().split(/[, ]+/);

			unknownArray = [];
			learningArray = [];
			knownArray = [];
			allArray = [];
			
			
			SortWords2(wordArray);
	}
	
	function SortWords2(wordArray)
	{
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.getAll();
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
			
	        request.onsuccess = function(event) {          
	          if(request.result) {
				data = request.result;
				var filteredWords=[];
				var filteredRemainder=[];
				
				for(var i=0;i<data.length;i++)
				{
					var remainder = data[i].appearances%3;
					if(remainder!=startingMark)
					{
						filteredWords.push(data[i].word);
						filteredRemainder.push(remainder);
					}
				}
				for(var i=0;i<wordArray.length;i++)
				{
					var index = filteredWords.indexOf(wordArray[i]);
						
					
					var remainder = filteredRemainder[index];
					
					var w = wordArray[i];
							
					if(index > -1)
					{
							
						switch(remainder)
						{
								case 0:
							var found = unknownArray.findIndex(w => w.word === wordArray[i]);
							if(found == -1)
							{
							var n = [];
							n.word = w;
							n.occurances = 1;
							n.topik="";
							unknownArray.push(n);
							}
							else
							{
							unknownArray[found].occurances++;
							}
								break;
								
								case 1: 
								var found = learningArray.findIndex(w => w.word === wordArray[i]);
							if(found == -1)
							{
							var n = [];
							n.word = w;
							n.occurances = 1;
							n.topik="";
							learningArray.push(n);
							}
							else
							{
							learningArray[found].occurances++;
							}
								
								break;
								case 2:
								var found = knownArray.findIndex(w => w.word === wordArray[i]);
							if(found == -1)
							{
							var n = [];
							n.word = w;
							n.occurances = 1;
							n.topik="";
							knownArray.push(n);
							}
							else
							{
							knownArray[found].occurances++;
							}
								break;
						}
					}
					else
					{
							switch(startingMark)
							{
								case 0:
									var found = unknownArray.findIndex(w => w.word === wordArray[i]);
									if(found == -1)
									{
									var n = [];
									n.word = w;
									n.occurances = 1;
									n.topik="";
									unknownArray.push(n);
									}
									else
									{
									unknownArray[found].occurances++;
									}
								break;
																case 1:
									var found = learningArray.findIndex(w => w.word === wordArray[i]);
									if(found == -1)
									{
									var n = [];
									n.word = w;
									n.occurances = 1;
									n.topik="";
									learningArray.push(n);
									}
									else
									{
									learningArray[found].occurances++;
									}
								break;
																case 2:
									var found = knownArray.findIndex(w => w.word === wordArray[i]);
									if(found == -1)
									{
									var n = [];
									n.word = w;
									n.occurances = 1;
									n.topik="";
									knownArray.push(n);
									}
									else
									{
									knownArray[found].occurances++;
									}
								break;
							}
					}

					
				}

				DisplaySort();
			  }
	        };
	}
	
	function CalculateVocabulary()
	{
			var t = $('#vocabularyDataTable').DataTable();
			var tt = $('#vocabularyDataTableSummary').DataTable();
	
			t.clear().draw();
			tt.clear().draw();
			
			var arrLearning = [];
			var arrKnown = [];
			var arrUnknown = [];
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.getAll();
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
	        request.onsuccess = function(event) {  
	          if(request.result) {
			  		var req = request.result;
					for(var i=0;i<req.length;i++)
					{
						var w = req[i].word;
						var a = req[i].appearances;
						
						if(!w.includes("$"))
						{
							
							var remainder = a%3;
							if(remainder==0)
								{
								arrUnknown.push(w);
								
								t.row.add( [
								w,"Unknown"] );
							}
							else if(remainder==1)
								{
								arrLearning.push(w);
								
								t.row.add( [
								w,"Learning"] );
							}
							else if(remainder==2)
							{
								arrKnown.push(w);
								
								t.row.add( [
								w,"Known"] );
							}
						}
				  }
				  			tt.clear().draw();
			tt.row.add( [
	            arrUnknown.length,arrLearning.length, arrKnown.length,arrUnknown.length+arrKnown.length+arrLearning.length, arrKnown.length+arrLearning.length
	        ] );
				  
				  tt.draw();
				  t.draw();
			  }
			  
			  
			  };
	}
	
	function GetTopikName(index)
	{
		var name;
		switch(index)
		{
			case 0: name = "TOPIK I"; break;
			case 1: name = "TOPIK II"; break;
			case 2: name = "(S)-TOPIK 1"; break;
			case 3: name = "(S)-TOPIK 2"; break;
			case 4: name = "(S)-TOPIK 3"; break;
			default: name = "";
		}
		return name;
	}
	
	function DisplaySort()
	{
	
	
	
		const numberOfLists = 2;
	
		var topikList = [];
		
					
		for(var i=0;i<numberOfLists;i++)
		{
			topikList[i] = [];
			var list = [];
			
			switch(i)
			{
				case 0: list = topikI();break;
				case 1: list = topikII();break;
			}
			
			for(var j=0;j<list.length;j++)
			{
				topikList[i].push(list[j].w);
			}
		}
		
		
		var unknownCount=0;
		var knownCount=0;
		var learningCount=0;
		
		for(var i=0;i<unknownArray.length;i++)
		{
			unknownCount+=unknownArray[i].occurances;
			
			
			for(var j=topikList.length-1;j>-1;j--)
			{
				if(topikList[j].includes(unknownArray[i].word))
				{
					unknownArray[i].topik = GetTopikName(j);
				}
			}
		}
			for(var i=0;i<learningArray.length;i++)
		{
			learningCount+=learningArray[i].occurances;
			
			for(var j=topikList.length-1;j>-1;j--)
			{
				if(topikList[j].includes(learningArray[i].word))
				{
					
					learningArray[i].topik = GetTopikName(j);
				}
			}
		}
			for(var i=0;i<knownArray.length;i++)
		{
			knownCount+=knownArray[i].occurances;
			
			for(var j=topikList.length-1;j>-1;j--)
			{
				if(topikList[j].includes(knownArray[i].word))
				{
					
					knownArray[i].topik = GetTopikName(j);
				}
			}  
		}
		
		allArray = knownArray.concat(learningArray).concat(unknownArray);
		
		var totalWords = knownCount + learningCount + unknownCount;
		
		global_total_words = allArray.length;
		
		var percentUnknown = Math.round(((unknownCount/totalWords)*100 + Number.EPSILON) * 100) / 100;
		var percentLearning = Math.round(((learningCount/totalWords)*100 + Number.EPSILON) * 100) / 100;
		var percentKnown = Math.round(((knownCount/totalWords)*100 + Number.EPSILON) * 100) / 100;
		
		var percentUniqueUnknown = Math.round(((unknownArray.length/allArray.length)*100 + Number.EPSILON) * 100) / 100;
		var percentUniqueLearning = Math.round(((learningArray.length/allArray.length)*100 + Number.EPSILON) * 100) / 100;
		var percentUniqueKnown = Math.round(((knownArray.length/allArray.length)*100 + Number.EPSILON) * 100) / 100;
	
		document.getElementById("UnknownWordsTabButton").innerText="Unknown Words ("+percentUnknown+"%) [4]";
		document.getElementById("LearningWordsTabButton").innerText="Learning Words ("+percentLearning+"%) [5]";
		document.getElementById("KnownWordsTabButton").innerText="Known Words ("+percentKnown+"%) [6]";
		
		if((lastUsedStatsTab=="UnknownWordsTab"&&!unknownWordsTabUpToDate)||(openedTab=="UnknownWordsTab"&&!unknownWordsTabUpToDate))
		{
			var tt = $('#unknownWordsDataTableSummary').DataTable();
			tt.clear();
			tt.row.add( [
	            unknownCount + " ("+percentUnknown+"%)",totalWords,unknownArray.length+" ("+percentUniqueUnknown+"%)",allArray.length
	        ] );	
			
			var t = $('#unknownWordsDataTable').DataTable();
			t.clear();
	
			for(var i=0;i<unknownArray.length;i++)
			{
				var wordPercent = Math.round(((unknownArray[i].occurances/totalWords)*100 + Number.EPSILON) * 100) / 100; 
				t.row.add( [
	            unknownArray[i].occurances,unknownArray[i].word,wordPercent+"%",unknownArray[i].topik
	        ] );
			}
			tt.draw();
			t.draw();
			unknownWordsTabUpToDate = true;
		}
		if((lastUsedStatsTab=="LearningWordsTab"&&!learningWordsTabUpToDate)||(openedTab=="LearningWordsTab"&&!learningWordsTabUpToDate))
		{
		
				var tt2 = $('#learningWordsDataTableSummary').DataTable();
			tt2.clear();
			tt2.row.add( [
	            learningCount + " ("+percentLearning+"%)",totalWords,learningArray.length+" ("+percentUniqueLearning+"%)",allArray.length
	        ] );	
			
					var t2 = $('#learningWordsDataTable').DataTable();
			t2.clear();
	
			for(var i=0;i<learningArray.length;i++)
			{
			var wordPercent = Math.round(((learningArray[i].occurances/totalWords)*100 + Number.EPSILON) * 100) / 100; 
				
				t2.row.add( [
	            learningArray[i].occurances,learningArray[i].word,""+wordPercent+"%",learningArray[i].topik
	        ] );
			}
			tt2.draw();
			t2.draw();
			learningWordsTabUpToDate = true;
		}
		if((lastUsedStatsTab=="KnownWordsTab"&&!knownWordsTabUpToDate)||(openedTab=="KnownWordsTab"&&!knownWordsTabUpToDate))
		{
						var tt3 = $('#knownWordsDataTableSummary').DataTable();
			tt3.clear();
			tt3.row.add( [
	            knownCount+ " ("+percentKnown+"%)",totalWords,knownArray.length+" ("+percentUniqueKnown+"%)",allArray.length
	        ] );	
					var t3 = $('#knownWordsDataTable').DataTable();
			t3.clear();
	
			for(var i=0;i<knownArray.length;i++)
			{
			var wordPercent = Math.round(((knownArray[i].occurances/totalWords)*100 + Number.EPSILON) * 100) / 100; 
				
				t3.row.add( [
	            knownArray[i].occurances,knownArray[i].word,""+wordPercent+"%",knownArray[i].topik
	        ] );
			}
			tt3.draw();
			t3.draw();
			knownWordsTabUpToDate = true;
		}
		if((lastUsedStatsTab=="AllWordsTab"&&!allWordsTabUpToDate)||(openedTab=="AllWordsTab"&&!allWordsTabUpToDate))
		{
				var tt4 = $('#allWordsDataTableSummary').DataTable();
			tt4.clear();
			tt4.row.add( [
	            totalWords,allArray.length
	        ] );	
		
					var t4 = $('#allWordsDataTable').DataTable();
			t4.clear();
	
			if(printJSON)
				{
					var json=[];
				}						
			for(var i=0;i<allArray.length;i++)
			{
			var wordPercent = Math.round(((allArray[i].occurances/totalWords)*100 + Number.EPSILON) * 100) / 100; 
				
				t4.row.add( [
	            allArray[i].occurances,allArray[i].word,""+wordPercent+"%",allArray[i].topik
				] );
				
				if(printJSON)
				{ 
					var ww = {o:allArray[i].occurances,w:allArray[i].word};
					json.push(ww); 
				}
			}
			
			if(printJSON)
				{
					console.log(json);
				}	
				
			tt4.draw();
			t4.draw();
			allWordsTabUpToDate = true;
		}
		if(openedTab=="GraphTab")
		{
			CreateGraph(allArray,knownArray.concat(learningArray));
		}
		if(openedTab=="VocabularyTab")
		{
			if(vocabularyTimeout)
						{	
							clearTimeout(vocabularyTimeout);
						}
						vocabularyTimeout = setTimeout(function() {
							CalculateVocabulary();
						}, 200);
		}
	}
	
	function OnInput()
	{
		var pasteArea = document.getElementById ("pasteArea");
	
		clearTimeout(colourTimeout);
			clearTimeout(scrollTimeout);
			clearTimeout(vocabularyTimeout);
			clearTimeout(displaySortTimeout);
			clearTimeout(statisticsTimeout);
			clearTimeout(highlightTimeout);	
			clearTimeout(unmarkJumpTimeout);
			clearTimeout(calculateStatisticsTimeout);
	
		if(enableHighlighting)
		{
			var divs = document.getElementsByClassName("individualPage");
			for(var i=0;i<divs.length;i++)
			{
				divs[i].marked=false;
			}
			
			unmark();
			var pasteArea = document.getElementById ("pasteArea");
			pasteArea.style.fontSize = fontSize+"em";
			SaveHTML(pasteArea.innerHTML);
			paginate();
			onScroll();
			unknownWordsTabUpToDate = false;
			learningWordsTabUpToDate = false;
			knownWordsTabUpToDate = false;
			allWordsTabUpToDate = false;
			AsyncCalculateStatistics();
		}
		else
		{
			var pasteArea = document.getElementById ("pasteArea");
			pasteArea.style.fontSize = fontSize+"em";
			SaveHTML(pasteArea.innerHTML);
		}
		
		var innerhtml = document.getElementById("pasteArea").innerHTML;
		if(innerhtml.length<100)
		{
			innerhtml=innerhtml.replace(replaceCharacters,"");
			if(innerhtml=="")
			{
				document.getElementById ("pasteArea").innerHTML="";
			}
		}
	}
	
	function LoadHTML()
	{
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("html$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {
				if(request.result) {
						var a = request.result.appearances;
											
						if(a) 
						{
							
							document.getElementById ("pasteArea").innerHTML=a;

								var $div = $('.romanisedText');
								$div.empty();

							OnInput();
						}
					}
				};
	}
	
	function SaveHTML(html)
	{
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("html$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "html$",appearances: html});
					}
					else
					{
						addwordtodb("html$",html);
					}
				}
	}

		function GetPage(index)
		{
			var divs = document.getElementsByClassName("individualPage");
			
			return(divs[index]);
	
		}
		
		function scrollOperation()
		{
			var pageTop = $(window).scrollTop();
				var pageBot = pageTop + $(window).height();
				
	
				
				var divs = document.getElementsByClassName("individualPage");
					var toMark = [];
					for(var i=0;i<divs.length;i++)
					{
						var divTop = divs[i].offsetTop;
						var divBot = divTop+divs[i].offsetHeight;
	
						if(divBot>pageTop-650&&divTop<pageBot+650)
						{
							if(divs[i].marked==false||divs[i].marked==null)
							{	
								divs[i].marked=false;
								toMark.push(i);
							}
						}
						else
						{
							divs[i].marked=false;
						}
					}
					
					
					
						if(enableHighlighting&&toMark.length>0)
						{
							if(colourTimeout)
							{
								clearTimeout(colourTimeout);
							}		
							colourTimeout = setTimeout(markAll(toMark),20);
							
							if(openedTab=="VocabularyTab")
							{
								if(vocabularyTimeout)
								{
									clearTimeout(vocabularyTimeout);
								}	
								vocabularyTimeout = setTimeout(function() {
									CalculateVocabulary();
								}, 500);
							}
						}
		}
	
		function onScroll()
		{
				if(scrollTimeout)
				{
					clearTimeout(scrollTimeout);
				}
									
				scrollTimeout = setTimeout(scrollOperation(),400);
		}
		
		
	function RomaniseText(t)
	{
		return(Aromanize.hangulToLatin(t, 'rr-translit'));
	}
	
	String.prototype.isEmpty = function() 
				{
					return (this.length === 0 || !this.trim());
				};
	
	function paginate() {
		var b = document.getElementsByClassName('individualPage');
		var pasteArea = document.getElementById("pasteArea");
		
		var $div = $('.romanisedText');
		$div.empty();
	
		
		while(b.length) {
			var parent = b[ 0 ].parentNode;
			while( b[ 0 ].firstChild ) {
				parent.insertBefore(  b[ 0 ].firstChild, b[ 0 ] );
			}
			 parent.removeChild( b[ 0 ] );
		}

		var oldHTML = pasteArea.innerText;
		var replace = /[\n]/g;
		var split = oldHTML.replace(replace,'<br>');
		split = split.split('<br>');
		var newHTML = "";
		for(var i=0;i<split.length;i++)
		{
			if(split[i].length>0)
			{
				var words = split[i];
				
				if(!words.isEmpty())
				{
					
					newHTML = newHTML + '<div class="individualPage">'+words+'<br></div>';
					
					if(romanisationMode==1)
					{
						newHTML = newHTML + '<div class="romanisedText" style="color:blue">' + RomaniseText(words) +'</div>';
					}
					newHTML+='<br>';
				}
			}
		}

		pasteArea.innerHTML = newHTML ;
	}
	
	function ChangeFont()
	{
		var mySelect = document.getElementById('fontSizeOption');
		fontSize = mySelect.value;
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("fontSize$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "fontSize$",appearances: mySelect.value});
					}
					else
					{
						addwordtodb("fontSize$",mySelect.value);
					}
				}
				var pasteArea = document.getElementById ("pasteArea");
			pasteArea.style.fontSize = fontSize+"em";
				//OnInput();
	}
	
	function ChangeRomanisation()
	{
		var mySelect = document.getElementById('romanisationOption');
		switch(mySelect.value)
		{
			case "Off": romanisationMode = 0; break;
			case "On": romanisationMode = 1; break;
			default: romanisationMode = 0;
		}
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("romanisationOption$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "romanisationOption$",appearances: mySelect.value});
					}
					else
					{
						addwordtodb("romanisationOption$",mySelect.value);
					}
				}
				
				if(romanisationMode==0)
							{
								var $div = $('.romanisedText');
								$div.empty();
							}
				
				OnInput();
	}
	
	function InitialiseRomanisation()
	{
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("romanisationOption$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				var dropDown = document.getElementById("romanisationOption");
					
				request.onsuccess = function(event) {
				if(request.result) {
						var a = request.result.appearances;
						switch(a)
						{
						case "Off": romanisationMode = 0; dropDown.value = "Off"; break;
						case "On": romanisationMode = 1; dropDown.value = "On"; break;
						default: romanisationMode = 0; dropDown.value = "Off";;					
						}					
					}
					else
					{
						romanisationMode = 0;
						dropDown.value = "Off";
					}
				}
	}
	
	function InitialiseFontSize()
	{
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("fontSize$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
					
					
				request.onsuccess = function(event) {
				if(request.result) {
						var a = request.result.appearances;
											
						if(a>0) 
						{
							fontSize = a;
						}
						else
						{
							fontSize = fontSizeDefault;
						}
					}
					else
					{
						fontSize = fontSizeDefault;
					}
					var dropDown = document.getElementById("fontSizeOption");
					dropDown.value = fontSize;
				};
	}
	
	
	function InitialiseHighlightingKnown()
	{
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("highlightingknown$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {
				if(request.result) {
				var a = request.result.appearances;
					if(a==0)
					{
						document.getElementById("enableHighlightingKnown").checked = false;
						SetHighlightingKnown(false,true);
						
						
					}
					else
					{
						document.getElementById("enableHighlightingKnown").checked = true;
					}
			}
					else
					{
						document.getElementById("enableHighlightingKnown").checked = true;
					}
			};		
	}
	
	function ToggleEnableHighlightingKnown()
	{
		//console.log(document.getElementById("enableHighlightingKnown").checked);
		if(document.getElementById("enableHighlightingKnown").checked)
			{
				SetHighlightingKnown(true, true);
				
						
			}
			else
			{
				SetHighlightingKnown(false, true);
			}
	}
	
	function SetHighlightingKnown(activated,reInitialise)
	{
		if(activated)
		{
							var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("highlightingknown$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "highlightingknown$",appearances: 1});
					}
					else
					{
						addwordtodb("highlightingknown$",1);
					}
					
				}
				if(reInitialise)
				{
					InitialiseColourInputField();
				}
		}
		else
		{
							var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("highlightingknown$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "highlightingknown$",appearances: 0});
					}
					else
					{
						addwordtodb("highlightingknown$",0);
					}
					var documentColour = getComputedStyle(document.documentElement).getPropertyValue('--editcell-bg')
					document.documentElement.style.setProperty('--tertiary-bg', documentColour);
				}
		}
	}
	
	
	function InitialiseColourInputField()
	{
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
			
			var request = objectStore.get("primaryField$");
			request.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
				request.onsuccess = function(event) 
				{
				if(request.result) {
				var a = request.result.appearances;
						if(a)
						{		
							colourPrimary=a;
						}
						else
						{
							colourPrimary=colourPrimaryDefault;
						}
					}
					else
					{
						colourPrimary=colourPrimaryDefault;
					}
						var primaryField = document.getElementById("fieldHC1");
						primaryField.value = colourPrimary;
						primaryField.style.backgroundColor=colourPrimary;
						document.documentElement.style.setProperty('--primary-bg', colourPrimary);
				};
			var objectStore2 = db.transaction(["wordsdb"]).objectStore("wordsdb");	
			var request2 = objectStore2.get("secondaryField$");
			request2.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
				request2.onsuccess = function(event) 
				{
				if(request2.result) {
						var a = request2.result.appearances;
						if(a)
						{	
							colourSecondary=a;
						}
						else
						{
							colourSecondary=colourSecondaryDefault;
						}
					}
					else
					{
						colourSecondary=colourSecondaryDefault;
					}
						var secondaryField = document.getElementById("fieldHC2");
		secondaryField.value = colourSecondary;
		secondaryField.style.backgroundColor=colourSecondary;
		document.documentElement.style.setProperty('--secondary-bg', colourSecondary);
				};
			var objectStore3 = db.transaction(["wordsdb"]).objectStore("wordsdb");	
			var request3 = objectStore3.get("tertiaryField$");
			request3.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
				request3.onsuccess = function(event) 
				{
				if(request3.result) {
						var a = request3.result.appearances;
						if(a)
						{
									
							colourTertiary=a;
						}
						else
						{
							colourTertiary=colourTertiaryDefault;
						}
					}
					else
					{
						colourTertiary=colourTertiaryDefault;
					}
						var tertiaryField = document.getElementById("fieldHC3");
		tertiaryField.value = colourTertiary;
		tertiaryField.style.backgroundColor=colourTertiary;
		document.documentElement.style.setProperty('--tertiary-bg', colourTertiary);
				};
			var objectStore4 = db.transaction(["wordsdb"]).objectStore("wordsdb");	
			var request4 = objectStore4.get("jumpField$");
			request4.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
				request4.onsuccess = function(event) 
				{
				if(request4.result) {
				var a = request4.result.appearances;
				
						if(a)
						{
									
							colourJump=a;
						}
						else
						{
							colourJump=colourJumpDefault;
						}
					}
					else
					{
						colourJump=colourJumpDefault;
					}
						var jumpField = document.getElementById("fieldHC4");
		jumpField.value = colourJump;
		jumpField.style.backgroundColor=colourJump;
		document.documentElement.style.setProperty('--jump-bg', colourJump);
				};
	}
	
	function ValidateColour(c)
	{
		return(/^#([0-9A-F]{3}){1,2}$/i.test(c));
	}
	
	function HC1Submit()
	{
		var primaryField = document.getElementById("fieldHC1");
		if(ValidateColour(primaryField.value))
		{
			colourPrimary=primaryField.value;
		}
		else
		{
			colourPrimary=colourPrimaryDefault;
		}
		
		primaryField.value = colourPrimary;
		primaryField.style.backgroundColor=colourPrimary;
		document.documentElement.style.setProperty('--primary-bg', colourPrimary);
		
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("primaryField$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "primaryField$",appearances: colourPrimary});
					}
					else
					{
						addwordtodb("primaryField$",colourPrimary);
					}
				}
	}
	
	function HC2Submit()
	{
			var secondaryField = document.getElementById("fieldHC2");
		if(ValidateColour(secondaryField.value))
		{
			colourSecondary=secondaryField.value;
		}
		else
		{
			colourSecondary=colourSecondaryDefault;
		}
		
		secondaryField.value = colourSecondary;
		secondaryField.style.backgroundColor=colourSecondary;
		document.documentElement.style.setProperty('--secondary-bg', colourSecondary);
		
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("secondaryField$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "secondaryField$",appearances: colourSecondary});
					}
					else
					{
						addwordtodb("secondaryField$",colourSecondary);
					}
				}
	}
	
	function HC3Submit()
	{
			var tertiaryField = document.getElementById("fieldHC3");
		if(ValidateColour(tertiaryField.value))
		{
			colourTertiary=tertiaryField.value;
		}
		else
		{
			colourTertiary=colourTertiaryDefault;
		}
		tertiaryField.value = colourTertiary;
		tertiaryField.style.backgroundColor=colourTertiary;
		document.documentElement.style.setProperty('--tertiary-bg', colourTertiary);
		
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("tertiaryField$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "tertiaryField$",appearances: colourTertiary});
					}
					else
					{
						addwordtodb("tertiaryField$",colourTertiary);
					}
				}
				document.getElementById("enableHighlightingKnown").checked = true;
				SetHighlightingKnown(true,false);
	}
	
	function HC4Submit()
	{
			var jumpField = document.getElementById("fieldHC4");
		if(ValidateColour(jumpField.value))
		{
			colourJump=jumpField.value;
		}
		else
		{
			colourJump=colourJumpDefault;
		}
		
		jumpField.value = colourJump;
		jumpField.style.backgroundColor=colourJump;
		document.documentElement.style.setProperty('--jump-bg', colourJump);
		
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("jumpField$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "jumpField$",appearances: colourJump});
					}
					else
					{
						addwordtodb("jumpField$",colourJump);
					}
				}
	}
	
	function ChangeVoice()
	{
		var mySelect = document.getElementById('voiceOption');
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("voice$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "voice$",appearances: mySelect.value});
					}
					else
					{
						addwordtodb("voice$",mySelect.value);
					}
				}
	}
	
	function QuickSortWords(word,appearances,last,listName,index,unknownArrayCompare,learningArrayCompare,knownArrayCompare,allArrayCompare)
	{
	
			
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.get(word);
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
	        request.onsuccess = function(event) {          
	          if(request.result) {
			  
					var w = request.result.word;
					var a = request.result.appearances;
					var remainder = a%3;
					if(remainder==0)
					{
						const found = unknownArrayCompare.findIndex(w => w.word === word);
						if(found == -1)
						{
						var n = [];
						n.word = w;
						n.occurances = appearances;
						unknownArrayCompare.push(n);
						}
						else
						{
						unknownArrayCompare[found].occurances+=appearances;
						}
					}
					else if(remainder==1)
					{
						const found = learningArrayCompare.findIndex(w => w.word === word);
						if(found == -1)
						{
						var n = [];
						n.word = w;
						n.occurances = appearances;
						learningArrayCompare.push(n);
						}
						else
						{
						learningArrayCompare[found].occurances+=appearances;
						}
					}
					else if(remainder==2)
					{
						const found = knownArrayCompare.findIndex(w => w.word === word);
						if(found == -1)
						{
						var n = [];
						n.word = w;
						n.occurances = appearances;
						knownArrayCompare.push(n);
						}
						else
						{
						knownArrayCompare[found].occurances+=appearances;
						}
					}
	
	          } 
			  else 
			  {
						var n = [];
						n.word = word;
						n.occurances = appearances;
						unknownArrayCompare.push(n);
	          }
			  
			  if(last)
			  {
					allArrayCompare = knownArrayCompare.concat(learningArrayCompare).concat(unknownArrayCompare);
					//if(displayComparisonTimeout)
					//{	
					//	clearTimeout(displayComparisonTimeout);
					//}
					displayComparisonTimeout = setTimeout(function() {
					  DisplayComparison(listName,index,unknownArrayCompare,learningArrayCompare,knownArrayCompare,allArrayCompare);
					}, 50);
			  }
	        };
			
	}
	
	  
	function CompareVocabulary()
	{
			if(statisticsTimeout)
			{	
				clearTimeout(statisticsTimeout);
			}
	
			
				

					if(compareLoop==false)
					{
						var t = $('#compareDataTable').DataTable();
					t.clear().draw();
					  CompareLoop(0);
					}
	}
	
	function CompareLoop(index)
	{ 
		compareLoop=true;
		var list;
		var name = GetTopikName(index);

		switch(index)
		{
			case 0: list = topikI(); break;
			case 1: list = topikII(); break;
			case 2: list = stopik1(); break;
			case 3: list = stopik2(); break;
			case 4: list = stopik3(); break;
			default: compareLoop=false; index=-1;
		}
		
		if(index!=-1)
		{
				var unknownArrayCompare = [];
				var learningArrayCompare = [];
				var knownArrayCompare = [];
				var allArrayCompare = [];
			
			for(var i=0;i<list.length;i++)
			{
				//var splitList = list[i].split(' ');
				
				if(list.length-1==i)
					{
						QuickSortWords(list[i].w,list[i].o,true,name,index,unknownArrayCompare,learningArrayCompare,knownArrayCompare,allArrayCompare);
					}
					else{
						QuickSortWords(list[i].w,list[i].o,false,name,index,unknownArrayCompare,learningArrayCompare,knownArrayCompare,allArrayCompare);
					}
				
			}
		}
	}

	function DisplayComparison(listName, index,unknownArrayCompare,learningArrayCompare,knownArrayCompare,allArrayCompare)
	{
			var unknownCount=0;
		var knownCount=0;
		var learningCount=0;
		
		for(var i=0;i<unknownArrayCompare.length;i++)
		{
			unknownCount+=unknownArrayCompare[i].occurances;
		}
			for(var i=0;i<learningArrayCompare.length;i++)
		{
			learningCount+=learningArrayCompare[i].occurances;
		}
			for(var i=0;i<knownArrayCompare.length;i++)
		{
			knownCount+=knownArrayCompare[i].occurances;
		}
		
		var totalWords = knownCount + learningCount + unknownCount;
		
		var percentUnknown = Math.round(((unknownCount/totalWords)*100 + Number.EPSILON) * 100) / 100;
		var percentLearning = Math.round(((learningCount/totalWords)*100 + Number.EPSILON) * 100) / 100;
		var percentKnown = Math.round(((knownCount/totalWords)*100 + Number.EPSILON) * 100) / 100;
		
		var percentUniqueUnknown = Math.round(((unknownArrayCompare.length/allArrayCompare.length)*100 + Number.EPSILON) * 100) / 100;
				var t = $('#compareDataTable').DataTable();
				t.row.add( [
	            listName,percentUnknown,percentLearning,percentKnown,
				unknownArrayCompare.length +" ("+percentUniqueUnknown+"%)",allArrayCompare.length
	        ] );
			
			t.draw();
			CompareLoop(index+1);
	}
	
	function ChangeFontType()
	{
		var mySelect = document.getElementById('fontTypeOption');
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("fonttype$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {          
					if(request.result)
					{
						request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "fonttype$",appearances: mySelect.value});
					}
					else
					{
						addwordtodb("fonttype$",mySelect.value);
					}
				}
			document.documentElement.style.setProperty('--font-type', mySelect.value);
		
	}
	
	function ChangeDictLanguage()
	{
		var mySelect = document.getElementById('dictLanguageOption');
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("dictlanguage$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {          
					if(request.result)
					{
						request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "dictlanguage$",appearances: mySelect.value});
					}
					else
					{
						addwordtodb("dictlanguage$",mySelect.value);	
					}
					dictionaryLanguage = mySelect.value;
				}
			dictionaryLookingUp="";
	}
	
	function OnResize()
	{
		var c = document.getElementsByClassName("wrapper3");
		//c[0].style.height = "100%"; // $('#topbar').height()
		//c[0].style.height = (window.innerHeight-$('#topbar').height()-(window.innerHeight-$('#topbar').height()))+"px";
		c[0].style.height = (window.innerHeight-(window.innerHeight*.05)-38)+"px";
	}
	
	function ToggleOpenMenu()
	{

	
		if(menuVisible)
		{
			ShowMenu(false)
			
		}
		else
		{
			ShowMenu(true)
		}
	
	}
	
		function ShowMenu(show)
	{
		if(show)
		{
			var tablinks = document.getElementsByClassName('topbarbutton');
			
			//if(openedTab!="OptionsTab"&&openedTab!="AboutTab")
			//{
				//for (i = 0; i < tablinks.length; i++)
				//{
				//	tablinks[i].className = tablinks[i].className.replace(" active", "");
				//	openedTab="";
				//}
			//}
			
			
			//ShowSidebar(false);
			document.getElementById("menu").style.visibility="visible";
			menuVisible = true;
			
			
		}
		else
		{
			//var tablinks = document.getElementsByClassName('topbarbutton');
			//for (i = 0; i < tablinks.length; i++)
			//{
				
			//	tablinks[i].className = tablinks[i].className.replace(" active", "");
				
			//}
		
			document.getElementById("menu").style.visibility="hidden";
			menuVisible = false;
		}
	
	}

	function ShowSidebar(show)
	{
		if(show&&!sidebarVisible)
		{
			document.getElementById("sidebar2").style.display="block";
			sidebarVisible = true;
			document.documentElement.style.setProperty('--pasteArea-percent', '70%');
			
		}
		else if(!show&&sidebarVisible)
		{
			document.getElementById("sidebar2").style.display="none";
			sidebarVisible = false;
			document.documentElement.style.setProperty('--pasteArea-percent', '100%');
		}
	}
function InitialiseStartingMark()
{
		var dropDown = document.getElementById("startingMarkOption");
		dropDown.value = "Unknown";
		
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("startingmark$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
					
				//console.log("here1");
				request.onsuccess = function(event) {
				if(request.result) {
				//console.log("here2 "+a);
						var a = request.result.appearances;
											
						startingMark = a;
					}
					else
					{
						//console.log("here3");
						addwordtodb("startingmark$",startingMarkDefault);
						startingMark = startingMarkDefault;
					}
					
					var dropDownValue = "Unknown";
					switch(startingMark)
					{
						case 0: dropDownValue = "Unknown"; break;
						case 1: dropDownValue = "Learning"; break;
						case 2: dropDownValue = "Known"; break;
						default: dropDownValue = "Unknown"; 
					}
					
					dropDown.value = dropDownValue;
				};
}

function DeleteAllVocabulary()
{
	/*for(var i=0;i<selectedVocabulary.length;i++)
					{
						var transaction = db.transaction(["wordsdb"], "readwrite");
						transaction.onerror = function(event) {
							console.log('Transaction not opened due to error: ' + transaction.error);
						  };
						var objectStore = transaction.objectStore("wordsdb");
						var objectStoreRequest = objectStore.delete(selectedVocabulary[i]);
					}
					*/
					
					//console.log("here1");
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.getAll();
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
			var selectedVocab=[];
	        request.onsuccess = function(event) {  
	          if(request.result) {
			  		var req = request.result;
					//console.log("here2 "+req.length);
					for(var i=0;i<req.length;i++)
					{
						var w = req[i].word;
						//var a = req[i].appearances;
						//console.log(w);
						if(!w.includes("$"))
						{
							selectedVocab.push(w);
							//console.log('here2');
							/*
							var remainder = a%3;
								if(remainder==1)
								{
								arrLearning.push(w);
								
								t.row.add( [
								w,"Learning"] );
							}
							else if(remainder==2)
							{
								arrKnown.push(w);
								
								t.row.add( [
								w,"Known"] );
							}
							*/
						}
				  }
			  }
			  
					for(var i=0;i<selectedVocab.length;i++)
					{
					//console.log("deleting word "+selectedVocab[i]);
						var transaction2 = db.transaction(["wordsdb"], "readwrite");
						transaction2.onerror = function(event) {
							//console.log('Transaction not opened due to error: ' + transaction2.error);
						  };
						var objectStore2 = transaction2.objectStore("wordsdb");
						var objectStoreRequest2 = objectStore2.delete(selectedVocab[i]);
					}
					OnInput();					
			  };
									
					
}


function ChangeStartingMark()
{
		var mySelect = document.getElementById('startingMarkOption');
		var s = mySelect.value;
		var sIndex = 0;
		//var toDelete = false;
		
		switch(s)
		{
						case "Unknown": sIndex = 0;  break;
						case "Learning": sIndex = 1; break;
						case "Known": sIndex = 2; break;
						default: sIndex = 0; 
		}
		//console.log(sIndex +" "+startingMark);
		
		//console.log(sIndex);
		
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("startingmark$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {          
					if(request.result) {
					//console.log("putting word "+sIndex);
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "startingmark$",appearances: sIndex});
					}
					else
					{
						//console.log("adding to db "+sIndex);
						addwordtodb("startingmark$",sIndex);
					}
				}
				startingMark = sIndex;
				unknownWordsTabUpToDate = false;
				learningWordsTabUpToDate = false;
				knownWordsTabUpToDate = false;
				//if(toDelete)
				//{
				//	DeleteAllVocabulary();
				//}
				
}
	</script>
</head>

<body onload="BrowserCheck()" id="body" onscroll="onScroll()">
	
	 
	 
	 
	<div class="wrapper">
		<div class="box content" id="content">
			<div class="editCell " contentEditable="false" data-text="Paste text here" id="pasteArea" type="text" oninput="OnInput()">
			</div>


		</div>
		
		
		<div class="box sidebar2 topright" id="sidebar2">
			<div class="wrapper3">
				<div class="tab">
			<!--		<div class="tab1">
						<button class="tablinks" id="DictionaryTabButton" onclick="openTab(event, 'DictionaryTab')">[1] Dictionary</button>
						<button class="tablinks" id="ImagesTabButton" onclick="openTab(event, 'ImagesTab')">[2] Images</button>
						<button class="tablinks" id="StatisticsTabButton" onclick="openTab(event, 'StatisticsTab')">[3] Statistics ‚ñº</button>
						<button class="tablinks" id="OptionsTabButton" onclick="openTab(event, 'OptionsTab')">Options</button>
						<button class="tablinks" id="AboutTabButton" onclick="openTab(event, 'AboutTab')">About</button>
					</div>
			-->
					<div class="tab2">
						<button id="UnknownWordsTabButton" class="tablinks" onclick="openTab(event, 'UnknownWordsTab','tablinks')">Unknown Words [4]</button>
						<button id="LearningWordsTabButton" class="tablinks"  onclick="openTab(event, 'LearningWordsTab','tablinks')">Learning Words [5]</button>
						<button id="KnownWordsTabButton" class="tablinks"  onclick="openTab(event, 'KnownWordsTab','tablinks')">Known Words [6]</button>
						<button id="AllWordsTabButton" class="tablinks"  onclick="openTab(event, 'AllWordsTab','tablinks')">All Words [7]</button>
						<button id="VocabularyTabButton" class="tablinks"  onclick="openTab(event, 'VocabularyTab','tablinks')">Vocabulary [8]</button>
					</div>
					<div class="tab3">
						<button id="CompareTabButton" class="tablinks"onclick="openTab(event, 'CompareTab','tablinks')">TOPIK [9]</button>
						<button id="GraphTabButton" class="tablinks" onclick="openTab(event, 'GraphTab','tablinks')">Graph - Current Text [0]</button>
					</div>
				</div>
				<div class="tabContainer">
					<div id="DictionaryTab" class="tabcontent">
						<iframe id="naverIframe" src="https://upload.wikimedia.org/wikipedia/commons/2/23/Naver_Logotype.svg"></iframe>
					</div>
					<div id="ImagesTab" class="tabcontent">
						<iframe id="imagesIframe" src="https://www.bing.com/images"></iframe>
					</div>
					<div id="StatisticsTab" class="tabcontent"></div>
					<div id="UnknownWordsTab" class="tabcontent">
						<h4>List of unknown words from the current text.</h4>
						<table id="unknownWordsDataTable" class="cell-border compact hover" width="100%"></table>
						<br>
						<table id="unknownWordsDataTableSummary" class="cell-border compact" width="100%"></table>
						
					</div>
					<div id="KnownWordsTab" class="tabcontent">
						<h4>List of known words from the current text.</h4>
						<table id="knownWordsDataTable" class="cell-border compact hover" width="100%"></table>
						<br>
						<table id="knownWordsDataTableSummary" class="cell-border compact" width="100%"></table>
						
					</div>
					<div id="LearningWordsTab" class="tabcontent">
						<h4>List of learning words from the current text.</h4>
						<table id="learningWordsDataTable" class="cell-border compact hover" width="100%"></table>
						<br>
						<table id="learningWordsDataTableSummary" class="cell-border compact" width="100%"></table>
					</div>
					<div id="AllWordsTab" class="tabcontent">
						<h4>List of all words from the current text.</h4>
						<table id="allWordsDataTable" class="cell-border compact hover" width="100%"></table>
						<br>
						<table id="allWordsDataTableSummary" class="cell-border compact" width="100%"></table>
					</div>
					<div id="VocabularyTab" class="tabcontent">
					
					
					
					
					
						<h4>A complete list of collected vocabulary items.</h4>
		<p>To delete entries, select rows then press DEL key.</p>
						
						<table id="vocabularyDataTable" class="cell-border compact hover" width="100%"></table>
						<br>
						<table id="vocabularyDataTableSummary" class="cell-border compact" width="100%"></table>
					</div>
					<div id="CompareTab" class="tabcontent">
						<h4>See how one's vocabulary compares with past TOPIK papers.</h4>
						<table id="compareDataTable" class="cell-border compact" width="100%"></table>
					</div>
					
					<div id="GraphTab" class="tabcontent">
						<canvas id="myChart" width="100%" height="100%"></canvas>
					</div>
					
					<div id="AboutTab" class="tabcontent">
						<p>Korean Reader aims to make learning Korean from texts as effective as possible.</p>
						<p>Paste a text in the text area. All new words start as <b>unknown</b> (unless you change this in settings). Click to mark them as <b>learning</b>, and again to mark them as <b>known</b>.</p>
						<p><b>Unknown</b> words may be unknown, difficult, or not important to remember for the timebeing.</p>
						<p><b>Learning</b> words are words where the meaning  can be guessed without confidence, and perhaps need their meaning confirmed with a dictionary lookup.</p>
						<p><b>Known</b> words are words where the meaning is known instantly with confidence.</p><br>
						
						<br>
						<br>
						
						<h2>FAQ</h2>
						<h3>Can I mark an entire word family when I click on a word instead of marking each word individually?</h3>
						I Would love to add this option in the future, however calculating the base word out of conjugated Korean words is a difficult technical task. I haven't been able to find a sufficiently reliable and free API to allow me to add this feature.
					
					</div>
					<div id="OptionsTab" class="tabcontent">
						<input type="checkbox" id="enableHighlighting" name="enableHighlighting" checked onclick="toggleEnableHighlighting();">
						<label for="enableColours">Enable Highlighting</label>
						<br><br>
						<input type="checkbox" id="enableHighlightingKnown" name="enableHighlightingKnown" checked onclick="ToggleEnableHighlightingKnown();">
						<label for="enableHighlightingKnown">Show Highlighting For Known Words</label>
						<br>
						<br>Unknown Words Highlight Colour:
						<input class="colourInputField" type="textField" type="text" pattern="^#+([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$" id="fieldHC1" name="fieldHC1" onkeydown="if (event.keyCode == 13) { HC1Submit(); return false;}">
						<button id="HC1SubmitButton" onclick="HC1Submit();">Enter</button>
						<br>
						<br>Learning Words Highlight Colour:&nbsp
						<input class="colourInputField" type="textField" id="fieldHC2" onkeydown="if(event.keyCode == 13){ HC2Submit(); return false;}">
						<button id="HC2SubmitButton" onclick="HC2Submit();">Enter</button>
						<br>
						<br>Known Words Highlight Colour:&nbsp&nbsp&nbsp&nbsp
						<input class="colourInputField" type="text" pattern="^#+([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$" type="textField" type="text" pattern="^#+([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$" id="fieldHC3" name="fieldHC3" onkeydown="if (event.keyCode == 13) { HC3Submit(); return false;}">
						<button id="HC3SubmitButton" onclick="HC3Submit();">Enter</button>
						<br>
						<br>Jump Highlight Colour:&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
						<input class="colourInputField" type="textField" id="fieldHC4" type="text" pattern="^#+([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$" name="fieldHC4" onkeydown="if (event.keyCode == 13) { HC4Submit(); return false;}">
						<button id="HC4SubmitButton" onclick="HC4Submit();">Enter</button>
						<br><br>
						<hr>
						<form>All new words are initially marked: 
							<select id="startingMarkOption" onchange="ChangeStartingMark();">
								<option selected="selected">Unknown</option>
								<option>Learning</option>
								<option>Known</option>
							</select>
						</form> <br> Words already added to vocabulary list will not be altered with this setting. After changing this setting you may want to consider using <b>delete vocabulary - current text</b> or <b>delete vocabulary - all</b>.
						
						<hr>
						<br>
						<form>Font Size:
							<select id="fontSizeOption" onchange="ChangeFont();">
								<option>1</option>
								<option>2</option>
								<option>3</option>
								<option>4</option>
								<option>5</option>
								<option selected="selected">6</option>
								<option>7</option>
								<option>8</option>
							</select>
						</form>
						<br>
						<form>Font:
							<select id="fontTypeOption" onchange="ChangeFontType();">
								
							</select>
						</form>
						<br>
						<hr><br>Romanisation:
						<select id="romanisationOption" onchange="ChangeRomanisation();">
							<option selected="selected">Off</option>
							<option>On</option>
						</select>
						</form>&nbsp(For large texts this will take a while)
						<br><br>
						<hr>
						<br>
						<input type="checkbox" id="enableVoice" name="enableVoice" onclick="toggleEnableVoice();">
						<label for="enableVoice">Enable Voice</label>
						<br>
						<br>
						<form>Voice:
							<select id="voiceOption" onchange="ChangeVoice();"></select>&nbsp(Locally installed TTS voice)</form>
						<br>
						<div class="wrapper2">
							<div>Volume:</div>
							<div id="volumeOutput">0</div>
							<div class="slidecontainer">
								<input type="range" min="0" max="10" value="10" class="slider" id="voiceVolumeSlider">
							</div>
						</div>
						<br>
						<div class="wrapper2">
							<div>Speed:</div>
							<div id="speedOutput">0</div>
							<div class="slidecontainer">
								<input type="range" min="1" max="20" value="10" class="slider" id="voiceSpeedSlider">
							</div>
						</div>
						<br>
						<div class="wrapper2">
							<div>Pitch:</div>
							<div id="pitchOutput">0</div>
							<div class="slidecontainer">
								<input type="range" min="0" max="20" value="10" class="slider" id="voicePitchSlider">
							</div>
						</div>
						<br>
						<hr><br>
						<form>Dictionary Language:
							<select id="dictLanguageOption" onchange="ChangeDictLanguage();">
								<option>Korean-Korean</option>
								<option selected="selected">English</option>
								<option>Japanese</option>
								<option>Chinese</option>
								<option>French</option>
								<option>Spanish</option>
								<option>German</option>
								<option>Vietnamese</option>
								<option>Nepali</option>
								<option>Mongolian</option>
								<option>Burmese</option>
								<option>Swahili</option>
								<option>Arabic</option>
								<option>Uzbek</option>
								<option>Bahasa Indonesian</option>
								<option>Cambodian</option>
								<option>Thai</option>
								<option>Tetum</option>
								<option>Persian</option>
								<option>Ancient Hebrew</option>
								<option>Hindi</option>
								<option>Modern Greek</option>
								<option>Ancient Greek</option>
								<option>Dutch</option>
								<option>Latin</option>
								<option>Russian</option>
								<option>Romanian</option>
								<option>Swedish</option>
								<option>Albanian</option>
								<option>Ukrainian</option>
								<option>Italian</option>
								<option>Gruziya</option>
								<option>Czech</option>
								<option>Turkish</option>
								<option>Portuguese</option>
								<option>Polish</option>
								<option>Finnish</option>
								<option>Hungarian</option>
							</select>	
						</form>
						<br>
						<br>
					</div>
				</div>
			</div>
		</div>
 <div class="topbar" id="topbar">
		 <div class="empty"></div>
		 <div class="topbarbutton" onclick="Reset(true)"><b>Clear [ESC]</b></div>
		 <div class="empty"></div>
		 <div class="logo"><b>Korean Reader</b></div>
		 <div class="empty"></div>
		 <div class="topbarbutton" id="DictionaryTabButton" onclick="openTab(event, 'DictionaryTab','topbarbutton')"><b>Dictionary [1]</b></div>
		 <div class="empty"></div>
		 <div class="topbarbutton" id="ImagesTabButton" onclick="openTab(event, 'ImagesTab','topbarbutton')"><b>Images [2]</b></div>
		 <div class="empty"></div>
		 <div class="topbarbutton" id="StatisticsTabButton" onclick="openTab(event, 'StatisticsTab','topbarbutton')"><b>Statistics [3]</b></div>
		 <div class="empty"></div>
		 <div class="container" onclick="ToggleOpenMenu()">
			<div class="empty"></div>	
			<div class="bar"></div>
			<div class="empty"></div>
			<div class="bar"></div>
			<div class="empty"></div>
			<div class="bar"></div>
			<div class="empty"></div>
		 </div>
		 <div class="empty"></div>
		 
		<div class="menu" id="menu">
			<div class="topbarbutton" id="OptionsTabButton" onclick="openTab(event, 'OptionsTab','topbarbutton')"><b>Settings</b></div>
			<div class="empty"></div>
			<div class="topbarbutton" id="AboutTabButton" onclick="openTab(event, 'AboutTab','topbarbutton')"><b>About</b></div>
		</div>
	 </div>
</body>


</html>
