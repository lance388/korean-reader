<!-- Version 02052020
Website: http://koreanreader.com
Copyright © 2020 Rohan Scott
This source file is free software, available under the following license:
MIT license - https://mit-license.org/
This software uses the following plugins, please take note of their individual licenses when redistributing:
	jQuery						JS Foundation & other contributors	jquery.org												MIT license
	mark.js						Julian Kühnel						https://markjs.io/										MIT license
	IndexedDB-getAll-shim.js	dumbmatter							https://www.npmjs.com/package/indexeddb-getall-shim		MIT license
	aromanize.js				Fajar Chandra						https://github.com/fujaru/aromanize-js					MIT license
	chart.js					Chart.js Contributors				https://www.chartjs.org									MIT license
	datatables					SpryMedia Ltd						http://www.datatables.net								MIT license				
	javascript-css-font-detect	Lalit Patel							http://www.lalit.org/lab/javascript-css-font-detect/	Apache Software License 2.0
	FileSaver.js				Eli Grey							http://eligrey.com										MIT license
	colpick.js					Momo Kornher						https://github.com/mrgrain/colpick						Dual licensed under the MIT and GPLv2 licenses
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://ogp.me/ns/fb#">
<head>
<meta charset="UTF-8"/>
<meta name="description" content="Learn Korean through reading. Look up words, track progress, and view statistics."/>
<meta name="keywords" content="Korean, Language, Reader, Texts, Read, Reading, Study, Studying, Learn, Learning"/>
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

	<meta name="description" content="home"/>
	<meta name="author" content="Rohan Scott"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<meta property="og:image" content="https://koreanreader.com/preview/preview.png" />
<meta name="msapplication-TileColor" content="#0066CC"/>
<meta name="msapplication-TileImage" content="icons/ms-icon-144x144.png"/>
<meta name="theme-color" content="#0066CC"/>

<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@lance3881" />
<meta name="twitter:title" content="Korean Reader" />
<meta name="twitter:description" content="Learn Korean through reading. Look up words, track progress, and view statistics." />
<meta name="twitter:image" content="/preview/preview.png"/>

  <meta name="google-signin-client_id" content="641910980147-rulgj2ijv8pmhagni4v7v64clq0nndml.apps.googleusercontent.com">
  <meta name="google-signin-cookiepolicy" content="single_host_origin">
  <meta name="google-signin-scope" content="profile email">
  
    <script src="https://apis.google.com/js/platform.js" async defer></script>

<link rel="apple-touch-icon" sizes="57x57" href="icons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="icons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="icons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="icons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="icons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="icons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="icons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="icons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="icons/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="icons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="icons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
<link rel="manifest" href="icons/manifest.json">
<meta name="msapplication-TileColor" content="#0066CC">
<meta name="msapplication-TileImage" content="icons/ms-icon-144x144.png">
<meta name="theme-color" content="#0066CC">


	  <!-- Material Design Theming -->

  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <script defer src="https://code.getmdl.io/1.1.3/material.min.js"></script>

	<link rel="stylesheet" type="text/css" href="style.css">
	<link rel="stylesheet" type="text/css" href="DataTables-1.10.20/datatables.min.css">
	<link rel="stylesheet" type="text/css" href="colpick/colpick.css">
	<link href="fonts/Song+Myung.css" type="text/css" rel="stylesheet">
	<link href="fonts/Gamja+Flower.css" type="text/css" rel="stylesheet">
	<link href="fonts/Hi+Melody.css"  type="text/css" rel="stylesheet">
	<link href="fonts/Nanum+Pen+Script.css" type="text/css" rel="stylesheet">
	<link href="fonts/Sunflower.css" type="text/css" rel="stylesheet">
	<link href="fonts/Nanum+Myeongjo.css" type="text/css" rel="stylesheet">
	<link href="fonts/Cute+Font.css" type="text/css" rel="stylesheet">
	<link href="fonts/Poor+Story.css" type="text/css" rel="stylesheet">
	<link href="fonts/Yeon+Sung.css" type="text/css" rel="stylesheet">
	<link href="fonts/Stylish.css" type="text/css" rel="stylesheet">
	<link href="fonts/Gothic+A1.css" type="text/css" rel="stylesheet">
	<script src="mark/mark.min.js" charset="UTF-8"></script>
	<script src="jQuery-3.3.1/jquery-3.3.1.min.js"></script>
	<script src="DataTables-1.10.20/js/jquery.dataTables.min.js"></script>
	<script src="IndexedDB-getAll-shim/IndexedDB-getAll-shim.js"></script>
	<script src="Chart/Chart.bundle.min.js"></script>
	<script src="Chart/Chart.min.js"></script>
	<script src="Select-1.3.1/js/dataTables.select.min.js"></script>
	<script type="text/javascript" src="wordlists/stopik1.js"></script>
	<script type="text/javascript" src="wordlists/stopik2.js"></script>
	<script type="text/javascript" src="wordlists/stopik3.js"></script>
	<script type="text/javascript" src="wordlists/topikI.js"></script>
	<script type="text/javascript" src="wordlists/topikII.js"></script>
	<script type="text/javascript" src="aromanize/aromanize.js"></script>
	<script type="text/javascript" src="file-saver/FileSaver.min.js"></script>
	<script type="text/javascript" src="colpick/colpick.js"></script>
		 <!-- The core Firebase JS SDK is always required and must be listed first -->
	<script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-app.js"></script>

	<!-- TODO: Add SDKs for Firebase products that you want to use
		 https://firebase.google.com/docs/web/setup#available-libraries -->
	<script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-firestore.js"></script>
	
	
	
	
	
	<script type="text/javascript">
		var all_marked;
		var db;
		var enableHighlighting;
		var replaceCharacters;
		var lookingUp;
		var knownArray = [];
		var unknownArray= [];
		var learningArray= [];
		var allArray= [];
		var jumpMarked;
		var jumpAttempts;
		var compareLoopTimeout=[];
		var colourTimeout;
		var scrollTimeout;
		var saveFireDBTimeout;
		var vocabularyTimeout;
		var displaySortTimeout;
		var displayComparisonTimeout;
		var statisticsTimeout;
		var highlightTimeout;
		var unmarkJumpTimeout;
		var calculateStatisticsTimeout;
		var achievementsTimeout;
		var sentencesTimeout;
		var openedTab="";
		var limiters;
		var limitersHangeul; 
		const fontSizeDefault = 3;
		var fontSize;
		var romanisationMode;
		var regExp;
		var replaceCharactersHangeul;
		var convertedHTML;
		var colourPrimary;
		var colourSecondary;
		var colourTertiary;
		var colourJump;
		var colourBackground;
		var colourFont;
		var colourBorder;
		const colourPrimaryDefault= "#F5A9E1";
		const colourSecondaryDefault= "#FFFF66";
		const colourTertiaryDefault= "#99FF00";
		const colourJumpDefault = "#00ffff";
		const colourBackgroundDefault = "#fffeee";
		const colourFontDefault = "#000";
		const colourBorderDefault = "#0066CC";
		var enableVoice;
		var voicePitch;
		var voiceVolume;
		var voiceSpeed;
		//var selectedVocabulary;
		var selectedIndex=-1;
		var selectedWord="";
		var myChart;
		var myChart3;
		var global_total_words;
		var timeCalculateStatisticsBegin;
		var timeCalculateStatisticsEnd;
		var initialisationComplete = false;
		var unknownWordsTabUpToDate = false;
		var learningWordsTabUpToDate = false;
		var knownWordsTabUpToDate = false;
		var allWordsTabUpToDate = false;
		var lastUsedStatsTab;
		var browser ="unknown";
		var pendingLookup;
		var imagesLookingUp;
		var dictionaryLookingUp;
		const printJSON = false;
		var dictionaryLanguage;
		const dictionaryLanguageDefault="English";
		var sidebarVisible;
		var menuVisible;
		var compareLoop;
		var startingMarkDefault;
		var startingMark;
		var mobileMode;
		var vocabularyFilter;
		var chosenExportWordlist;
		var toExport ="";
		var importWordlistFilter;
		var fileSelector;
		const uidefault = "English";
		var grammarPoints =[];
		var grammarPointsHangul =[];
		var chartFilter = "chart1";
		var dbfire;
		var unknownFireDBDocumentLoaded = false;
		var knownFireDBDocumentLoaded = false;
		var learningFireDBDocumentLoaded = false;
		var hideKnownSentences = true;
		
		
		const sort_by = (field, reverse, primer) => {

		  const key = primer ?
			function(x) {
			  return primer(x[field])
			} :
			function(x) {
			  return x[field]
			};

		  reverse = !reverse ? 1 : -1;

		  return function(a, b) {
			return a = key(a), b = key(b), reverse * ((a > b) - (b > a));
		  }
		}
		
		
		
		function BrowserCheck() //allow all browsers for testing purposes 
		{
			browser = IsFirefoxOrChrome();
			if(browser=="unknown")
			{
				if (document.documentMode || /Edge/.test(navigator.userAgent)) {
				   browser="edge";
				}
			}
			console.log("Detected browser: "+browser);
			init(); 
		}
		
		function IsFirefoxOrChrome()
		{
			var isFirefox = typeof InstallTrigger !== 'undefined';
			var isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
			if(isFirefox)
			{
				return "firefox";
			}
			else if(isChrome)
			{
				return "chrome";
			}
			else
			{
				return "unknown";
			}
		}
		
		function init()
		{
			var pasteArea = document.getElementById ("pasteArea");
			pasteArea.contentEditable = false;
			jumpMarked = false;
			romanisationMode = 0;
			voicePitch = 1;
			voiceVolume = 1;
			enableVoice=false;
			voiceSpeed = 1;
			fontSize = fontSizeDefault;
			lookingUp="";
			convertedHTML="";
			all_marked = false;
			colourPrimary = colourPrimaryDefault;
			colourSecondary = colourSecondaryDefault;
			colourTertiary = colourTertiaryDefault;
			colourJump = colourJumpDefault;
			colourFont = colourFontDefault;
			colourBackground = colourBackgroundDefault;
			colourBorder = colourBorderDefault;
			//selectedVocabulary=[];
			global_total_words = 0;
			calculateStatisticsTimeout = 50;
			lastUsedStatsTab = "UnknownWordsTab";
			pendingLookup = "";
			imagesLookingUp="";
			dictionaryLookingUp="";
			dictionaryLanguage = "English";
			sidebarVisible = true;
			menuVisible=false;
			compareLoop=false;
			startingMarkDefault=0;
			startingMark = startingMarkDefault;
			mobileMode = false;
			vocabularyFilter="Known";
			chosenExportWordlist="Vocabulary - Learning";
			importWordlistFilter="Known";
			
			
			SetGrammarPoints();
			//SetHangulGrammarTriggers();
			
			fileSelector = document.getElementById('importWordlistButton');
						  fileSelector.addEventListener('change', (event) => {
							const file = event.target.files[0];
							ReadFile(file);
						  });
			
			//console.log(document.getElementById("fieldHC1").style.backgroundColor);
			$('#colorpicker1').colpick({
			color:getComputedStyle(document.documentElement).getPropertyValue('--primary-bg').replace("#",""),
            onSubmit:function(hsb,hex,rgb,el,bySetColor)
				{
					$(el).val('#'+hex);
					$(el).colpickHide();
					var primaryField = document.getElementById("fieldHC1");
						primaryField.value = '#'+hex;
						primaryField.style.backgroundColor='#'+hex;
				}
			});
			
			//$('#colorpicker2').value=getComputedStyle(document.documentElement).getPropertyValue('--secondary-bg');
			$('#colorpicker2').colpick({
			color:value=getComputedStyle(document.documentElement).getPropertyValue('--secondary-bg').replace("#",""),
            onSubmit:function(hsb,hex,rgb,el,bySetColor)
				{
					$(el).val('#'+hex);
					$(el).colpickHide();
					var secondaryField = document.getElementById("fieldHC2");
						secondaryField.value = '#'+hex;
						secondaryField.style.backgroundColor='#'+hex;
				}
			});
			
			//$('#colorpicker3').value=getComputedStyle(document.documentElement).getPropertyValue('--tertiary-bg');
			$('#colorpicker3').colpick({
			color:getComputedStyle(document.documentElement).getPropertyValue('--tertiary-bg').replace("#",""),
            onSubmit:function(hsb,hex,rgb,el,bySetColor)
				{
					$(el).val('#'+hex);
					$(el).colpickHide();
					var tertiaryField = document.getElementById("fieldHC3");
						tertiaryField.value = '#'+hex;
						tertiaryField.style.backgroundColor='#'+hex;
				}
			});
			
			//$('#colorpicker4').value=getComputedStyle(document.documentElement).getPropertyValue('--jump-bg');
			$('#colorpicker4').colpick({
			color:getComputedStyle(document.documentElement).getPropertyValue('--jump-bg').replace("#",""),
            onSubmit:function(hsb,hex,rgb,el,bySetColor)
				{
					$(el).val('#'+hex);
					$(el).colpickHide();
					var jumpField = document.getElementById("fieldHC4");
						jumpField.value = '#'+hex;
						jumpField.style.backgroundColor='#'+hex;
				}
			});
			$('#colorpicker5').colpick({
			color:getComputedStyle(document.documentElement).getPropertyValue('--page-bg').replace("#",""),
            onSubmit:function(hsb,hex,rgb,el,bySetColor)
				{
					$(el).val('#'+hex);
					$(el).colpickHide();
					var bgField = document.getElementById("fieldHC5");
						bgField.value = '#'+hex;
						bgField.style.backgroundColor='#'+hex;
				}
			});
			
			$('#colorpicker6').colpick({
			color:getComputedStyle(document.documentElement).getPropertyValue('--font-bg').replace("#",""),
            onSubmit:function(hsb,hex,rgb,el,bySetColor)
				{
					$(el).val('#'+hex);
					$(el).colpickHide();
					var fontColourField = document.getElementById("fieldHC6");
						fontColourField.value = '#'+hex;
						fontColourField.style.backgroundColor='#'+hex;
				}
			});
			
			$('#colorpicker7').colpick({
			color:getComputedStyle(document.documentElement).getPropertyValue('--document-bg').replace("#",""),
            onSubmit:function(hsb,hex,rgb,el,bySetColor)
				{
					$(el).val('#'+hex);
					$(el).colpickHide();
					var borderColourField = document.getElementById("fieldHC7");
						borderColourField.value = '#'+hex;
						borderColourField.style.backgroundColor='#'+hex;
				}
			});
			
			enableHighlighting = true;
			replaceCharactersHangeul = /[\0-\│\:\\…\］\♫\〖\〗\<\>\,\〜\👌\､\🧡\💚\＾\💗\┃\〝\￡\＇\〞\︰\⏲\🤗\⏰\`\＆\０\１\２\３\４\💕\❤️\🎄\😆\👀\😊\🎁\😉\👉\▲\😱\※\５\６\７\８\９\😜\'\+\㎜\❝\❞\❧\㎝\|\~\s+\d\/\”\😘\]\◄\►\－\❯\＊\›\□\㈜\★\♩\♬\_\😍\◆\、\–\👍\|\ㅡ\©\—\・\ㆍ\r\n|\n|\r\】\■\：\\\／\．\？\^\-\⭐\‒\!\"\｀\❣️\％\◇\﹏\→\；\（\✨\;\。\，\）\【\『\』\丶\▪\―\☆\❓\🙏\♡\☞\─\®\♪\〈\△\❤\♥\▶\❦\㎢\▼\◀\&\〉\(\)\「\〔\{\}\㉡\*\㉢\1\2\3\4\5\6\7\8\9\0\㉣\=\㎏\·\」\%\》\[\〕\~\∼\《\～\“\❷\❶\❸\❹\●\�\㎞\○\㉠\#\$\?\＞\.\‘\’\！\💛\x1F\x7F-\x9F\xAD\u0378\ufeff\u0379\u037F-\u0383\u038B\u038D\u03A2\u0528-\u0530\u0557\u0558\u0560\u0588\u058B-\u058E\u0590\u05C8-\u05CF\u05EB-\u05EF\u05F5-\u0605\u061C\u061D\u06DD\u070E\u070F\u074B\u074C\u07B2-\u07BF\u07FB-\u07FF\u082E\u082F\u083F\u085C\u085D\u085F-\u089F\u08A1\u08AD-\u08E3\u08FF\u0978\u0980\u0984\u098D\u098E\u0991\u0992\u09A9\u09B1\u09B3-\u09B5\u09BA\u09BB\u09C5\u09C6\u09C9\u09CA\u09CF-\u09D6\u09D8-\u09DB\u09DE\u09E4\u09E5\u09FC-\u0A00\u0A04\u0A0B-\u0A0E\u0A11\u0A12\u0A29\u0A31\u0A34\u0A37\u0A3A\u0A3B\u0A3D\u0A43-\u0A46\u0A49\u0A4A\u0A4E-\u0A50\u0A52-\u0A58\u0A5D\u0A5F-\u0A65\u0A76-\u0A80\u0A84\u0A8E\u0A92\u0AA9\u0AB1\u0AB4\u0ABA\u0ABB\u0AC6\u0ACA\u0ACE\u0ACF\u0AD1-\u0ADF\u0AE4\u0AE5\u0AF2-\u0B00\u0B04\u0B0D\u0B0E\u0B11\u0B12\u0B29\u0B31\u0B34\u0B3A\u0B3B\u0B45\u0B46\u0B49\u0B4A\u0B4E-\u0B55\u0B58-\u0B5B\u0B5E\u0B64\u0B65\u0B78-\u0B81\u0B84\u0B8B-\u0B8D\u0B91\u0B96-\u0B98\u0B9B\u0B9D\u0BA0-\u0BA2\u0BA5-\u0BA7\u0BAB-\u0BAD\u0BBA-\u0BBD\u0BC3-\u0BC5\u0BC9\u0BCE\u0BCF\u0BD1-\u0BD6\u0BD8-\u0BE5\u0BFB-\u0C00\u0C04\u0C0D\u0C11\u0C29\u0C34\u0C3A-\u0C3C\u0C45\u0C49\u0C4E-\u0C54\u0C57\u0C5A-\u0C5F\u0C64\u0C65\u0C70-\u0C77\u0C80\u0C81\u0C84\u0C8D\u0C91\u0CA9\u0CB4\u0CBA\u0CBB\u0CC5\u0CC9\u0CCE-\u0CD4\u0CD7-\u0CDD\u0CDF\u0CE4\u0CE5\u0CF0\u0CF3-\u0D01\u0D04\u0D0D\u0D11\u0D3B\u0D3C\u0D45\u0D49\u0D4F-\u0D56\u0D58-\u0D5F\u0D64\u0D65\u0D76-\u0D78\u0D80\u0D81\u0D84\u0D97-\u0D99\u0DB2\u0DBC\u0DBE\u0DBF\u0DC7-\u0DC9\u0DCB-\u0DCE\u0DD5\u0DD7\u0DE0-\u0DF1\u0DF5-\u0E00\u0E3B-\u0E3E\u0E5C-\u0E80\u0E83\u0E85\u0E86\u0E89\u0E8B\u0E8C\u0E8E-\u0E93\u0E98\u0EA0\u0EA4\u0EA6\u0EA8\u0EA9\u0EAC\u0EBA\u0EBE\u0EBF\u0EC5\u0EC7\u0ECE\u0ECF\u0EDA\u0EDB\u0EE0-\u0EFF\u0F48\u0F6D-\u0F70\u0F98\u0FBD\u0FCD\u0FDB-\u0FFF\u10C6\u10C8-\u10CC\u10CE\u10CF\u1249\u124E\u124F\u1257\u1259\u125E\u125F\u1289\u128E\u128F\u12B1\u12B6\u12B7\u12BF\u12C1\u12C6\u12C7\u12D7\u1311\u1316\u1317\u135B\u135C\u137D-\u137F\u139A-\u139F\u13F5-\u13FF\u169D-\u169F\u16F1-\u16FF\u170D\u1715-\u171F\u1737-\u173F\u1754-\u175F\u176D\u1771\u1774-\u177F\u17DE\u17DF\u17EA-\u17EF\u17FA-\u17FF\u180F\u181A-\u181F\u1878-\u187F\u18AB-\u18AF\u18F6-\u18FF\u191D-\u191F\u192C-\u192F\u193C-\u193F\u1941-\u1943\u196E\u196F\u1975-\u197F\u19AC-\u19AF\u19CA-\u19CF\u19DB-\u19DD\u1A1C\u1A1D\u1A5F\u1A7D\u1A7E\u1A8A-\u1A8F\u1A9A-\u1A9F\u1AAE-\u1AFF\u1B4C-\u1B4F\u1B7D-\u1B7F\u1BF4-\u1BFB\u1C38-\u1C3A\u1C4A-\u1C4C\u1C80-\u1CBF\u1CC8-\u1CCF\u1CF7-\u1CFF\u1DE7-\u1DFB\u1F16\u1F17\u1F1E\u1F1F\u1F46\u1F47\u1F4E\u1F4F\u1F58\u1F5A\u1F5C\u1F5E\u1F7E\u1F7F\u1FB5\u1FC5\u1FD4\u1FD5\u1FDC\u1FF0\u1FF1\u1FF5\u1FFF\u200B-\u200F\u202A-\u202E\u2060-\u206F\u2072\u2073\u208F\u209D-\u209F\u20BB-\u20CF\u20F1-\u20FF\u218A-\u218F\u23F4-\u23FF\u2427-\u243F\u244B-\u245F\u2700\u2B4D-\u2B4F\u2B5A-\u2BFF\u2C2F\u2C5F\u2CF4-\u2CF8\u2D26\u2D28-\u2D2C\u2D2E\u2D2F\u2D68-\u2D6E\u2D71-\u2D7E\u2D97-\u2D9F\u2DA7\u2DAF\u2DB7\u2DBF\u2DC7\u2DCF\u2DD7\u2DDF\u2E3C-\u2E7F\u2E9A\u2EF4-\u2EFF\u2FD6-\u2FEF\u2FFC-\u2FFF\u3040\u3097\u3098\u3100-\u3104\u312E-\u3130\u318F\u31BB-\u31BF\u31E4-\u31EF\u321F\u32FF\u4DB6-\u4DBF\u9FCD-\u9FFF\uA48D-\uA48F\uA4C7-\uA4CF\uA62C-\uA63F\uA698-\uA69E\uA6F8-\uA6FF\uA78F\uA794-\uA79F\uA7AB-\uA7F7\uA82C-\uA82F\uA83A-\uA83F\uA878-\uA87F\uA8C5-\uA8CD\uA8DA-\uA8DF\uA8FC-\uA8FF\uA954-\uA95E\uA97D-\uA97F\uA9CE\uA9DA-\uA9DD\uA9E0-\uA9FF\uAA37-\uAA3F\uAA4E\uAA4F\uAA5A\uAA5B\uAA7C-\uAA7F\uAAC3-\uAADA\uAAF7-\uAB00\uAB07\uAB08\uAB0F\uAB10\uAB17-\uAB1F\uAB27\uAB2F-\uABBF\uABEE\uABEF\uABFA-\uABFF\uD7A4-\uD7AF\uD7C7-\uD7CA\uD7FC-\uF8FF\uFA6E\uFA6F\uFADA-\uFAFF\uFB07-\uFB12\uFB18-\uFB1C\uFB37\uFB3D\uFB3F\uFB42\uFB45\uFBC2-\uFBD2\uFD40-\uFD4F\uFD90\uFD91\uFDC8-\uFDEF\uFDFE\uFDFF\uFE1A-\uFE1F\uFE27-\uFE2F\uFE53\uFE67\uFE6C-\uFE6F\uFE75\uFEFD-\uFF00\uFFBF-\uFFC1\uFFC8\uFFC9\uFFD0\uFFD1\uFFD8\uFFD9\uFFDD-\uFFDF\uFFE7\uFFEF-\uFFFB\uFFFE\uFFFF]/g;
			
			limitersHangeul = ["A","B","C","D","￡","🤗","⏰","︰","〝","〞","👌","😆","🧡","`","💚","♫","💗","⏲","💕","😊","👀","🎁","😜","😉","〜","※","､","🎄","👉","😱","〖","〗","＇","E","F","G","H","I","J","❯","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",
			"a","b","c","d","e","f","g","h","i","j","k","❤️","∼","㎜","＾","❧","㎝","|","®","㈜","◄","►","›","◆","□","|","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z",
			"㉢","㉣","△","○","%","❷","❸","▲","┃","］","＆","－","❶","♡","❹","❞","❦","―","♬","😍","😘","、","🙏","●","㉠","⭐","❤","｀","『","。","（","）","丶","【","】",";","』","㉡","~","​","〉","～","「","〈","$","/","〔","│","♩","…","」","“","・",":","❝","”","#","．","-","💛",",","–","-","㎞","／",'"',".","‒","!","👍","?","；","！","�","％","!","+","\"","\'","■","，","：","─","◇",")","❓","▶","▼","♥","◀","♪","》","ㅡ","&","_","《","{","▪","}","☆","·","[","=","]","？","©","*","(","~","^","^","\\","—","㎏","★","＞","﹏","→","1","2","3","4","5","6","7","8","9","0","‘","’","<",">","ㆍ","０","１","２","４","３","５","６","７","８","９","㎢","＊"];
			
			
			
			limiters = limitersHangeul;
			replaceCharacters = replaceCharactersHangeul;
			regExp = /^\S*$/;
			document.getElementById("DictionaryTabButton").click();
			window.addEventListener('resize', OnResize);





	$(document).ready(function() {
			
				if (firebase.auth().currentUser)
				{
					ShowSigninElements(false);
				}
				else
				{
					ShowSigninElements(true);
				}
											
			
				var chartDropDown = document.getElementById("chartOption");
				chartDropDown.selectedIndex=0;
			
				var table = $('#unknownWordsDataTable').DataTable( {
					"paging":         true,
					"scrollCollapse": false,
					"deferRender": true,
					"iDisplayLength": 25,
					"info": false,
					"order": [[ 0, "desc" ]],
					select: 'single',
					columns: [
						{ title: "Count" },
						{ title: "Word" },
						{ title: "Frequency" },
						{ title: "TOPIK" },
					],
					columnDefs: [
						{type: 'non-empty-string', targets: 3} // define 'name' column as non-empty-string type
					]
				} );

							var table2 = $('#learningWordsDataTable').DataTable( {
					"paging":         true,
					"scrollCollapse": false,
					"deferRender": true,
					"info": false,
					"iDisplayLength": 25,
					"order": [[ 0, "desc" ]],
					select: 'single',
					columns: [
						{ title: "Count" },
						{ title: "Word" },
						{ title: "Frequency" },
						{ title: "TOPIK" },
					],
					columnDefs: [
						{type: 'non-empty-string', targets: 3} // define 'name' column as non-empty-string type
					]
				} );
				
							var table3 = $('#knownWordsDataTable').DataTable( {
					"paging":         true,
					"scrollCollapse": false,
					"deferRender": true,
					"info": false,
					"iDisplayLength": 25,
					"order": [[ 0, "desc" ]],
					select: 'single',
					columns: [
						{ title: "Count" },
						{ title: "Word" },
						{ title: "Frequency" },
						{ title: "TOPIK" },
					],
					columnDefs: [
						{type: 'non-empty-string', targets: 3} // define 'name' column as non-empty-string type
					]
				} );
				
							var table4 = $('#allWordsDataTable').DataTable( {
					"paging":         true,
					"scrollCollapse": false,
					"deferRender": true,
					"info": false,
					"iDisplayLength": 25,
					"order": [[ 0, "desc" ]],
					select: 'single',
					columns: [
						{ title: "Count" },
						{ title: "Word" },
						{ title: "Frequency" },
						{ title: "TOPIK" },
					],
					columnDefs: [
						{type: 'non-empty-string', targets: 3} // define 'name' column as non-empty-string type
					]
				} );
				
							var table5 = $('#vocabularyDataTable').DataTable( {
				    "scrollY":        300,
					"scrollCollapse": false,
					"paging":         false,
					"deferRender": true,
					"info": false,
					"order": [[ 0, "desc" ]],
					select: true,
					columns: [
						{ title: "Word" },
						{ title: "State" }
					]
				} );
				
							var table6 = $('#compareDataTable').DataTable( {
					"scrollCollapse": false,
					"paging":         false,
					"deferRender": true,
					"searching": false,
					"info": false,
					"order": [[ 3, "desc" ]],
					select: false,
					columns: [
						{ title: "Word List" },
						{ title: "Unknown %" },
						{ title: "Learning %" },
						{ title: "Known %" },
						{ title: "Unknown Unique Words" },
						{ title: "Total Unique Words" }
					]
				} );
				
				var table7 = $('#unknownWordsDataTableSummary').DataTable( {
					"scrollCollapse": false,
					"paging":         false,
					"targets": 'no-sort',
					"bSort": false,
					"order": [],
					"searching": false,
					"info": false,
					columns: [
						{ title: "Unknown Words" },
						{ title: "Total Words" },
						{ title: "Unique Unknown Words" },
						{ title: "Total Unique Words" }
					]
				} );
				
							var table8 = $('#learningWordsDataTableSummary').DataTable( {
				    "scrollCollapse": false,
					"paging":         false,
					"targets": 'no-sort',
					"bSort": false,
					"order": [],
					"searching": false,
					"info": false,
					columns: [
						{ title: "Learning Words" },
						{ title: "Total Words" },
						{ title: "Unique Learning Words" },
						{ title: "Total Unique Words" }
					]
				} );
				
							var table9 = $('#knownWordsDataTableSummary').DataTable( {
				    "scrollCollapse": false,
					"paging":         false,
					"targets": 'no-sort',
					"bSort": false,
					"order": [],
					"searching": false,
					"info": false,
					columns: [
						{ title: "Known Words" },
						{ title: "Total Words" },
						{ title: "Unique Known Words" },
						{ title: "Total Unique Words" }
					]
				} );
				
							var table10 = $('#allWordsDataTableSummary').DataTable( {
				    "scrollCollapse": false,
					"paging":         false,
					"targets": 'no-sort',
					"bSort": false,
					"order": [],
					"searching": false,
					"info": false,
					columns: [
						{ title: "Total Words" },
						{ title: "Total Unique Words" }
					]
				} );
				
					var table11 = $('#vocabularyDataTableSummary').DataTable( {
				    "scrollCollapse": false,
					"paging":         false,
					"targets": 'no-sort',
					"bSort": false,
					"order": [[ 0, "desc" ]],
					"searching": false,
					"info": false,
					columns: [
						{ title: "Total"},
						{ title: "Unknown" },
						{ title: "Learning" },
						{ title: "Known" }
					]
				} );
				
						var table12 = $('#achievementsDataTable').DataTable( {
				    "scrollY":        300,
					"scrollCollapse": false,
					"paging":         false,
					"searching": false,
					"deferRender": true,
					"info": false,
					"order": [[ 0, "desc" ]],
					select: true,
					"language": {
					  "emptyTable": "No achievements recorded yet, check again later."
					},
					columns: [
						{ title: "Known Vocabulary" },
						{ title: "Date Achieved" }
					]
				} );
				
						var table13 = $('#grammarDataTable1').DataTable( {
				    "scrollY":        280,
					"scrollCollapse": false,
					"paging":         false,
					"searching": false,
					"deferRender": true,
					"info": false,
//					"order": [[ 0, "desc" ]],
					select: true,
					"language": {
					  "emptyTable": "Grammar patterns not detected."
					},
					columns: [
						{ title: "#" },
						{ title: "Pattern" },
						{ title: "Description"}
					]
				} );
				
					var table14 = $('#grammarDataTable2').DataTable( {
				    "scrollY":        280,
					"scrollCollapse": false,
					"paging":         false,
					"searching": true,
					"deferRender": true,
					"info": false,
//					"order": [[ 0, "desc" ]],
					select: true,
					"language": {
					  "emptyTable": "Loading..."
					},
					columns: [
						{ title: "#" },
						{ title: "Pattern" },
						{ title: "Description"}
					]
				} );
				
				var table15 = $('#sentencesDataTable').DataTable( {
				    "scrollY":        500,
					"scrollCollapse": false,
					"paging":         false,
					"searching": true,
					"deferRender": true,
					"info": false,
					"order": [[ 4, "asc" ]],
					select: true,
					"language": {
					  "emptyTable": "Loading..."
					},
					columns: [
						{ title: "#" },
						{ title: "Sentence" },
						{ title: "n"},
						{ title: "?"},
						{ title: "%"}
					]
				} );
				
				var events = $('#events');
				
				table
				.on( 'select', function ( e, dt, type, indexes ) {
					var rowData = table.rows( indexes ).data().toArray();
					table.rows( { selected: true } ).deselect();
					selectedWord = rowData[0][1];
					selectedIndex = indexes[0];
					JumpTo(rowData[0][1]);
				} );

				
							table2
				.on( 'select', function ( e, dt, type, indexes ) {
					var rowData = table2.rows( indexes ).data().toArray();
					table2.rows( { selected: true } ).deselect();
					selectedWord = rowData[0][1];
					selectedIndex = indexes[0];
					JumpTo(rowData[0][1]);
				} );

				
							table3
				.on( 'select', function ( e, dt, type, indexes ) {
					var rowData = table3.rows( indexes ).data().toArray();
					table3.rows( { selected: true } ).deselect();
					selectedWord = rowData[0][1];
					selectedIndex = indexes[0];					
					JumpTo(rowData[0][1]);
				} );

         				
							table4
				.on( 'select', function ( e, dt, type, indexes ) {
					var rowData = table4.rows( indexes ).data().toArray();
					table4.rows( { selected: true } ).deselect();
					selectedWord = rowData[0][1];
					selectedIndex = indexes[0];
					JumpTo(rowData[0][1]);
				} );
				
							table15
				.on( 'select', function ( e, dt, type, indexes ) {
					var rowData = table15.rows( indexes ).data().toArray();
					table15.rows( { selected: true } );
					selectedWord = rowData[0][1];
					selectedIndex = indexes[0];
					JumpToSentence(rowData[0][1]);
				} );

				
				/*						table5
				.on( 'select', function ( e, dt, type, indexes ) {
					var rowData = table5.rows( indexes ).data().toArray();
					for(var i=0;i<rowData.length;i++)
					{
						//selectedVocabulary.push(rowData[i][0]);
						//selectedVocabulary[i] = rowData[i][0];
					}
					
				} );
				
				table5
				.on( 'deselect', function ( e, dt, type, indexes ) {
					selectedVocabulary = [];
				} );
				*/
				
				jQuery.extend( jQuery.fn.dataTableExt.oSort, {
				"non-empty-string-asc": function (str1, str2) {
					if(str1 == "")
						return 1;
					if(str2 == "")
						return -1;
					return ((str1 < str2) ? -1 : ((str1 > str2) ? 1 : 0));
				},
			 
				"non-empty-string-desc": function (str1, str2) {
					if(str1 == "")
						return 1;
					if(str2 == "")
						return -1;
					return ((str1 < str2) ? 1 : ((str1 > str2) ? -1 : 0));
				}
			} );
				


				initdb();
			}
	
			);
			

			var contentArea = document.getElementById ("content");
			
					if (contentArea.addEventListener) {
					contentArea.addEventListener ("mouseup", function (event) {
						if(menuVisible)
						{
							ShowMenu(false);
						}
					
						if (event.altKey||event.ctrlKey||event.metaKey)
						{
							mouseUp(0);
						}
						else
						{
							switch (event.which) {
							case 1:
								mouseUp(1);
								break;
							case 2:
								//mouseUp(1);
								break;
							case 3:
								//mouseUp(2);
								break;
							default:
								mouseUp(1);
						}

						}
	
					}, false);
				}


					var sidebar2 = document.getElementById ("sidebar2");
					if (sidebar2.addEventListener) {
					sidebar2.addEventListener ("mouseup", function (event)
					{
						if(menuVisible)
						{
							ShowMenu(false);
						}
	
					}, false);
				}	

				
		}
		
		function NavigateFirstVisit()
		{
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.get("firstvisit$");
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
	        request.onsuccess = function(event) {          
	          if(request.result) {
					document.getElementById("DictionaryTabButton").click();
					
			}
			else
			{
				addwordtodb("firstvisit$",1);
				document.getElementById("AboutTabButton").click();
			}
	
				
			}
		}
		
		function InitialiseHighlighting()
		{
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.get("enableHighlighting$");
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
	        request.onsuccess = function(event) {          
	          if(request.result) {
					var a = request.result.appearances;
					if(a==0)
					{
						enableHighlighting = false;
						document.getElementById("enableHighlighting").checked = false;
					}
					else
					{
						enableHighlighting = true;
						document.getElementById("enableHighlighting").checked = true;
					}
			}
					else
					{
						if(enableHighlighting)
						{
							addwordtodb("enableHighlighting$",1);
							document.getElementById("enableHighlighting").checked = true;
						}
						else
						{
							addwordtodb("enableHighlighting$",0);
							document.getElementById("enableHighlighting").checked = false;
						}
					}
			}
		}
		
		function initdb()
		{
			if (!window.indexedDB) {
				alert("Your browser doesn't support a stable version of IndexedDB");
				console.log("Your browser doesn't support a stable version of IndexedDB");
			}
		else
		{			
			
			var request = indexedDB.open("wordsdb",3);
			
	
			request.onupgradeneeded = function() {
			  db = request.result;
			  var store = db.createObjectStore("wordsdb", {keyPath: "word"});
			  var appearancesIndex = store.createIndex("by_appearance", "appearance");
			  
	
			  
			};
			request.onerror = function(event) 
			{
			  console.log("Database error: " + event.target.errorCode);
			};
			request.onsuccess = function() {
			  db = request.result;
			  OnResize();
			  InitialiseColourInputField();
			  InitialiseStartingMark();
			  InitialiseHighlighting();
			  InitialiseRomanisation();
			  InitialiseVoice();
			  InitialiseFontType(0);
			  InitialiseDictLanguage();
			  InitialiseHighlightingKnown();
			  InitialiseVocabulary();
			  SetDefaultReaderLanguage();
			  InitialiseFireDB();
			  InitialiseUILanguage();
			  InitialiseFontSize();
			  InitialiseExportWordlist();
			  InitialiseImport();
			  InitialiseHideKnownSentences();
			  var pasteArea = document.getElementById ("pasteArea");
			  pasteArea.innerText = "";	
			  LoadHTML();
			  
			  initialisationComplete = true;
			  pasteArea.contentEditable = true;
			  JumpToSavedPageLocation();
			  NavigateFirstVisit();
				
			};
			}
		}
		
		$(window).keydown(function(e) {
		//console.log(e.keyCode);
		  switch (e.keyCode) {
		  
			case 49: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("DictionaryTabButton").click(); e.preventDefault();} break; 
			case 50: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("ImagesTabButton").click(); e.preventDefault();} break; 
			case 51: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("StatisticsTabButton").click(); e.preventDefault();} break; 
			case 52: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("UnknownWordsTabButton").click(); e.preventDefault();} break;
			case 53: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("LearningWordsTabButton").click(); e.preventDefault();} break;
			case 54: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("KnownWordsTabButton").click(); e.preventDefault();} break;
			case 55: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("AllWordsTabButton").click(); e.preventDefault();} break;
			case 56: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("VocabularyTabButton").click(); e.preventDefault();} break;
			case 57: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("CompareTabButton").click(); e.preventDefault();} break;
			case 48: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("GraphTabButton").click(); e.preventDefault();} break;
			case 97: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("DictionaryTabButton").click(); e.preventDefault();} break; 
			case 98: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("ImagesTabButton").click(); e.preventDefault();} break; 
			case 99: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("StatisticsTabButton").click(); e.preventDefault();} break; 
			case 100: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("UnknownWordsTabButton").click(); e.preventDefault();} break;
			case 101: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("LearningWordsTabButton").click(); e.preventDefault();} break;
			case 102: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("KnownWordsTabButton").click(); e.preventDefault();} break;
			case 103: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("AllWordsTabButton").click(); e.preventDefault();} break;
			case 104: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("VocabularyTabButton").click(); e.preventDefault();} break;
			case 105: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("CompareTabButton").click(); e.preventDefault();} break;
			case 96: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("GraphTabButton").click(); e.preventDefault();} break;
			case 173: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("AchievementsTabButton").click(); e.preventDefault();} break;
			case 71: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("GrammarTabButton").click(); e.preventDefault();} break;
			case 61: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("GrammarTabButton").click(); e.preventDefault();} break;
			case 79: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("googleImagesLink").click(); e.preventDefault();} break;
			case 89: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("yahooImagesLink").click(); e.preventDefault();} break;
			case 84: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("googleTranslateLink").click(); e.preventDefault();} break;
			case 80: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("papagoTranslateLink").click(); e.preventDefault();} break;
			case 83: if(openedTab!="OptionsTab"&&openedTab!="LoginTab"){document.getElementById("SentencesTabButton").click(); e.preventDefault();} break;
			
			case 46: DeleteVocabulary(); break;
			case 8: DeleteVocabulary(); break;
			case 27: Reset(); e.preventDefault(); break;

			  return;
		  }
		});
		
		function InitialiseVocabulary()
		{
			var mySelect = document.getElementById('filterVocabularyOption');
			mySelect.value = vocabularyFilter;
		}
		
		function DeleteVocabulary()
		{
			var selectedVocabulary=[];
			var table5 = $('#vocabularyDataTable').DataTable();
			var data = table5.rows('.selected').data();
			data.each(function (value, index) {
				selectedVocabulary.push(value[0]);
			});
		
			if(enableHighlighting && openedTab=="VocabularyTab")
			{
				if(selectedVocabulary.length>0)
				{
					for(var i=0;i<selectedVocabulary.length;i++)
					{
						var transaction = db.transaction(["wordsdb"], "readwrite");
						transaction.onerror = function(event)
						{
							console.log('Transaction not opened due to error: ' + transaction.error);
						};
						var objectStore = transaction.objectStore("wordsdb");
						var objectStoreRequest = objectStore.delete(selectedVocabulary[i]);
					}
	
				}
				OnInput();
			}
		
		}
		
		/**
			 * JavaScript code to detect available availability of a
			 * particular font in a browser using JavaScript and CSS.
			 *
			 * Author : Lalit Patel
			 * Website: http://www.lalit.org/lab/javascript-css-font-detect/
			 * License: Apache Software License 2.0
			 *          http://www.apache.org/licenses/LICENSE-2.0
			 * Version: 0.15 (21 Sep 2009)
			 *          Changed comparision font to default from sans-default-default,
			 *          as in FF3.0 font of child element didn't fallback
			 *          to parent element if the font is missing.
			 * Version: 0.2 (04 Mar 2012)
			 *          Comparing font against all the 3 generic font families ie,
			 *          'monospace', 'sans-serif' and 'sans'. If it doesn't match all 3
			 *          then that font is 100% not available in the system
			 * Version: 0.3 (24 Mar 2012)
			 *          Replaced sans with serif in the list of baseFonts
			 */

			/**
			 * Usage: d = new Detector();
			 *        d.detect('font name');
			 */
			var Detector = function() {
				// a font will be compared against all the three default fonts.
				// and if it doesn't match all 3 then that font is not available.
				var baseFonts = ['monospace', 'sans-serif', 'serif'];

				//we use m or w because these two characters take up the maximum width.
				// And we use a LLi so that the same matching fonts can get separated
				var testString = "mmmmmmmmmmlli";

				//we test using 72px font size, we may use any size. I guess larger the better.
				var testSize = '72px';

				var h = document.getElementsByTagName("body")[0];

				// create a SPAN in the document to get the width of the text we use to test
				var s = document.createElement("span");
				s.style.fontSize = testSize;
				s.innerHTML = testString;
				var defaultWidth = {};
				var defaultHeight = {};
				for (var index in baseFonts) {
					//get the default width for the three base fonts
					s.style.fontFamily = baseFonts[index];
					h.appendChild(s);
					defaultWidth[baseFonts[index]] = s.offsetWidth; //width for the default font
					defaultHeight[baseFonts[index]] = s.offsetHeight; //height for the defualt font
					h.removeChild(s);
				}

				function detect(font) {
					var detected = false;
					for (var index in baseFonts) {
						s.style.fontFamily = font + ',' + baseFonts[index]; // name of the font along with the base font for fallback.
						h.appendChild(s);
						var matched = (s.offsetWidth != defaultWidth[baseFonts[index]] || s.offsetHeight != defaultHeight[baseFonts[index]]);
						h.removeChild(s);
						detected = detected || matched;
					}
					return detected;
				}

				this.detect = detect;
			};

		function sleep(ms) {
		  return new Promise(resolve => setTimeout(resolve, ms));
		}
		
		function InitialiseFireDB()
		{
			dbfire = firebase.firestore();
			//document.getElementById('signout').addEventListener('click', handleSignOut, false);
			// Listening for auth state changes.
		  // [START authstatelistener]
		  firebase.auth().onAuthStateChanged(function(user) {
				// [START_EXCLUDE silent]
				// [END_EXCLUDE]
				if (user) {
				  // User is signed in.
				  var displayName = user.displayName;	
				  var email = user.email;
				  var emailVerified = user.emailVerified;
				  var photoURL = user.photoURL;
				  var isAnonymous = user.isAnonymous;
				  var uid = user.uid;
				  var providerData = user.providerData;
				  // [START_EXCLUDE]
				  document.getElementById('quickstart-sign-in-status').textContent = 'Signed in';
				  document.getElementById('quickstart-sign-in').textContent = 'Sign out';
				  //document.getElementById('signout').disabled = false;
				  //document.getElementById('quickstart-account-details').textContent = JSON.stringify(user, null, '  ');
				//  if (!emailVerified) {
				//    document.getElementById('quickstart-verify-email').disabled = false;
			   //   }
				  // [END_EXCLUDE]
				  
				  LoadAccountData();
				  
				} else {
				  // User is signed out.
				  // [START_EXCLUDE]
				  
				  learningFireDBDocumentLoaded=false;
				  knownFireDBDocumentLoaded=false;
				  unknownFireDBDocumentLoaded=false;
				  
				  document.getElementById('quickstart-sign-in-status').textContent = 'Signed out';
				  document.getElementById('quickstart-sign-in').textContent = 'Sign in';
				  //document.getElementById('signout').disabled = true;
				  //document.getElementById('quickstart-account-details').textContent = 'null';
				  // [END_EXCLUDE]
				}
				// [START_EXCLUDE silent]
				document.getElementById('quickstart-sign-in').disabled = false;
				// [END_EXCLUDE]
			  });
			  // [END authstatelistener]

			  document.getElementById('quickstart-sign-in').addEventListener('click', toggleSignIn, false);
			  document.getElementById('quickstart-sign-up').addEventListener('click', handleSignUp, false);
			 // document.getElementById('quickstart-verify-email').addEventListener('click', sendEmailVerification, false);
			  document.getElementById('quickstart-password-reset').addEventListener('click', sendPasswordReset, false);
		}
		

		function InitialiseFontType(attempts)
		{
			
		
			var fontTypeDropDown = document.getElementById("fontTypeOption");
			
			for (a in fontTypeDropDown.options) { fontTypeDropDown.options.remove(0); }
			
			d = new Detector();
			
			var fontList = [
			'Arial',
			'Gamja Flower',
			'Song Myung',
			'Hi Melody',
			'Nanum Pen Script',
			'Sunflower',
			'Nanum Myeongjo',
			'Cute Font',
			'Poor Story',
			'Yeon Sung',
			'Stylish',
			'Gothic A1',
			'Batang',
			'Dotum',
			'Gulim',
			'Gungsuh'
			];
			
			var chosenFont = 'Arial';
			fontTypeDropDown.value='Arial';
			
			for(var i=0;i<fontList.length;i++)
			{
				var detection = d.detect(fontList[i]);
				if(detection)
				{
					var opt = document.createElement('option');
					opt.value = fontList[i];
					opt.innerHTML = fontList[i];
					fontTypeDropDown.appendChild(opt);
				}
				else if(attempts<30)
				{
					sleep(500).then(() => { InitialiseFontType(attempts+1); });
					return;
				}
			}
			
			var objectStore3 = db.transaction(["wordsdb"]).objectStore("wordsdb");
			var request3 = objectStore3.get("fonttype$");
			request3.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
				request3.onsuccess = function(event) {
				if(request3.result) {
						var a = request3.result.appearances;
					for(var i=0;i<fontTypeDropDown.options.length;i++)
					{
						if(fontTypeDropDown.options[i].value==a)
						{
							fontTypeDropDown.value=a;
							chosenFont= a;
						}
					}
						document.documentElement.style.setProperty('--font-type', chosenFont);
					}
	
				};
				
				
		}
		
		function InitialiseDictLanguage()
		{
				var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("dictlanguage$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
					
					
				request.onsuccess = function(event) {
				if(request.result) {
						var a = request.result.appearances;
						dictionaryLanguage = a;					
					}
					else
					{
						dictionaryLanguage = dictionaryLanguageDefault;
					}
					var dropDown = document.getElementById("dictLanguageOption");
					dropDown.value = dictionaryLanguage;
					var dropDown2 = document.getElementById("dictLanguageOption2");
					dropDown2.value = dictionaryLanguage;
					changeDictionarySrc(" ‍ ");
				};
		}

		
		
		function Reset(deleteWords)
		{
			clearTimeout(colourTimeout);
			clearTimeout(scrollTimeout);
			clearTimeout(vocabularyTimeout);
			clearTimeout(displaySortTimeout);
			clearTimeout(statisticsTimeout);
			clearTimeout(highlightTimeout);
			clearTimeout(unmarkJumpTimeout);
			clearTimeout(calculateStatisticsTimeout);
			if(deleteWords)
			{
			SaveHTML("");
			}
			var container = document.getElementById ("pasteArea");
			container.innerHTML="";
			ClearStatistics();
		}
		
		function CreateGraph(data,data2)
		{
						if(myChart)
			{
				myChart.destroy();
			}
			if(myChart3)
			{
				myChart3.destroy();
			}
			
			
			
			data.sort(sort_by('occurances', true, parseInt));
			data2.sort(sort_by('occurances', true, parseInt));
			var accumulativeWords = [];
			var xAxis=[];
			var total=0;
			for(var i=0;i<data.length;i++)
			{
				
				total+=data[i].occurances
				xAxis.push(i+1);
				accumulativeWords.push(total);
			}
			var accumulativeWords2 = [];
			var xAxis2=[];
			var total2=0;
			for(var i=0;i<data2.length;i++)
			{
				
				total2+=data2[i].occurances
				xAxis2.push(i+1);
				accumulativeWords2.push(total2);
			}
			
			var customTooltips = function(tooltip) {
			// Tooltip Element
			var tooltipEl = document.getElementById('chartjs-tooltip');

			if (!tooltipEl) {
				tooltipEl = document.createElement('div');
				tooltipEl.id = 'chartjs-tooltip';
				tooltipEl.innerHTML = '<table></table>';
				this._chart.canvas.parentNode.appendChild(tooltipEl);
			}

			// Hide if no tooltip
			if (tooltip.opacity === 0) {
				tooltipEl.style.opacity = 0;
				return;
			}

			// Set caret Position
			tooltipEl.classList.remove('above', 'below', 'no-transform');
			if (tooltip.yAlign) {
				tooltipEl.classList.add(tooltip.yAlign);
			} else {
				tooltipEl.classList.add('no-transform');
			}

			function getBody(bodyItem) {
				return bodyItem.lines;
			}

			// Set Text
			if (tooltip.body) {
				var titleLines = tooltip.title || [];
				var bodyLines = tooltip.body.map(getBody);

				var innerHtml = '<thead>';
				
				titleLines.forEach(function(title) {
					innerHtml += '<tr><th>' +"Unique Words: "+ title +" ("+(Math.round(((title/data.length)*100 + Number.EPSILON) * 100) / 100)+"%)"+'</th></tr>';
				});
				
				
				
				innerHtml += '</thead><tbody>';

				bodyLines.forEach(function(body, i) {
					var colors = tooltip.labelColors[i];
					var style = 'background:' + colors.backgroundColor;
					style += '; border-color:' + colors.borderColor;
					style += '; border-width: 2px';
					var b = []
					var body = (""+body);
					b = body.trim().split(/[, ]+/);
					var span = '<span class="chartjs-tooltip-key" style="' + style + '"></span>';
					innerHtml += '<tr><td>' +span+ b[2] +" ("+(Math.round(((b[2]/total)*100 + Number.EPSILON) * 100) / 100)+"%)"+ '</td></tr>';
				});
				innerHtml += '</tbody>';

				var tableRoot = tooltipEl.querySelector('table');
				tableRoot.innerHTML = innerHtml;
			}

			var positionY = this._chart.canvas.offsetTop;
			var positionX = this._chart.canvas.offsetLeft;

			// Display, position, and set styles for font
			tooltipEl.style.opacity = 1;
			tooltipEl.style.left = positionX + tooltip.caretX + 'px';
			tooltipEl.style.top = positionY + tooltip.caretY + 'px';
			tooltipEl.style.fontFamily = tooltip._bodyFontFamily;
			tooltipEl.style.fontSize = tooltip.bodyFontSize + 'px';
			tooltipEl.style.fontStyle = tooltip._bodyFontStyle;
			tooltipEl.style.padding = tooltip.yPadding + 'px ' + tooltip.xPadding + 'px';
		};
			
			
			var ctx = document.getElementById('myChart').getContext('2d');
			myChart = new Chart(ctx, {
				type: 'line',
				data: {
					labels: xAxis,
					datasets: [{
					label: "Current Text",
						data: accumulativeWords,
						backgroundColor: 'rgba(153, 102, 255, .5)',
						borderColor: 'rgba(153, 102, 255, .5)',
						fill: true,
				}, {
					label: "Known Words",
						data: accumulativeWords2,
						backgroundColor: 'rgba(255, 159, 64, .5)',
						borderColor: 'rgba(255, 159, 64, .5)',
						fill: true,
				}]
				},
				options: {
					responsive: true,
				title: {
					display: true,
					text: 'Cumulative Word Total vs Unique Words'
				},
				tooltips: {
						enabled: false,
						mode: 'index',
						position: 'nearest',
						custom: customTooltips
					},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Unique Words'
						}
					}],
					yAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Cumulative Word Total'
						}
					}]
				}
				}
			});
		}
		
		
		
		function CreateGraph3(data,data2)
		{
		
			if(myChart)
			{
				myChart.destroy();
			}
			if(myChart3)
			{
				myChart3.destroy();
			}
			data.sort(sort_by('occurances', true, parseInt));
			data2.sort(sort_by('occurances', true, parseInt));
			var accumulativeWords = [];
			var xAxis=[];
			var total=0;
			for(var i=0;i<data.length;i++)
			{
				
				total+=data[i].occurances;
				xAxis.push(i+1);
				accumulativeWords.push(total);
			}
			var accumulativeWords2 = [];
			var xAxis2=[];
			var total2=0;
			for(var i=0;i<data2.length;i++)
			{
				
				total2+=data2[i].occurances;
				xAxis2.push(i+1);
				accumulativeWords2.push(total2);
			}
			
			var customTooltips = function(tooltip) {
			// Tooltip Element
			var tooltipEl = document.getElementById('chartjs-tooltip');

			if (!tooltipEl) {
				tooltipEl = document.createElement('div');
				tooltipEl.id = 'chartjs-tooltip';
				tooltipEl.innerHTML = '<table></table>';
				this._chart.canvas.parentNode.appendChild(tooltipEl);
			}

			// Hide if no tooltip
			if (tooltip.opacity === 0) {
				tooltipEl.style.opacity = 0;
				return;
			}

			// Set caret Position
			tooltipEl.classList.remove('above', 'below', 'no-transform');
			if (tooltip.yAlign) {
				tooltipEl.classList.add(tooltip.yAlign);
			} else {
				tooltipEl.classList.add('no-transform');
			}

			function getBody(bodyItem) {
				return bodyItem.lines;
			}

			// Set Text
			if (tooltip.body) {
				var titleLines = tooltip.title || [];
				var bodyLines = tooltip.body.map(getBody);

				var innerHtml = '<thead>';
				
				titleLines.forEach(function(title) {
					innerHtml += '<tr><th>' +"Unique Words: "+ title +" ("+(Math.round(((title/data.length)*100 + Number.EPSILON) * 100) / 100)+"%)"+'</th></tr>';
				});
				
				
				
				innerHtml += '</thead><tbody>';

				bodyLines.forEach(function(body, i) {
					var colors = tooltip.labelColors[i];
					var style = 'background:' + colors.backgroundColor;
					style += '; border-color:' + colors.borderColor;
					style += '; border-width: 2px';
					var b = []
					var body = (""+body);
					b = body.trim().split(/[, ]+/);
					var span = '<span class="chartjs-tooltip-key" style="' + style + '"></span>';
					innerHtml += '<tr><td>' +span+ b[2] +" ("+(Math.round(((b[2]/total)*100 + Number.EPSILON) * 100) / 100)+"%)"+ '</td></tr>';
				});
				innerHtml += '</tbody>';

				var tableRoot = tooltipEl.querySelector('table');
				tableRoot.innerHTML = innerHtml;
			}

			var positionY = this._chart.canvas.offsetTop;
			var positionX = this._chart.canvas.offsetLeft;

			// Display, position, and set styles for font
			tooltipEl.style.opacity = 1;
			tooltipEl.style.left = positionX + tooltip.caretX + 'px';
			tooltipEl.style.top = positionY + tooltip.caretY + 'px';
			tooltipEl.style.fontFamily = tooltip._bodyFontFamily;
			tooltipEl.style.fontSize = tooltip.bodyFontSize + 'px';
			tooltipEl.style.fontStyle = tooltip._bodyFontStyle;
			tooltipEl.style.padding = tooltip.yPadding + 'px ' + tooltip.xPadding + 'px';
		};
			
			
			var ctx = document.getElementById('myChart3').getContext('2d');
			myChart3 = new Chart(ctx, {
				type: 'line',
				data: {
					labels: xAxis,
					datasets: [{
					label: "Current Text",
						data: accumulativeWords,
						backgroundColor: 'rgba(153, 102, 255, .5)',
						borderColor: 'rgba(153, 102, 255, .5)',
						fill: true,
				}, {
					label: "TOPIK Words",
						data: accumulativeWords2,
						backgroundColor: 'rgba(51, 102, 255, .5)',
						borderColor: 'rgba(51, 102, 255, .5)',
						fill: true,
				}]
				},
				options: {
					responsive: true,
				title: {
					display: true,
					text: 'Cumulative Word Total vs Unique Words'
				},
				tooltips: {
						enabled: false,
						mode: 'index',
						position: 'nearest',
						custom: customTooltips
					},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Unique Words'
						}
					}],
					yAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Cumulative Word Total'
						}
					}]
				}
				}
			});
		}
		
		function InitialiseVoice()
		{
			var sliderPitch = document.getElementById("voicePitchSlider");
			var outputPitch = document.getElementById("pitchOutput");
			
			var objectStore4 = db.transaction(["wordsdb"]).objectStore("wordsdb");
			var request4 = objectStore4.get("voicePitch$");
			request4.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
					
				outputPitch.innerHTML = (sliderPitch.value/10);
				
				request4.onsuccess = function(event) {
					if(request4.result) 
					{
							var a = request4.result.appearances;
							sliderPitch.value = a*10;
							outputPitch.innerHTML = a;
							voicePitch = a;
					}
	
				};
			
			sliderPitch.oninput = function() {
				var value = this.value/10;
			  outputPitch.innerHTML = (value);
			  voicePitch = (value);
			  
				var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("voicePitch$");
				request.onerror = function(event) {
					alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "voicePitch$",appearances: value});
					}
					else
					{
						addwordtodb("voicePitch$",value);
					}
				}
			}
			
			var sliderVolume = document.getElementById("voiceVolumeSlider");
			var outputVolume = document.getElementById("volumeOutput");
			
			
			var objectStore5 = db.transaction(["wordsdb"]).objectStore("wordsdb");
			var request5 = objectStore5.get("voiceVolume$");
			request5.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
					
				outputVolume.innerHTML = (sliderVolume.value/10); 
				
				request5.onsuccess = function(event) {
					if(request5.result) 
					{
							var a = request5.result.appearances;
							sliderVolume.value = a*10;
							outputVolume.innerHTML = a;
							voiceVolume = a;
							
					}
	
				};
			
			
			sliderVolume.oninput = function() {
			var value = this.value/10;
			  outputVolume.innerHTML = (value);
			  voiceVolume = (value);
			  
			  			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("voiceVolume$");
				request.onerror = function(event) {
					alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "voiceVolume$",appearances: value});
					}
					else
					{
						addwordtodb("voiceVolume$",value);
					}
				}
			}
			
			var sliderSpeed = document.getElementById("voiceSpeedSlider");
			var outputSpeed = document.getElementById("speedOutput");
			
					var objectStore6 = db.transaction(["wordsdb"]).objectStore("wordsdb");
			var request6 = objectStore6.get("voiceSpeed$");
			request6.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
					
						outputSpeed.innerHTML = (sliderSpeed.value/10);
				
				request6.onsuccess = function(event) {
					if(request6.result) 
					{
							var a = request6.result.appearances;
							sliderSpeed.value = a*10;
							outputSpeed.innerHTML = a;
							voiceSpeed = a;
							
					}
	
				};
			sliderSpeed.oninput = function() {
			var value = this.value/10;
			  outputSpeed.innerHTML = (value);
			  voiceSpeed = (value);
			  
			  			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("voiceSpeed$");
				request.onerror = function(event) {
					alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "voiceSpeed$",appearances: value});
					}
					else
					{
						addwordtodb("voiceSpeed$",value);
					}
				}
			}
		
			var objectStore2 = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request2 = objectStore2.get("enableVoice$");
	        request2.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
	        request2.onsuccess = function(event) {          
	          if(request2.result) {
					var a = request2.result.appearances;
					if(a==0)
					{
						enableVoice = false;
						document.getElementById("enableVoice").checked = false;
					}
					else
					{
						enableVoice = true;
						document.getElementById("enableVoice").checked = true;
					}
			}
					else
					{
						if(enableVoice)
						{
							addwordtodb("enableVoice$",1);
							document.getElementById("enableVoice").checked = true;
						}
						else
						{
							addwordtodb("enableVoice$",0);
							document.getElementById("enableVoice").checked = false;
						}
					}
			};
			
			var voices;
			if(window.speechSynthesis.getVoices().length == 0) {
				window.speechSynthesis.addEventListener('voiceschanged', function() {
					voices = window.speechSynthesis.getVoices();
					PopulateVoiceDropDown(voices);
				});
			}
			else {
				voices = window.speechSynthesis.getVoices();
				PopulateVoiceDropDown(voices);
			}
		}
		
		function PopulateVoiceDropDown(voices)
		{
			var voiceDropDown = document.getElementById("voiceOption");
			var length = voiceDropDown.options.length;
			for (i = length-1; i >= 0; i--) {
			  voiceDropDown.options[i] = null;
			}
				voices.forEach(function(voice) {
				if(voice.lang=="ko-KR")
				{
					var opt = document.createElement('option');
					opt.value = voice.name;
					opt.innerHTML = voice.name;
					voiceDropDown.appendChild(opt);
				}
			});
			
					var objectStore3 = db.transaction(["wordsdb"]).objectStore("wordsdb");
			var request3 = objectStore3.get("voice$");
			request3.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
				
				request3.onsuccess = function(event) {
				if(request3.result) {
						var a = request3.result.appearances;
					for(var i=0;i<voiceDropDown.options.length;i++)
					{
						if(voiceDropDown.options[i].value==a)
						{
							voiceDropDown.value=voiceDropDown.options[i].value;
						}
					}
						
					}
	
				};
		}
		
		function GetIndexOfVoice(name)
		{
			var index =-1;
			var voices = window.speechSynthesis.getVoices();
			for(var i=0;i<voices.length;i++)
			{
				if(name==voices[i].name)
				{
					index=i;
					break;
				}
			}
			return index;
		}
		
		function SpeakWord(word)
		{
			var voiceDropDown = document.getElementById("voiceOption").value;
			var voiceIndex=GetIndexOfVoice(voiceDropDown); //TODO move elsewhere?
			if(voiceIndex==-1)
			{
				alert("Voice not found");
			}
			else
			{
				speechSynthesis.cancel();
				var msg = new SpeechSynthesisUtterance();
				var voices = window.speechSynthesis.getVoices();
				msg.voice = voices[voiceIndex]; // Note: some voices don't support altering params
	
				msg.voiceURI = 'native';
				msg.volume = voiceVolume;
				msg.rate = voiceSpeed;
				msg.pitch = voicePitch;
				msg.text = word;
				speechSynthesis.speak(msg);
			}
		}
		
		function AsyncChangeColour(word, incrementByOne, skipJump)
		{
		
							if(colourTimeout)
						{	
							clearTimeout(colourTimeout);
						}
						colourTimeout = setTimeout(function() {
							ChangeColour(word, incrementByOne, skipJump);
						}, 50);
		}
	
		
		function ChangeColour(word, incrementByOne, skipJump)
		{

		
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.get(word);
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
	        request.onsuccess = function(event) {          
	          if(request.result) {
					var w = request.result.word;
					var a;
						if(incrementByOne)
						{
							a = request.result.appearances+1;
						}
						else
						{
							a = request.result.appearances;
						}
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: w,appearances: a});
					
					var remainder = a%3;
					if(remainder==0)
					{
						unknownWordsTabUpToDate = false;
						knownWordsTabUpToDate = false;
						GetPageAndHighlight(w,0,skipJump);
						
					}
					else if(remainder==1)
					{	
						unknownWordsTabUpToDate = false;
						learningWordsTabUpToDate = false;
						GetPageAndHighlight(w,1,skipJump);
						
					}
					else if(remainder==2)
					{
						knownWordsTabUpToDate = false;
						learningWordsTabUpToDate = false;
						GetPageAndHighlight(w,2,skipJump);
						
					}
	
	          } else {
					unknownWordsTabUpToDate = false;
					addwordtodb(word,((startingMark+1)%3));
					GetPageAndHighlight(word,((startingMark+1)%3),skipJump);
					
	          }

			  AsyncCalculateStatistics();
			 
	        };
		}
		
		function setCurrentColour(word,pageNo)
		{
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.get(word);
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
	        request.onsuccess = function(event) {          
	          if(request.result) {
					var w = request.result.word;
					var a = request.result.appearances;
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: w,appearances: a});
					
					var remainder = a%3;
					if(remainder==0)
					{
						AsyncHighlight(w,0,true,pageNo);
					}
					else if(remainder==1)
					{
						AsyncHighlight(w,1,true,pageNo);
					}
					else if(remainder==2)
					{
						AsyncHighlight(w,2,true,pageNo);
					}
	
	          } else {
					addwordtodb(word,startingMark);
					AsyncHighlight(word,startingMark,true,pageNo);
	          }
	        };
		}
		
		function UnmarkJump(items)
		{
		
			var word="";
			if(items.length > 0)
			{
				word=(items[0].innerText);
			}
		
			var optionsDeleteJump = {
			"className": 'jump'
			}
			
			if(word!="")
			{
				ChangeColour(word,false,true);
			}
			
			var instance = new Mark(document.querySelector("div.content"));
			instance.unmark(optionsDeleteJump);
			
			
		}
		
		function JumpToSentence(word)
		{
			window.find(word,false,true,true);
			pendingLookup = word;
			if(enableVoice)
			{
				SpeakWord(word);
			}
		}
		
		function JumpTo(word)
		{
				//if(browser=="edge")
				//{
				//	return false;
				//}
				
				var container = document.getElementById ("pasteArea");
				const items = container.getElementsByClassName('jump');
				if(items.length > 0)
				{
					if(items[0].innerText==word)
					{
						jumpAttempts=(jumpAttempts+1)%items.length;
					}
					else
					{
						jumpAttempts = 0;
					}
					
				}
				else
				{
					jumpAttempts = 0;
				}
				UnmarkJump(items);
				var optionsJump = {
					"accuracy": {
						"value": "exactly",
						"limiters": limiters
					}, "className": 'jump'
				};
		
			var instance = new Mark(document.querySelector("div.content"));
			instance.mark(word,optionsJump);
			
			
			if(enableVoice)
			{
				SpeakWord(word);
			}
			dictionaryLookup(word);
			imagesLookup(word);
			pendingLookup = word;
			GrammarLookup(word);
			
			if (items.length > 0) {
			  scrollTo({
				top: items[jumpAttempts].offsetTop-(window.innerHeight*.1),
			behavior: 'auto'
			  });
			}
			jumpMarked = true;
		}
		
		function GetPageAndHighlight(word,colorIndex, skipJump)
		{
			var divs = document.getElementsByClassName("individualPage");
			var pageTop = $(window).scrollTop();
			var pageBot = pageTop + $(window).height();
					//var toMark = [];
					for(var i=0;i<divs.length;i++)
					{
						var divTop = divs[i].offsetTop;
						var divBot = divTop+divs[i].offsetHeight;
	
						if(divBot>pageTop-450&&divTop<pageBot+450)
						{
							if(divs[i].marked)
							{	
								AsyncHighlight(word,colorIndex,skipJump,i);
							}
						}
					}
		}
		
		function AsyncHighlight(word, colourIndex, skipJump, pageNo)
		{
			
						highlightTimeout = setTimeout(function() {
							Highlight(word, colourIndex, skipJump,pageNo);
						}, 100);
			
		}
		
		function Highlight(word, colourIndex, skipJump, pageNo)
		{
				if(skipJump)
				{
						var optionsTertiary = {
						"accuracy": {
							"value": "exactly",
							"limiters": limiters
						}, "className": 'tertiary',
						"exclude":['.jump']
					};
			
					var optionsSecondary = {
						"accuracy": {
							"value": "exactly",
							"limiters": limiters
						}, "className": 'secondary',
						"exclude":['.jump']
					};
					
					var optionsPrimary = {
						"accuracy": {
							"value": "exactly",
							"limiters": limiters
						}, "className": 'primary',
						"exclude":['.jump']
					};
				}
				else
				{
						var optionsTertiary = {
						"accuracy": {
							"value": "exactly",
							"limiters": limiters
						}, "className": 'tertiary'
					};
			
					var optionsSecondary = {
						"accuracy": {
							"value": "exactly",
							"limiters": limiters
						}, "className": 'secondary'
					};
					
					var optionsPrimary = {
						"accuracy": {
							"value": "exactly",
							"limiters": limiters
						}, "className": 'primary'
					};
				}

						var instance = new Mark(GetPage(pageNo));
					
					
					if(colourIndex==0)
					{
						instance.mark(word,optionsPrimary);
					}
					else if (colourIndex==1)
					{
						instance.mark(word,optionsSecondary);
					}
					else if (colourIndex==2)
					{
						instance.mark(word,optionsTertiary);
					}
				//}
		}
		
		function unmark()
		{
			if(all_marked)
			{
				var instance = new Mark(document.querySelector("div.content"));
				instance.unmark();
				all_marked = false;
			}
		}
	
		
		function markAll(toMark)
		{
				for(var i=0;i<toMark.length;i++)
				{	
					var page = GetPage(toMark[i]);
					if(page.marked==false)
					{
						var words = page.innerText;
						words=words.replace(replaceCharacters," ");
	
						var wordArray = words.trim().split(/[, ]+/);
						for(var j=0;j<wordArray.length;j++)
						{
							setCurrentColour(wordArray[j],toMark[i]);
						}
						page.marked = true;
					}
				}
				all_marked = true;
		}
	
		function addwordtodb(w,a)
		{
			var request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").add({ word: w,appearances: a});
	                                 
	        request.onsuccess = function(e) {
	        };
	         
	        request.onerror = function(e) {     
	        }   
	
		}
		
		function mouseUp(modifier){
		
			if(!all_marked&&enableHighlighting)
			{
				onScroll();
			}
			
			var selectedText = getSelectionText();
			
			
			if(jumpMarked)
			{
				var container = document.getElementById ("pasteArea");
				const items = container.getElementsByClassName('jump');
				
				
				unmarkJumpTimeout = setTimeout(function() {
							UnmarkJump(items);
						}, 200);
				
				
				
				jumpMarked = false;
			}
			else if(modifier==0||modifier==1)
			{
				if(selectedText!="")
				{

						if(enableVoice)
						{
							SpeakWord(selectedText);
						}
						dictionaryLookup(selectedText);
						imagesLookup(selectedText);
						pendingLookup = selectedText;
						GrammarLookup(selectedText);
				}
				else
				{
					var selection = window.getSelection();	
					if (!selection || selection.rangeCount < 1) return true;
					var range = selection.getRangeAt(0);
					var node = selection.anchorNode;
					var word_regexp = regExp;
					
					while ((range.startOffset > 0) && range.toString().match(word_regexp)) {
					  range.setStart(node, (range.startOffset - 1));
					}
					if (!range.toString().match(word_regexp)) {
					  range.setStart(node, range.startOffset + 1);
					}
					while ((range.endOffset < node.length) && range.toString().match(word_regexp)) {
					  range.setEnd(node, range.endOffset + 1);
					}
					if (!range.toString().match(word_regexp)) {
					  range.setEnd(node, range.endOffset - 1);
					}
				
					var word = range.toString(); 
					word=word.replace(replaceCharacters,"");
					if(word==""&&browser=="chrome")
					{
					   var t = '';
						if (window.getSelection && (sel = window.getSelection()).modify) {
							// Webkit, Gecko
							var s = window.getSelection();
							

								s.modify('extend', 'forward', 'character');
								var testString = s.toString();
								testString = testString.replace(replaceCharacters,"");
								if(testString!='')
								{
									s.modify('extend', 'forward', 'word');
									s.modify('extend', 'forward', 'word');
									s.modify('extend', 'forward', 'word');
									s.modify('extend', 'forward', 'word');
									s.modify('extend', 'forward', 'word');
									s.modify('extend', 'forward', 'word');
									s.modify('extend', 'forward', 'word');
									s.modify('extend', 'forward', 'word');
									s.modify('extend', 'forward', 'word');
									s.modify('extend', 'forward', 'word');
									t = s.toString();
									t=t.replace(replaceCharacters," ");
									
									
									
									t=t.trim();
									for (var i = 0; i < t.length; i++) {
									  if(t.charAt(i)==" ")
									  {
										t = t.substring(0,i);
										break;
									  }
									}
								}
								
								
							
								
							word = t;
						}
					}		
					if(word!="")
					{
							if(modifier==1&&enableHighlighting)
							{
								
								AsyncChangeColour(word, true,false);
							}
							if(enableVoice)
								{
									SpeakWord(word);
								}	
							
							dictionaryLookup(word);
							imagesLookup(word);
							pendingLookup = word;
							GrammarLookup(word);
							
							var selection = window.getSelection ? window.getSelection() : document.selection ? document.selection : null;
							if(!!selection) selection.empty ? selection.empty() : selection.removeAllRanges();
					}
						
					
				}
				
				if(modifier==0)
				{
					if(openedTab!="DictionaryTab")
					{
						document.getElementById("DictionaryTabButton").click();
					}
					
				}
				
			}
			else
			{
				selectedText=selectedText.replace(replaceCharacters,"");
				if(selectedText!="")
				{
					if(enableHighlighting)
					{
						AsyncChangeColour(selectedText, true,false);
					}
					if(enableVoice)
					{
						SpeakWord(selectedText);
					}
					dictionaryLookup(selectedText);
					imagesLookup(selectedText);
					pendingLookup = selectedText;
					GrammarLookup(selectedText);
				}
				var selection = window.getSelection ? window.getSelection() : document.selection ? document.selection : null;
				if(!!selection) selection.empty ? selection.empty() : selection.removeAllRanges();
			}
		}
	
		function getSelectionText() {
			var text = "";
			if (window.getSelection) {
				text = window.getSelection().toString();
			} else if (document.selection && document.selection.type != "Control") {
				text = document.selection.createRange().text;
			}
			return text;
		}
		
		
		function dictionaryLookup(word)
		{

			if(openedTab=="DictionaryTab")
			{
				var maxLength = 30;
				if(word.length>maxLength)
				{
					word = word.substring(0, maxLength);	
				}
				
				if(dictionaryLookingUp!=word)
				{
					
					changeDictionarySrc(word);
				}
				dictionaryLookingUp = word;
			}
		}
		
		function RemoveSelection(index)
		{
			if(index==0)
			{
				var naverIframe = document.getElementById('naverIframe');
				naverIframe.blur();
			}
			else
			{
				var body = document.getElementById('body');
				body.blur;
			}
		}
		
		function imagesLookup(word)
		{	
			if(openedTab=="ImagesTab")
			{
				var maxLength = 30;
				if(word.length>maxLength)
				{
					word = word.substring(0, maxLength);	
				}
				
				if(imagesLookingUp!=word)
				{
					
					changeImagesSrc(word);
				}
				imagesLookingUp = word;
				
			}
		}
		
		function ConvertLangCode(w)
		{
			var code;
			switch(w)
			{
				case "Korean-Korean":code="ko"; break;
				case "English":code="en"; break;
				case "Japanese":code="ja"; break;
				case "Chinese":code="zh"; break;
				case "French":code="frkodict"; break;
				case "Spanish":code="eskodict"; break;
				case "German":code="dekodict"; break;
				case "Vietnamese":code="vikodict"; break;
				case "Nepali":code="nekodict"; break;
				case "Mongolian":code="mnkodict"; break;
				case "Burmese":code="mykodict"; break;
				case "Swahili":code="swkodict"; break;
				case "Arabic":code="arkodict"; break;
				case "Uzbek":code="uzkodict"; break;
				case "Bahasa Indonesian":code="idkodict"; break;
				case "Cambodian":code="kmkodict"; break;
				case "Thai":code="thkodict"; break;
				case "Tetum":code="tetkodict"; break;
				case "Persian":code="fakodict"; break;
				case "Ancient Hebrew":code="hbokodict"; break;
				case "Hindi":code="hikodict"; break;
				case "Modern Greek":code="elkodict"; break;
				case "Ancient Greek":code="grckodict"; break;
				case "Dutch":code="nlkodict"; break;
				case "Latin":code="lakodict"; break;
				case "Russian":code="rukodict"; break;
				case "Romanian":code="rokodict"; break;
				case "Swedish":code="svkodict"; break;
				case "Albanian":code="sqkodict"; break;
				case "Ukrainian":code="ukkodict"; break;
				case "Italian":code="itkodict"; break;
				case "Gruziya":code="kakodict"; break;
				case "Czech":code="cskodict"; break;
				case "Turkish":code="trkodict"; break;
				case "Portuguese":code="ptkodict"; break;
				case "Polish":code="plkodict"; break;
				case "Finnish":code="fikodict"; break;
				case "Hungarian":code="hukodict"; break;
				default: alert("Language code not found");
			}
			return code;
		}
		
		function changeDictionarySrc(text)
		{

			
			var loc;
			
			var langCode = ConvertLangCode(dictionaryLanguage);
			if(langCode.length==2&&!mobileMode)
			{
				loc = "https://"+langCode+".dict.naver.com/#/mini/search?query="+text;
			}
			else if(langCode.length==2&&mobileMode)
			{
				loc = "https://"+langCode+".dict.naver.com/#/search?query="+text;
			}
			else
			{ 
				loc = "https://dict.naver.com/"+langCode+"/#/mini/search?query="+text;
			}
			var naverIframe = document.getElementById('naverIframe');
			naverIframe.src = loc;
			
			setTimeout(function() {RemoveSelection(0);},100);
			setTimeout(function() {RemoveSelection(0);},200);
			setTimeout(function() {RemoveSelection(0);},300);
			setTimeout(function() {RemoveSelection(0);},400);
			setTimeout(function() {RemoveSelection(0);},500);
			setTimeout(function() {RemoveSelection(0);},600);
			setTimeout(function() {RemoveSelection(0);},700);
			setTimeout(function() {RemoveSelection(0);},800);
			setTimeout(function() {RemoveSelection(0);},900);
			setTimeout(function() {RemoveSelection(0);},1000);
			setTimeout(function() {RemoveSelection(0);},1500);
			setTimeout(function() {RemoveSelection(0);},2000);
	
			
			//}
		}
		
		function changeImagesSrc(text)
		{

			var loc;
			//loc = "https://www.bing.com/images/search?q="+text;
			loc = "https://www.picsearch.com/index.cgi?q="+text;
			imagesIframe = document.getElementById('imagesIframe');
			imagesIframe.src = loc;

			
			setTimeout(function() {RemoveSelection(1);},100);
			setTimeout(function() {RemoveSelection(1);},200);
			setTimeout(function() {RemoveSelection(1);},300);
			setTimeout(function() {RemoveSelection(1);},400);
			setTimeout(function() {RemoveSelection(1);},500);
			setTimeout(function() {RemoveSelection(1);},600);
			setTimeout(function() {RemoveSelection(1);},700);
			setTimeout(function() {RemoveSelection(1);},800);
			setTimeout(function() {RemoveSelection(1);},900);
			setTimeout(function() {RemoveSelection(1);},1000);
			setTimeout(function() {RemoveSelection(1);},1500);
			setTimeout(function() {RemoveSelection(1);},2000);
			setTimeout(function() {RemoveSelection(1);},3000);
			setTimeout(function() {RemoveSelection(1);},4000);
			setTimeout(function() {RemoveSelection(1);},5000);
			setTimeout(function() {RemoveSelection(1);},6000);
			setTimeout(function() {RemoveSelection(1);},7000);
		}
		
		function toggleEnableVoice()
		{
			if(document.getElementById("enableVoice").checked)
			{
				enableVoice=true;
			
				var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("enableVoice$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "enableVoice$",appearances: 1});
					}
					else
					{
						addwordtodb("enableVoice$",1);
					}
				}
	
						
			}
			else
			{
				enableVoice=false;
				speechSynthesis.cancel();	
				var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("enableVoice$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "enableVoice$",appearances: 0});
					}
											else
					{
						addwordtodb("enableVoice$",0);
					}
				}
		
			}
		}
		
		
		function toggleEnableHighlighting()
		{
		if(document.getElementById("enableHighlighting").checked)
			{
				enableHighlighting=true;
				all_marked=false;
			
				var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("enableHighlighting$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "enableHighlighting$",appearances: 1});
					}
					else
					{
						addwordtodb("enableHighlighting$",1);
					}
				}
	
						
			}
			else
			{
				enableHighlighting=false;
				all_marked=true;
				unmark();
				
				ClearStatistics();
				
				
					
				var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("enableHighlighting$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "enableHighlighting$",appearances: 0});
					}
											else
					{
						addwordtodb("enableHighlighting$",0);
					}
				}
		
			}
			OnInput();
		}
	
	
	function ClearStatistics()
	{
		var tt = $('#unknownWordsDataTableSummary').DataTable();
					tt.clear().draw();

				var t = $('#unknownWordsDataTable').DataTable();
					t.clear().draw();
					
					var tt2 = $('#learningWordsDataTableSummary').DataTable();
					tt2.clear().draw();

				var t2 = $('#learningWordsDataTable').DataTable();
					t2.clear().draw();
					
					var tt3 = $('#knownWordsDataTableSummary').DataTable();
					tt3.clear().draw();

				var t3 = $('#knownWordsDataTable').DataTable();
					t3.clear().draw();
					
					var tt4 = $('#allWordsDataTableSummary').DataTable();
					tt4.clear().draw();

				var t4 = $('#allWordsDataTable').DataTable();
					t4.clear().draw();
					
				var t5 = $('#vocabularyDataTable').DataTable();
				t5.clear().draw();
				
			var tt5 = $('#vocabularyDataTableSummary').DataTable();
			tt5.clear().draw();
			
				var t6 = $('#compareDataTable').DataTable();
				t6.clear().draw();
						
				if(myChart)
				{
					myChart.destroy();
				}
				
			document.getElementById("UnknownWordsTabButton").innerHTML='Unknown Words <sup>[4]</sup>';
			document.getElementById("LearningWordsTabButton").innerHTML="Learning Words <sup>[5]</sup>";
			document.getElementById("KnownWordsTabButton").innerHTML="Known Words <sup>[6]</sup>";
	}
	
	function openTab(evt, tabName, tabLink) {
	
	if(!initialisationComplete)
	{
		return false;
	}
	
	ShowMenu(false);
	
	if((openedTab==tabName&&(tabName=="OptionsTab"||tabName=="DictionaryTab"||tabName=="AboutTab"||tabName=="LoginTab"||tabName=="ImagesTab"||tabName=="GrammarTab"||tabName=="StatisticsTab"||tabName=="ExportTab"||tabName=="ImportTab"||tabName=="LanguageTab"))
	||
	((tabName=="StatisticsTab")&&(openedTab!=""&&openedTab!="OptionsTab"&&openedTab!="GrammarTab"&&openedTab!="DictionaryTab"&&openedTab!="AboutTab"&&openedTab!="LoginTab"&&openedTab!="ExportTab"&&openedTab!="ImagesTab"&&openedTab!="ImportTab"&&openedTab!="LanguageTab"))
	)
	{
		ShowSidebar(false); 
		openedTab="";
		tabcontent = document.getElementsByClassName("tabcontent");
		  for (i = 0; i < tabcontent.length; i++) {
			tabcontent[i].style.display = "none";
		  }
		  tablinks = document.getElementsByClassName(tabLink);
		  for (i = 0; i < tablinks.length; i++) {
			tablinks[i].className = tablinks[i].className.replace(" active", "");
		  }
		  return;
	}
	else
	{
		ShowSidebar(true);
		openedTab = tabName;
		  var i, tabcontent, tablinks;
		
		  tabcontent = document.getElementsByClassName("tabcontent");
		  for (i = 0; i < tabcontent.length; i++) {
			tabcontent[i].style.display = "none";
		  }
		  tablinks = document.getElementsByClassName(tabLink);
		  for (i = 0; i < tablinks.length; i++) {
			tablinks[i].className = tablinks[i].className.replace(" active", "");
		  }
		  document.getElementById(tabName).style.display = "block";
		  evt.currentTarget.className += " active";
		  
	  }
	  
	
	  
	  
	  if(tabName=="OptionsTab"||tabName=="DictionaryTab"||tabName=="AboutTab"||tabName=="LoginTab"||tabName=="ImagesTab"||tabName=="ExportTab"||tabName=="ImportTab"||tabName=="LanguageTab"||tabName=="GrammarTab")
	  {
		document.documentElement.style.setProperty('--tab-top-percent', '0%');
		document.documentElement.style.setProperty('--tab-bot-percent', '100%');
		/*document.getElementById("UnknownWordsTabButton").style.display="none";
		document.getElementById("KnownWordsTabButton").style.display="none";
		document.getElementById("AllWordsTabButton").style.display="none";
		document.getElementById("LearningWordsTabButton").style.display="none";
		document.getElementById("VocabularyTabButton").style.display="none";
		document.getElementById("CompareTabButton").style.display="none";
		document.getElementById("GraphTabButton").style.display="none";*/
		
	  }
	  else
	  {
	  tablinks = document.getElementsByClassName('toptabs');
		for (i = 0; i < tablinks.length; i++)
		{
			
			tablinks[i].className = tablinks[i].className.replace(" active", "");

			
			if(tablinks[i].id=="StatisticsTabButton")
			{
				tablinks[i].className+= " active";
			}
		}
	  
		document.documentElement.style.setProperty('--tab-top-percent', '15%');
		document.documentElement.style.setProperty('--tab-bot-percent', '85%');
	  }
	  
	  if(tabName=="StatisticsTab")
	  {
		var button = "UnknownWordsTabButton";
		
		switch(lastUsedStatsTab)
		{
			case "LearningWordsTab": button = "LearningWordsTabButton"; break;
			case "KnownWordsTab": button = "KnownWordsTabButton"; break;
			case "AllWordsTab": button = "AllWordsTabButton"; break;
			case "VocabularyTab": button = "VocabularyTabButton"; break;
			case "CompareTab": button = "CompareTabButton"; break;
			case "GraphTab": button = "GraphTabButton"; break;
			case "AchievementsTab": button = "AchievementsTabButton"; break;
			case "SentencesTab": button = "SentencesTabButton"; break;
			
		}
		document.getElementById(button).click();
	  }
	  else if((tabName=="UnknownWordsTab"||tabName=="LearningWordsTab"||tabName=="KnownWordsTab"||tabName=="AllWordsTab"||tabName=="GraphTab"||tabName=="AchievementsTab"||tabName=="SentencesTab")
	  && enableHighlighting)
	  {
		AsyncCalculateStatistics();
	  }
	  else if ((tabName=="VocabularyTab"||tabName=="ExportTab"||tabName=="ImportTab") && enableHighlighting)
	  {
	  
	  
	  					if(vocabularyTimeout)
						{	
							clearTimeout(vocabularyTimeout);
						}
						vocabularyTimeout = setTimeout(function() {
							CalculateVocabulary();
						}, 200);
						
	  }
	  else if(tabName=="CompareTab" && enableHighlighting)
	  {
		CompareVocabulary();
		
	  }
	  else if(tabName=="DictionaryTab")
	  {
		dictionaryLookup(pendingLookup);
		setTimeout(function() {RemoveSelection(0);},100);
		setTimeout(function() {RemoveSelection(0);},200);
		setTimeout(function() {RemoveSelection(0);},300);
		setTimeout(function() {RemoveSelection(0);},400);
		setTimeout(function() {RemoveSelection(0);},500);
		setTimeout(function() {RemoveSelection(0);},600);
		setTimeout(function() {RemoveSelection(0);},700);
		setTimeout(function() {RemoveSelection(0);},800);
		setTimeout(function() {RemoveSelection(0);},900);
		setTimeout(function() {RemoveSelection(0);},1000);
		setTimeout(function() {RemoveSelection(0);},1500);
		setTimeout(function() {RemoveSelection(0);},2000);
	  }
	  else if(tabName=="ImagesTab")
	  {
		imagesLookup(pendingLookup);
		setTimeout(function() {RemoveSelection(1);},100);
		setTimeout(function() {RemoveSelection(1);},200);
		setTimeout(function() {RemoveSelection(1);},300);
		setTimeout(function() {RemoveSelection(1);},400);
		setTimeout(function() {RemoveSelection(1);},500);
		setTimeout(function() {RemoveSelection(1);},600);
		setTimeout(function() {RemoveSelection(1);},700);
		setTimeout(function() {RemoveSelection(1);},800);
		setTimeout(function() {RemoveSelection(1);},900);
		setTimeout(function() {RemoveSelection(1);},1000);
		setTimeout(function() {RemoveSelection(1);},1500);
		setTimeout(function() {RemoveSelection(1);},2000);
	  }
	  else if(tabName=="GrammarTab")
	  {
		PopulateGrammarTab();
	  }
	  
	  switch(tabName)
	  {
			case "UnknownWordsTab": lastUsedStatsTab = "UnknownWordsTab"; break;
			case "LearningWordsTab": lastUsedStatsTab = "LearningWordsTab"; break;
			case "KnownWordsTab": lastUsedStatsTab = "KnownWordsTab"; break;
			case "AllWordsTab": lastUsedStatsTab = "AllWordsTab"; break;
			case "VocabularyTab": lastUsedStatsTab = "VocabularyTab"; break;
			case "CompareTab": lastUsedStatsTab = "CompareTab"; break;
			case "GraphTab": lastUsedStatsTab = "GraphTab"; break;
			case "AchievementsTab": lastUsedStatsTab = "AchievementsTab"; break;
			case "SentencesTab": lastUsedStatsTab = "SentencesTab"; break;
		}
	  
	  
	}
	
	
	function AsyncCalculateStatistics()
	{
						if(statisticsTimeout)
						{	
							clearTimeout(statisticsTimeout);
						}
						statisticsTimeout = setTimeout(function() {

							CalculateStatistics();
						}, global_total_words/1);
	}
	
	
	function CalculateStatistics()
	{
			//var words = document.getElementById ("content").textContent;
			var words = document.getElementById ("content").innerText;
			//console.log(words);
			words=words.replace(replaceCharacters," ");
			
			
			
			var wordArray = words.trim().split(/[, ]+/);

			//for(var i=0;i<wordArray.length;i++)
			//{
			//	console.log(wordArray[i]); //todo words put together!!!
			//}
			
			unknownArray = [];
			learningArray = [];
			knownArray = [];
			allArray = [];
			
			
			SortWords2(wordArray);
	}
	
	function SortWords2(wordArray)
	{
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.getAll();
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
			
	        request.onsuccess = function(event) {          
	          if(request.result) {
				data = request.result;
				var filteredWords=[];
				var filteredRemainder=[];
				
				for(var i=0;i<data.length;i++)
				{
					var remainder = data[i].appearances%3;
					if(remainder!=startingMark)
					{
						filteredWords.push(data[i].word);
						filteredRemainder.push(remainder);
					}
				}
				for(var i=0;i<wordArray.length;i++)
				{
					var index = filteredWords.indexOf(wordArray[i]);
						
					
					var remainder = filteredRemainder[index];
					
					var w = wordArray[i];
							
					if(index > -1)
					{
							
						switch(remainder)
						{
								case 0:
							var found = unknownArray.findIndex(w => w.word === wordArray[i]);
							if(found == -1)
							{
							var n = [];
							n.word = w;
							n.occurances = 1;
							n.topik="";
							unknownArray.push(n);
							}
							else
							{
							unknownArray[found].occurances++;
							}
								break;
								
								case 1: 
								var found = learningArray.findIndex(w => w.word === wordArray[i]);
							if(found == -1)
							{
							var n = [];
							n.word = w;
							n.occurances = 1;
							n.topik="";
							learningArray.push(n);
							}
							else
							{
							learningArray[found].occurances++;
							}
								
								break;
								case 2:
								var found = knownArray.findIndex(w => w.word === wordArray[i]);
							if(found == -1)
							{
							var n = [];
							n.word = w;
							n.occurances = 1;
							n.topik="";
							knownArray.push(n);
							}
							else
							{
							knownArray[found].occurances++;
							}
								break;
						}
					}
					else
					{
							switch(startingMark)
							{
								case 0:
									var found = unknownArray.findIndex(w => w.word === wordArray[i]);
									if(found == -1)
									{
									var n = [];
									n.word = w;
									n.occurances = 1;
									n.topik="";
									unknownArray.push(n);
									}
									else
									{
									unknownArray[found].occurances++;
									}
								break;
																case 1:
									var found = learningArray.findIndex(w => w.word === wordArray[i]);
									if(found == -1)
									{
									var n = [];
									n.word = w;
									n.occurances = 1;
									n.topik="";
									learningArray.push(n);
									}
									else
									{
									learningArray[found].occurances++;
									}
								break;
																case 2:
									var found = knownArray.findIndex(w => w.word === wordArray[i]);
									if(found == -1)
									{
									var n = [];
									n.word = w;
									n.occurances = 1;
									n.topik="";
									knownArray.push(n);
									}
									else
									{
									knownArray[found].occurances++;
									}
								break;
							}
					}

					
				}
				//if(displaySortTimeout)
				//		{	
				//			clearTimeout(displaySortTimeout);
				//		}
				//		displaySortTimeout = setTimeout(function() {

							DisplaySort();
				//		}, global_total_words/3);
				
			  }
	        };
	}
	
	function CalculateVocabulary()
	{
			var t = $('#vocabularyDataTable').DataTable();
			var tt = $('#vocabularyDataTableSummary').DataTable();
	
			t.clear();
			tt.clear();
			
			var arrLearning = [];
			var arrKnown = [];
			var arrUnknown = [];
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.getAll();
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
	        request.onsuccess = function(event) {  
	          if(request.result) {
			  		var req = request.result;
					for(var i=0;i<req.length;i++)
					{
						var w = req[i].word;
						var a = req[i].appearances;
						
						if(!w.includes("$"))
						{
							var remainder = a%3;
							
							if(remainder==0)
								{
								arrUnknown.push(w);
								
								if(vocabularyFilter=='Unknown'||vocabularyFilter=='All')
								{
									t.row.add( [
									w,"Unknown"] );
								}
							}
							else if(remainder==1)
								{
								arrLearning.push(w);
								if(vocabularyFilter=='Learning'||vocabularyFilter=='All')
								{
									t.row.add( [
									w,"Learning"] );
								}
							}
							else if(remainder==2)
							{
								arrKnown.push(w);
								if(vocabularyFilter=='Known'||vocabularyFilter=='All')
								{
									t.row.add( [
									w,"Known"] );
								}
							}
						}
				  }
				  			//tt.clear().draw();
									
				tt.row.add( [
					arrUnknown.length+arrKnown.length+arrLearning.length,arrUnknown.length,arrLearning.length,arrKnown.length
				] );
			
			
				  if(openedTab=="VocabularyTab")
				  {
					  tt.draw();
					  t.draw();
				  }
			  }
			  
			  	switch(toExport)
				{
					case "Vocabulary - All":Export(arrUnknown.concat(arrLearning).concat(arrKnown),"Korean - Vocabulary - All"); break;
					case "Vocabulary - Unknown":Export(arrUnknown,"Korean - Vocabulary - Unknown"); break;
					case "Vocabulary - Learning":Export(arrLearning,"Korean - Vocabulary - Learning"); break;
					case "Vocabulary - Known":Export(arrKnown,"Korean - Vocabulary - Known"); break;
				}
			  
			  };
			  
	}
	
	function ChangeVocabularyFilter()
	{
		var t = $('#vocabularyDataTable').DataTable();
		t.clear().draw();
		var mySelect = document.getElementById('filterVocabularyOption');
		vocabularyFilter=mySelect.value;
		if(vocabularyTimeout)
						{	
							clearTimeout(vocabularyTimeout);
						}
						vocabularyTimeout = setTimeout(function() {
							CalculateVocabulary();
						}, 50);
	}
	
	
	function GetTopikName(index)
	{
		var name;
		switch(index)
		{
			case 0: name = "TOPIK I"; break;
			case 1: name = "TOPIK II"; break;
			case 2: name = "(S)-TOPIK 1"; break;
			case 3: name = "(S)-TOPIK 2"; break;
			case 4: name = "(S)-TOPIK 3"; break;
			default: name = "";
		}
		return name;
	}
	
	function DisplaySort()
	{
		
		const numberOfLists = 2;
	
		var topikList = [];
		
					
		for(var i=0;i<numberOfLists;i++)
		{
			topikList[i] = [];
			var list = [];
			
			switch(i)
			{
				case 0: list = topikI();break;
				case 1: list = topikII();break;
			}
			
			for(var j=0;j<list.length;j++)
			{
				topikList[i].push(list[j].w);
			}
		}
		
		
		var unknownCount=0;
		var knownCount=0;
		var learningCount=0;
		
		for(var i=0;i<unknownArray.length;i++)
		{
			unknownCount+=unknownArray[i].occurances;
			
			
			for(var j=topikList.length-1;j>-1;j--)
			{
				if(topikList[j].includes(unknownArray[i].word))
				{
					unknownArray[i].topik = GetTopikName(j);
				}
			}
		}
			for(var i=0;i<learningArray.length;i++)
		{
			learningCount+=learningArray[i].occurances;
			
			for(var j=topikList.length-1;j>-1;j--)
			{
				if(topikList[j].includes(learningArray[i].word))
				{
					
					learningArray[i].topik = GetTopikName(j);
				}
			}
		}
			for(var i=0;i<knownArray.length;i++)
		{
			knownCount+=knownArray[i].occurances;
			
			for(var j=topikList.length-1;j>-1;j--)
			{
				if(topikList[j].includes(knownArray[i].word))
				{
					
					knownArray[i].topik = GetTopikName(j);
				}
			}  
		}
		
		allArray = knownArray.concat(learningArray).concat(unknownArray);
		
		var totalWords = knownCount + learningCount + unknownCount;
		
		global_total_words = allArray.length;
		
		var percentUnknown = Math.round(((unknownCount/totalWords)*100 + Number.EPSILON) * 100) / 100;
		var percentLearning = Math.round(((learningCount/totalWords)*100 + Number.EPSILON) * 100) / 100;
		var percentKnown = Math.round(((knownCount/totalWords)*100 + Number.EPSILON) * 100) / 100;
		
		var percentUniqueUnknown = Math.round(((unknownArray.length/allArray.length)*100 + Number.EPSILON) * 100) / 100;
		var percentUniqueLearning = Math.round(((learningArray.length/allArray.length)*100 + Number.EPSILON) * 100) / 100;
		var percentUniqueKnown = Math.round(((knownArray.length/allArray.length)*100 + Number.EPSILON) * 100) / 100;
	
		document.getElementById("UnknownWordsTabButton").innerHTML="Unknown Words ("+percentUnknown+"%) <sup>[4]</sup>";
		document.getElementById("LearningWordsTabButton").innerHTML="Learning Words ("+percentLearning+"%) <sup>[5]</sup>";
		document.getElementById("KnownWordsTabButton").innerHTML="Known Words ("+percentKnown+"%) <sup>[6]</sup>";
		
		if((lastUsedStatsTab=="UnknownWordsTab"&&!unknownWordsTabUpToDate)||(openedTab=="UnknownWordsTab"&&!unknownWordsTabUpToDate))
		{
			var tt = $('#unknownWordsDataTableSummary').DataTable();
			tt.clear();
			tt.row.add( [
	            unknownCount + " ("+percentUnknown+"%)",totalWords,unknownArray.length+" ("+percentUniqueUnknown+"%)",allArray.length
	        ] );	
			
			var t = $('#unknownWordsDataTable').DataTable();
			t.clear();
	
			for(var i=0;i<unknownArray.length;i++)
			{
				var wordPercent = Math.round(((unknownArray[i].occurances/totalWords)*100 + Number.EPSILON) * 100) / 100; 
				t.row.add( [
	            unknownArray[i].occurances,unknownArray[i].word,wordPercent+"%",unknownArray[i].topik
	        ] );
			}
			tt.draw();
			t.draw();
			unknownWordsTabUpToDate = true;
		}
		if((lastUsedStatsTab=="LearningWordsTab"&&!learningWordsTabUpToDate)||(openedTab=="LearningWordsTab"&&!learningWordsTabUpToDate))
		{
		
				var tt2 = $('#learningWordsDataTableSummary').DataTable();
			tt2.clear();
			tt2.row.add( [
	            learningCount + " ("+percentLearning+"%)",totalWords,learningArray.length+" ("+percentUniqueLearning+"%)",allArray.length
	        ] );	
			
					var t2 = $('#learningWordsDataTable').DataTable();
			t2.clear();
	
			for(var i=0;i<learningArray.length;i++)
			{
			var wordPercent = Math.round(((learningArray[i].occurances/totalWords)*100 + Number.EPSILON) * 100) / 100; 
				
				t2.row.add( [
	            learningArray[i].occurances,learningArray[i].word,""+wordPercent+"%",learningArray[i].topik
	        ] );
			}
			tt2.draw();
			t2.draw();
			learningWordsTabUpToDate = true;
		}
		if((lastUsedStatsTab=="KnownWordsTab"&&!knownWordsTabUpToDate)||(openedTab=="KnownWordsTab"&&!knownWordsTabUpToDate))
		{
						var tt3 = $('#knownWordsDataTableSummary').DataTable();
			tt3.clear();
			tt3.row.add( [
	            knownCount+ " ("+percentKnown+"%)",totalWords,knownArray.length+" ("+percentUniqueKnown+"%)",allArray.length
	        ] );	
					var t3 = $('#knownWordsDataTable').DataTable();
			t3.clear();
	
			for(var i=0;i<knownArray.length;i++)
			{
			var wordPercent = Math.round(((knownArray[i].occurances/totalWords)*100 + Number.EPSILON) * 100) / 100; 
				
				t3.row.add( [
	            knownArray[i].occurances,knownArray[i].word,""+wordPercent+"%",knownArray[i].topik
	        ] );
			}
			tt3.draw();
			t3.draw();
			knownWordsTabUpToDate = true;
		}
		if((lastUsedStatsTab=="AllWordsTab"&&!allWordsTabUpToDate)||(openedTab=="AllWordsTab"&&!allWordsTabUpToDate))
		{
				var tt4 = $('#allWordsDataTableSummary').DataTable();
			tt4.clear();
			tt4.row.add( [
	            totalWords,allArray.length
	        ] );	
		
					var t4 = $('#allWordsDataTable').DataTable();
			t4.clear();
	
			if(printJSON)
				{
					var json=[];
				}						
			for(var i=0;i<allArray.length;i++)
			{
			var wordPercent = Math.round(((allArray[i].occurances/totalWords)*100 + Number.EPSILON) * 100) / 100; 
				
				t4.row.add( [
	            allArray[i].occurances,allArray[i].word,""+wordPercent+"%",allArray[i].topik
				] );
				
				if(printJSON)
				{ 
					var ww = {o:allArray[i].occurances,w:allArray[i].word};
					json.push(ww); 
				}
			}
			
			if(printJSON)
				{
					console.log(json);
				}	
				
			tt4.draw();
			t4.draw();
			allWordsTabUpToDate = true;
		}
		if(openedTab=="GraphTab")
		{
			SwapChart();
		}
		
		if(openedTab=="CompareTab")
		{
			CompareVocabulary();
		}
		if(openedTab=="VocabularyTab")
		{
			if(vocabularyTimeout)
						{	
							clearTimeout(vocabularyTimeout);
						}
						vocabularyTimeout = setTimeout(function() {
							CalculateVocabulary();
						}, 200);
		}
		if(openedTab=="AchievementsTab")
		{
		
			if(achievementsTimeout)
			{	
				clearTimeout(achievementsTimeout);
			}
						achievementsTimeout = setTimeout(function() {
							CountAndDrawAchievements();
						}, 500);
			
		}
		if(openedTab=="SentencesTab")
		{
		
			if(sentencesTimeout)
			{	
				clearTimeout(sentencesTimeout);
			}
						sentencesTimeout = setTimeout(function() {
							CreateSentences();
						}, 500);
			
		}
		else
		{
			if(achievementsTimeout)
			{	
				clearTimeout(achievementsTimeout);
			}
						achievementsTimeout = setTimeout(function() {
							CountAndDrawAchievements();
						}, 10000);
		}
		
		if(unknownFireDBDocumentLoaded!=false&&learningFireDBDocumentLoaded!=false&&knownFireDBDocumentLoaded!=false)
		{
			if(saveFireDBTimeout)
			{	
					clearTimeout(saveFireDBTimeout);
			}
			saveFireDBTimeout = setTimeout(function() {
				SaveFireDB();
			}, 5000);
		}
		
		switch(toExport)
		{
			case "Current Text - All":
				var wordArr = [];
				for(var i=0;i<allArray.length;i++)
				{
					wordArr[i]=allArray[i].word;
				}
				Export(wordArr,"Korean - Current Text - All");
			break;
			case "Current Text - Unknown":
				var wordArr = [];
				for(var i=0;i<unknownArray.length;i++)
				{
					wordArr[i]=unknownArray[i].word;
				}
				Export(wordArr,"Korean - Current Text - Unknown");
			break;
			case "Current Text - Learning":
				var wordArr = [];
				for(var i=0;i<learningArray.length;i++)
				{
					wordArr[i]=learningArray[i].word;
				}
				Export(wordArr,"Korean - Current Text - Learning");
			break;
			case "Current Text - Known":
				var wordArr = [];
				for(var i=0;i<knownArray.length;i++)
				{
					wordArr[i]=knownArray[i].word;
				}
				Export(wordArr,"Korean - Current Text - Known");
			break;
		}
	}
	
	function Export(list,name)
	{
		toExport="";
		var str="";
		for(var i=0;i<list.length;i++)
		{
			if(i==list.length-1)
			{
				str+=list[i];
			}
			else
			{
				str+=list[i]+"\n";
			}
		}
		
		var blob = new Blob([str],
                { type: "text/plain;charset=utf-8" });
		saveAs(blob, name+".txt");
	}
	
	function OnInput()
	{
		var pasteArea = document.getElementById ("pasteArea");
	
		clearTimeout(colourTimeout);
			clearTimeout(scrollTimeout);
			clearTimeout(vocabularyTimeout);
			clearTimeout(displaySortTimeout);
			clearTimeout(statisticsTimeout);
			clearTimeout(highlightTimeout);	
			clearTimeout(unmarkJumpTimeout);
			clearTimeout(calculateStatisticsTimeout);
	
		if(enableHighlighting)
		{
			var divs = document.getElementsByClassName("individualPage");
			for(var i=0;i<divs.length;i++)
			{
				divs[i].marked=false;
			}
			
			unmark();
			var pasteArea = document.getElementById ("pasteArea");
			pasteArea.style.fontSize = fontSize+"em";
			if(initialisationComplete)
			{	
				SaveHTML(pasteArea.innerHTML);
			}
			paginate();
			onScroll();
			unknownWordsTabUpToDate = false;
			learningWordsTabUpToDate = false;
			knownWordsTabUpToDate = false;
			allWordsTabUpToDate = false;
			AsyncCalculateStatistics();
		}
		else
		{
			var pasteArea = document.getElementById ("pasteArea");
			pasteArea.style.fontSize = fontSize+"em";
			if(initialisationComplete)
			{	
				SaveHTML(pasteArea.innerHTML);
			}
		}
		
		var innerhtml = document.getElementById("pasteArea").innerHTML;
		if(innerhtml.length<100)
		{
			innerhtml=innerhtml.replace(replaceCharacters,"");
			if(innerhtml=="")
			{
				document.getElementById ("pasteArea").innerHTML="";
			}
		}
	}
	
	function LoadHTML()
	{
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("html$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {
				if(request.result) {
						var a = request.result.appearances;
											
						if(a) 
						{
							
							document.getElementById ("pasteArea").innerHTML=a;

								var $div = $('.romanisedText');
								$div.empty();

							OnInput();
						}
					}
				};
	}
	
	function SaveHTML(html)
	{
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("html$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "html$",appearances: html});
					}
					else
					{
						addwordtodb("html$",html);
					}
				}
	}

		function GetPage(index)
		{
			var divs = document.getElementsByClassName("individualPage");
			
			return(divs[index]);
	
		}
		
		function scrollOperation()
		{
			var pageTop = $(window).scrollTop();
				var pageBot = pageTop + $(window).height();
				
			if(initialisationComplete)
			{			
				SavePageLocation(pageTop);
			}
				
				var divs = document.getElementsByClassName("individualPage");
					var toMark = [];
					for(var i=0;i<divs.length;i++)
					{
						var divTop = divs[i].offsetTop;
						var divBot = divTop+divs[i].offsetHeight;
	
						if(divBot>pageTop-450&&divTop<pageBot+450)
						{
							if(divs[i].marked==false||divs[i].marked==null)
							{	
								divs[i].marked=false;
								toMark.push(i);
							}
						}
						else
						{
							divs[i].marked=false;
						}
					}
					
					
					
						if(enableHighlighting&&toMark.length>0)
						{
							if(colourTimeout)
							{
								clearTimeout(colourTimeout);
							}		
							colourTimeout = setTimeout(function() {markAll(toMark)},200);
							
							if(openedTab=="VocabularyTab")
							{
								if(vocabularyTimeout)
								{
									clearTimeout(vocabularyTimeout);
								}	
								vocabularyTimeout = setTimeout(function() {
									CalculateVocabulary();
								}, 700);
							}
						}
		}
	
		function onScroll()
		{
				if(scrollTimeout)
				{
					clearTimeout(scrollTimeout);
				}
									
				scrollTimeout = setTimeout(function() {scrollOperation()},60);
		}
		
		
	function RomaniseText(t)
	{
		return(Aromanize.hangulToLatin(t, 'rr-translit'));
	}
	
	function RomaniseTextWithSeperators(t)
	{
		var s = "";
		for(var i=0;i<t.length;i++)
		{
			if(t[i]==" ")
			{
				s+=" ";
			}
			else if(t[i-1])
			{
				if(t[i-1]==" ")
				{
					s+=Aromanize.hangulToLatin(t[i], 'rr-translit');
				}
				else
				{
					s+=Aromanize.hangulToLatin("-"+t[i], 'rr-translit');
				}
			}
			else
			{
				s+=Aromanize.hangulToLatin("-"+t[i], 'rr-translit');
			}
		}
		return(s);
	}
	
	String.prototype.isEmpty = function() 
				{
					return (this.length === 0 || !this.trim());
				};
	
	function paginate() {
		var b = document.getElementsByClassName('individualPage');
		var pasteArea = document.getElementById("pasteArea");
		
		var $div = $('.romanisedText');
		$div.empty();
	
		
		while(b.length) {
			var parent = b[ 0 ].parentNode;
			while( b[ 0 ].firstChild ) {
				parent.insertBefore(  b[ 0 ].firstChild, b[ 0 ] );
			}
			 parent.removeChild( b[ 0 ] );
		}

		var oldHTML = pasteArea.innerText;
		var replace = /[\n]/g;
		var split = oldHTML.replace(replace,'<br>');
		split = split.split('<br>');
		var newHTML = "";
		for(var i=0;i<split.length;i++)
		{
			if(split[i].length>0)
			{
				var words = split[i];
				
				if(!words.isEmpty())
				{
					
					newHTML = newHTML + '<div class="individualPage">'+words+'<br></div>';
					
					if(romanisationMode==1)
					{
						newHTML = newHTML + '<div class="romanisedText" style="color:blue">' + RomaniseText(words) +'</div>';
					}
					newHTML+='<br>';
				}
			}
		}

		pasteArea.innerHTML = newHTML ;
	}
	
	function ChangeFont()
	{
		var mySelect = document.getElementById('fontSizeOption');
		fontSize = mySelect.value;
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("fontSize$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "fontSize$",appearances: mySelect.value});
					}
					else
					{
						addwordtodb("fontSize$",mySelect.value);
					}
				}
				var pasteArea = document.getElementById ("pasteArea");
			pasteArea.style.fontSize = fontSize+"em";
	}
	
	function ChangeRomanisation()
	{
		var mySelect = document.getElementById('romanisationOption');
		switch(mySelect.value)
		{
			case "Off": romanisationMode = 0; break;
			case "On": romanisationMode = 1; break;
			default: romanisationMode = 0;
		}
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("romanisationOption$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "romanisationOption$",appearances: mySelect.value});
					}
					else
					{
						addwordtodb("romanisationOption$",mySelect.value);
					}
				}
				
				if(romanisationMode==0)
							{
								var $div = $('.romanisedText');
								$div.empty();
							}
				
				OnInput();
	}
	
	function InitialiseRomanisation()
	{
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("romanisationOption$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				var dropDown = document.getElementById("romanisationOption");
					
				request.onsuccess = function(event) {
				if(request.result) {
						var a = request.result.appearances;
						switch(a)
						{
						case "Off": romanisationMode = 0; dropDown.value = "Off"; break;
						case "On": romanisationMode = 1; dropDown.value = "On"; break;
						default: romanisationMode = 0; dropDown.value = "Off";;					
						}					
					}
					else
					{
						romanisationMode = 0;
						dropDown.value = "Off";
					}
				}
	}
	
	function InitialiseFontSize()
	{
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("fontSize$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
					
					
				request.onsuccess = function(event) {
				if(request.result) {
						var a = request.result.appearances;				
						if(a>0) 
						{
							fontSize = a;
						}
						else
						{
							if(mobileMode)
							{
								fontSize = 1;
							}
							else
							{
								fontSize = fontSizeDefault;
							}
						}
					}
					else
					{
						if(mobileMode)
							{
								fontSize = 1;
							}
							else
							{
								fontSize = fontSizeDefault;
							}
					}
					var dropDown = document.getElementById("fontSizeOption");
					dropDown.value = fontSize;
				};
	}
	
	
	function InitialiseHighlightingKnown()
	{
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("highlightingknown$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {
				if(request.result) {
				var a = request.result.appearances;
					if(a==0)
					{
						document.getElementById("enableHighlightingKnown").checked = false;
						SetHighlightingKnown(false,true);
						
						
					}
					else
					{
						document.getElementById("enableHighlightingKnown").checked = true;
					}
			}
					else
					{
						document.getElementById("enableHighlightingKnown").checked = true;
					}
			};		
	}
	
	function ToggleEnableHighlightingKnown()
	{
		//console.log(document.getElementById("enableHighlightingKnown").checked);
		if(document.getElementById("enableHighlightingKnown").checked)
			{
				SetHighlightingKnown(true, true);
				
						
			}
			else
			{
				SetHighlightingKnown(false, true);
			}
	}
	
	function SetHighlightingKnown(activated,reInitialise)
	{
		if(activated)
		{
							var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("highlightingknown$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "highlightingknown$",appearances: 1});
					}
					else
					{
						addwordtodb("highlightingknown$",1);
					}
					
				}
				if(reInitialise)
				{
					InitialiseColourInputField();
				}
		}
		else
		{
							var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("highlightingknown$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "highlightingknown$",appearances: 0});
					}
					else
					{
						addwordtodb("highlightingknown$",0);
					}
					var documentColour = getComputedStyle(document.documentElement).getPropertyValue('--page-bg');
					document.documentElement.style.setProperty('--tertiary-bg', documentColour);
				}
		}
	}
	
	
	function InitialiseColourInputField()
	{
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
			
			var request = objectStore.get("primaryField$");
			request.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
				request.onsuccess = function(event) 
				{
				if(request.result) {
				var a = request.result.appearances;
						if(a)
						{		
							colourPrimary=a;
						}
						else
						{
							colourPrimary=colourPrimaryDefault;
						}
					}
					else
					{
						colourPrimary=colourPrimaryDefault;
					}
						var primaryField = document.getElementById("fieldHC1");
						primaryField.value = colourPrimary;
						primaryField.style.backgroundColor=colourPrimary;
						document.documentElement.style.setProperty('--primary-bg', colourPrimary);
				};
			var objectStore2 = db.transaction(["wordsdb"]).objectStore("wordsdb");	
			var request2 = objectStore2.get("secondaryField$");
			request2.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
				request2.onsuccess = function(event) 
				{
				if(request2.result) {
						var a = request2.result.appearances;
						if(a)
						{	
							colourSecondary=a;
						}
						else
						{
							colourSecondary=colourSecondaryDefault;
						}
					}
					else
					{
						colourSecondary=colourSecondaryDefault;
					}
						var secondaryField = document.getElementById("fieldHC2");
		secondaryField.value = colourSecondary;
		secondaryField.style.backgroundColor=colourSecondary;
		document.documentElement.style.setProperty('--secondary-bg', colourSecondary);
				};
			var objectStore3 = db.transaction(["wordsdb"]).objectStore("wordsdb");	
			var request3 = objectStore3.get("tertiaryField$");
			request3.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
				request3.onsuccess = function(event) 
				{
				if(request3.result) {
						var a = request3.result.appearances;
						if(a)
						{
									
							colourTertiary=a;
						}
						else
						{
							colourTertiary=colourTertiaryDefault;
						}
					}
					else
					{
						colourTertiary=colourTertiaryDefault;
					}
						var tertiaryField = document.getElementById("fieldHC3");
		tertiaryField.value = colourTertiary;
		tertiaryField.style.backgroundColor=colourTertiary;
		document.documentElement.style.setProperty('--tertiary-bg', colourTertiary);
				};
			var objectStore4 = db.transaction(["wordsdb"]).objectStore("wordsdb");	
			var request4 = objectStore4.get("jumpField$");
			request4.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
				request4.onsuccess = function(event) 
				{
				if(request4.result) {
				var a = request4.result.appearances;
				
						if(a)
						{
									
							colourJump=a;
						}
						else
						{
							colourJump=colourJumpDefault;
						}
					}
					else
					{
						colourJump=colourJumpDefault;
					}
						var jumpField = document.getElementById("fieldHC4");
		jumpField.value = colourJump;
		jumpField.style.backgroundColor=colourJump;
		document.documentElement.style.setProperty('--jump-bg', colourJump);
				};
				
				var objectStore5 = db.transaction(["wordsdb"]).objectStore("wordsdb");	
			var request5 = objectStore5.get("bgColourField$");
			request5.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
				request5.onsuccess = function(event) 
				{
				if(request5.result) {
				var a = request5.result.appearances;
				
						if(a)
						{
									
							colourBackground=a;
						}
						else
						{
							colourBackground=colourBackgroundDefault;
						}
					}
					else
					{
						colourBackground=colourBackgroundDefault;
					}
						var bgField = document.getElementById("fieldHC5");
		bgField.value = colourBackground;
		bgField.style.backgroundColor=colourBackground;
		document.documentElement.style.setProperty('--page-bg', colourBackground);
				};
				
				
							var objectStore6 = db.transaction(["wordsdb"]).objectStore("wordsdb");	
			var request6 = objectStore6.get("fontColourField$");
			request6.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
				request6.onsuccess = function(event) 
				{
				if(request6.result) {
				var a = request6.result.appearances;
				
						if(a)
						{
									
							colourFont=a;
						}
						else
						{
							colourFont=colourFontDefault;
						}
					}
					else
					{
						colourFont=colourFontDefault;
					}
						var fontField = document.getElementById("fieldHC6");
		fontField.value = colourFont;
		fontField.style.backgroundColor=colourFont;
		document.documentElement.style.setProperty('--font-bg', colourFont);
				};
				
				var objectStore7 = db.transaction(["wordsdb"]).objectStore("wordsdb");	
			var request7 = objectStore7.get("borderColourField$");
			request7.onerror = function(event) {
				alert("Unable to retrieve data from database!");
			};
				request7.onsuccess = function(event) 
				{
				if(request7.result) {
				var a = request7.result.appearances;
				
						if(a)
						{
									
							colourBorder=a;
						}
						else
						{
							colourBorder=colourBorderDefault;
						}
					}
					else
					{
						colourBorder=colourBorderDefault;
					}
						var borderField = document.getElementById("fieldHC7");
		borderField.value = colourBorder;
		borderField.style.backgroundColor=colourBorder;
		document.documentElement.style.setProperty('--document-bg', colourBorder);
				};	
	}
	
	function ValidateColour(c)
	{
		return(/^#([0-9A-F]{3}){1,2}$/i.test(c));
	}
	
	function HC1Submit()
	{
		var primaryField = document.getElementById("fieldHC1");
		if(ValidateColour(primaryField.value))
		{
			colourPrimary=primaryField.value;
		}
		else
		{
			colourPrimary=colourPrimaryDefault;
		}
		
		primaryField.value = colourPrimary;
		primaryField.style.backgroundColor=colourPrimary;
		document.documentElement.style.setProperty('--primary-bg', colourPrimary);
		
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("primaryField$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "primaryField$",appearances: colourPrimary});
					}
					else
					{
						addwordtodb("primaryField$",colourPrimary);
					}
				}
	}
	
	function HC2Submit()
	{
			var secondaryField = document.getElementById("fieldHC2");
		if(ValidateColour(secondaryField.value))
		{
			colourSecondary=secondaryField.value;
		}
		else
		{
			colourSecondary=colourSecondaryDefault;
		}
		
		secondaryField.value = colourSecondary;
		secondaryField.style.backgroundColor=colourSecondary;
		document.documentElement.style.setProperty('--secondary-bg', colourSecondary);
		
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("secondaryField$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "secondaryField$",appearances: colourSecondary});
					}
					else
					{
						addwordtodb("secondaryField$",colourSecondary);
					}
				}
	}
	
	function HC3Submit()
	{
			var tertiaryField = document.getElementById("fieldHC3");
		if(ValidateColour(tertiaryField.value))
		{
			colourTertiary=tertiaryField.value;
		}
		else
		{
			colourTertiary=colourTertiaryDefault;
		}
		tertiaryField.value = colourTertiary;
		tertiaryField.style.backgroundColor=colourTertiary;
		document.documentElement.style.setProperty('--tertiary-bg', colourTertiary);
		
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("tertiaryField$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "tertiaryField$",appearances: colourTertiary});
					}
					else
					{
						addwordtodb("tertiaryField$",colourTertiary);
					}
				}
				document.getElementById("enableHighlightingKnown").checked = true;
				SetHighlightingKnown(true,false);
	}
	
	function HC4Submit()
	{
			var jumpField = document.getElementById("fieldHC4");
		if(ValidateColour(jumpField.value))
		{
			colourJump=jumpField.value;
		}
		else
		{
			colourJump=colourJumpDefault;
		}
		
		jumpField.value = colourJump;
		jumpField.style.backgroundColor=colourJump;
		document.documentElement.style.setProperty('--jump-bg', colourJump);
		
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("jumpField$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "jumpField$",appearances: colourJump});
					}
					else
					{
						addwordtodb("jumpField$",colourJump);
					}
				}
	}
	
		function HC5Submit()
	{
			var bgField = document.getElementById("fieldHC5");
		if(ValidateColour(bgField.value))
		{
			colourBackground=bgField.value;
		}
		else
		{
			colourBackground=colourBackgroundDefault;
		}
		
		bgField.value = colourBackground;
		bgField.style.backgroundColor=colourBackground;
		document.documentElement.style.setProperty('--page-bg', colourBackground);
		
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("bgColourField$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "bgColourField$",appearances: colourBackground});
					}
					else
					{
						addwordtodb("bgColourField$",colourBackground);
					}
				}
	}
	
		function HC6Submit()
	{
			var fontField = document.getElementById("fieldHC6");
		if(ValidateColour(fontField.value))
		{
			colourFont=fontField.value;
		}
		else
		{
			colourFont=colourFontDefault;
		}
		
		fontField.value = colourFont;
		fontField.style.backgroundColor=colourFont;
		document.documentElement.style.setProperty('--font-bg', colourFont);
		
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("fontColourField$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "fontColourField$",appearances: colourFont});
					}
					else
					{
						addwordtodb("fontColourField$",colourFont);
					}
				}
	}
	
		function HC7Submit()
	{
			var borderField = document.getElementById("fieldHC7");
		if(ValidateColour(borderField.value))
		{
			colourBorder=borderField.value;
		}
		else
		{
			colourBorder=colourBorderDefault;
		}
		
		borderField.value = colourBorder;
		borderField.style.backgroundColor=colourBorder;
		document.documentElement.style.setProperty('--document-bg', colourBorder);
		
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("borderColourField$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "borderColourField$",appearances: colourBorder});
					}
					else
					{
						addwordtodb("borderColourField$",colourBorder);
					}
				}
	}
	
	function ChangeVoice()
	{
		var mySelect = document.getElementById('voiceOption');
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("voice$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {          
					if(request.result) {
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "voice$",appearances: mySelect.value});
					}
					else
					{
						addwordtodb("voice$",mySelect.value);
					}
				}
	}
	
	function QuickSortWords(word,appearances,last,listName,index,unknownArrayCompare,learningArrayCompare,knownArrayCompare,allArrayCompare)
	{
	
			
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.get(word);
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
	        request.onsuccess = function(event) {          
	          if(request.result) {
			  
					var w = request.result.word;
					var a = request.result.appearances;
					var remainder = a%3;
					if(remainder==0)
					{
						const found = unknownArrayCompare.findIndex(w => w.word === word);
						if(found == -1)
						{
						var n = [];
						n.word = w;
						n.occurances = appearances;
						unknownArrayCompare.push(n);
						}
						else
						{
						unknownArrayCompare[found].occurances+=appearances;
						}
					}
					else if(remainder==1)
					{
						const found = learningArrayCompare.findIndex(w => w.word === word);
						if(found == -1)
						{
						var n = [];
						n.word = w;
						n.occurances = appearances;
						learningArrayCompare.push(n);
						}
						else
						{
						learningArrayCompare[found].occurances+=appearances;
						}
					}
					else if(remainder==2)
					{
						const found = knownArrayCompare.findIndex(w => w.word === word);
						if(found == -1)
						{
						var n = [];
						n.word = w;
						n.occurances = appearances;
						knownArrayCompare.push(n);
						}
						else
						{
						knownArrayCompare[found].occurances+=appearances;
						}
					}
	
	          } 
			  else 
			  {
						var n = [];
						n.word = word;
						n.occurances = appearances;
						unknownArrayCompare.push(n);
	          }
			  
			  if(last)
			  {
					allArrayCompare = knownArrayCompare.concat(learningArrayCompare).concat(unknownArrayCompare);
					//if(displayComparisonTimeout)
					//{	
					//	clearTimeout(displayComparisonTimeout);
					//}
					displayComparisonTimeout = setTimeout(function() {
					  DisplayComparison(listName,index,unknownArrayCompare,learningArrayCompare,knownArrayCompare,allArrayCompare);
					}, 50);
			  }
	        };
			
	}
	
	  
	function CompareVocabulary()
	{
			if(statisticsTimeout)
			{	
				clearTimeout(statisticsTimeout);
			}
	
			
				

					if(compareLoop==false)
					{
						var t = $('#compareDataTable').DataTable();
					t.clear().draw();
					  CompareLoop(0);
					}
	}
	
	function CompareLoop(index)
	{ 
		compareLoop=true;
		var list;
		var name = GetTopikName(index);

		switch(index)
		{
			case 0: list = topikI(); break;
			case 1: list = topikII(); break;
			case 2: list = stopik1(); break;
			case 3: list = stopik2(); break;
			case 4: list = stopik3(); break;
			default: compareLoop=false; index=-1;
		}
		
		if(index!=-1)
		{
				var unknownArrayCompare = [];
				var learningArrayCompare = [];
				var knownArrayCompare = [];
				var allArrayCompare = [];
			
			for(var i=0;i<list.length;i++)
			{
				//var splitList = list[i].split(' ');
				
				if(list.length-1==i)
					{
						QuickSortWords(list[i].w,list[i].o,true,name,index,unknownArrayCompare,learningArrayCompare,knownArrayCompare,allArrayCompare);
					}
					else{
						QuickSortWords(list[i].w,list[i].o,false,name,index,unknownArrayCompare,learningArrayCompare,knownArrayCompare,allArrayCompare);
					}
				
			}
		}
	}

	function DisplayComparison(listName, index,unknownArrayCompare,learningArrayCompare,knownArrayCompare,allArrayCompare)
	{
			var unknownCount=0;
		var knownCount=0;
		var learningCount=0;
		
		for(var i=0;i<unknownArrayCompare.length;i++)
		{
			unknownCount+=unknownArrayCompare[i].occurances;
		}
			for(var i=0;i<learningArrayCompare.length;i++)
		{
			learningCount+=learningArrayCompare[i].occurances;
		}
			for(var i=0;i<knownArrayCompare.length;i++)
		{
			knownCount+=knownArrayCompare[i].occurances;
		}
		
		var totalWords = knownCount + learningCount + unknownCount;
		
		var percentUnknown = Math.round(((unknownCount/totalWords)*100 + Number.EPSILON) * 100) / 100;
		var percentLearning = Math.round(((learningCount/totalWords)*100 + Number.EPSILON) * 100) / 100;
		var percentKnown = Math.round(((knownCount/totalWords)*100 + Number.EPSILON) * 100) / 100;
		
		var percentUniqueUnknown = Math.round(((unknownArrayCompare.length/allArrayCompare.length)*100 + Number.EPSILON) * 100) / 100;
				var t = $('#compareDataTable').DataTable();
				t.row.add( [
	            listName,percentUnknown,percentLearning,percentKnown,
				unknownArrayCompare.length +" ("+percentUniqueUnknown+"%)",allArrayCompare.length
	        ] );
			
			t.draw();
			CompareLoop(index+1);
	}
	
	function ChangeFontType()
	{
		var mySelect = document.getElementById('fontTypeOption');
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("fonttype$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {          
					if(request.result)
					{
						request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "fonttype$",appearances: mySelect.value});
					}
					else
					{
						addwordtodb("fonttype$",mySelect.value);
					}
				}
			document.documentElement.style.setProperty('--font-type', mySelect.value);
		
	}
	
	function ChangeDictLanguage()
	{
		var mySelect = document.getElementById('dictLanguageOption');
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("dictlanguage$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {          
					if(request.result)
					{
						request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "dictlanguage$",appearances: mySelect.value});
					}
					else
					{
						addwordtodb("dictlanguage$",mySelect.value);	
					}
					dictionaryLanguage = mySelect.value;
					var dropDown = document.getElementById("dictLanguageOption");
					dropDown.value = dictionaryLanguage;
					var dropDown2 = document.getElementById("dictLanguageOption2");
					dropDown2.value = dictionaryLanguage;
					
					dictionaryLookup(pendingLookup);
				}
			dictionaryLookingUp="";
	}
	
	function ChangeDictLanguage2()
	{
		var mySelect = document.getElementById('dictLanguageOption2');
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("dictlanguage$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {          
					if(request.result)
					{
						request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "dictlanguage$",appearances: mySelect.value});
					}
					else
					{
						addwordtodb("dictlanguage$",mySelect.value);	
					}
					dictionaryLanguage = mySelect.value;
					var dropDown = document.getElementById("dictLanguageOption");
					dropDown.value = dictionaryLanguage;
					var dropDown2 = document.getElementById("dictLanguageOption2");
					dropDown2.value = dictionaryLanguage;
					dictionaryLookingUp="";
					dictionaryLookup(pendingLookup);
				}
	}
	
	function OnResize()
	{
		if (/Mobi/.test(navigator.userAgent)||window.innerWidth<900)
		{
			mobileMode =true;
			document.documentElement.style.setProperty('--pasteArea-percent', '50%');
			document.documentElement.style.setProperty('--sidebar2-percent', '50%');
			//document.documentElement.style.setProperty('--tabcontent-padding', '.1vh');
			
		}
		else
		{
			mobileMode =false;
			document.documentElement.style.setProperty('--sidebar2-percent', '30%');
			SetCurrentSidebar();
			//document.documentElement.style.setProperty('--tabcontent-padding', '.1vh');
		}
		
		var c = document.getElementsByClassName("wrapper3");
		//c[0].style.height = $(window).height()-($(window).height()*.075)+"px";
		c[0].style.height = $(window).outerHeight()-($(window).outerHeight()*.075)+"px";
	}
	 
	function ToggleOpenMenu()
	{
		if(!initialisationComplete)
		{
			return false;
		}
	
		if(menuVisible)
		{
			ShowMenu(false)
			
		}
		else
		{
			ShowMenu(true)
		}
	
	}
	
		function ShowMenu(show)
	{
		if(show)
		{
			var tablinks = document.getElementsByClassName('toptabs');
			
			//if(openedTab!="OptionsTab"&&openedTab!="AboutTab")
			//{
				//for (i = 0; i < tablinks.length; i++)
				//{
				//	tablinks[i].className = tablinks[i].className.replace(" active", "");
				//	openedTab="";
				//}
			//}
			
			
			//ShowSidebar(false);
			document.getElementById("menu").style.visibility="visible";
			menuVisible = true;
			
			
		}
		else
		{
			//var tablinks = document.getElementsByClassName('topbarbutton');
			//for (i = 0; i < tablinks.length; i++)
			//{
				
			//	tablinks[i].className = tablinks[i].className.replace(" active", "");
				
			//}
		
			document.getElementById("menu").style.visibility="hidden";
			menuVisible = false;
		}
	
	}
	
	function SetCurrentSidebar()
	{
		if(sidebarVisible)
		{
			if(!mobileMode)
			{
				document.getElementById("sidebar2").style.display="block";
				sidebarVisible = true;
			
				document.documentElement.style.setProperty('--pasteArea-percent', '70%');
				//document.documentElement.style.setProperty('--sidebar2-percent', '30%');
			}
			else
			{
				document.getElementById("sidebar2").style.display="block";
				sidebarVisible = true;
			
				document.documentElement.style.setProperty('--pasteArea-percent', '50%');
				//document.documentElement.style.setProperty('--sidebar2-percent', '40%');
			}
			
		}
		else
		{
			if(!mobileMode)
			{
				document.getElementById("sidebar2").style.display="none";
				sidebarVisible = false;
			
				document.documentElement.style.setProperty('--pasteArea-percent', '100%');
				//document.documentElement.style.setProperty('--sidebar2-percent', '30%');
			}
			else
			{
				document.getElementById("sidebar2").style.display="none";
				sidebarVisible = false;
			
				document.documentElement.style.setProperty('--pasteArea-percent', '100%');
				//document.documentElement.style.setProperty('--sidebar2-percent', '40%');
			}
		}
	}
	

	function ShowSidebar(show)
	{
		if(show&&!sidebarVisible)
		{
			if(!mobileMode)
			{
				document.getElementById("sidebar2").style.display="block";
				sidebarVisible = true;
			
				document.documentElement.style.setProperty('--pasteArea-percent', '70%');
				//document.documentElement.style.setProperty('--sidebar2-percent', '30%');
			}
			else
			{
				document.getElementById("sidebar2").style.display="block";
				sidebarVisible = true;
			
				document.documentElement.style.setProperty('--pasteArea-percent', '50%');
				//document.documentElement.style.setProperty('--sidebar2-percent', '40%');
			}
			
		}
		else if(!show&&sidebarVisible)
		{
			if(!mobileMode)
			{
				document.getElementById("sidebar2").style.display="none";
				sidebarVisible = false;
			
				document.documentElement.style.setProperty('--pasteArea-percent', '100%');
				//document.documentElement.style.setProperty('--sidebar2-percent', '30%');
			}
			else
			{
				document.getElementById("sidebar2").style.display="none";
				sidebarVisible = false;
			
				document.documentElement.style.setProperty('--pasteArea-percent', '100%');
				//document.documentElement.style.setProperty('--sidebar2-percent', '40%');
			}
		}
	}
function InitialiseStartingMark()
{
		var dropDown = document.getElementById("startingMarkOption");
		dropDown.value = "Unknown";
		
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("startingmark$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
					
				//console.log("here1");
				request.onsuccess = function(event) {
				if(request.result) {
				//console.log("here2 "+a);
						var a = request.result.appearances;
											
						startingMark = a;
					}
					else
					{
						//console.log("here3");
						addwordtodb("startingmark$",startingMarkDefault);
						startingMark = startingMarkDefault;
					}
					
					var dropDownValue = "Unknown";
					switch(startingMark)
					{
						case 0: dropDownValue = "Unknown"; break;
						case 1: dropDownValue = "Learning"; break;
						case 2: dropDownValue = "Known"; break;
						default: dropDownValue = "Unknown"; 
					}
					
					dropDown.value = dropDownValue;
				};
}

function ButtonDeleteCurrentTextSubmit()
{
	var r = confirm("Delete current text's words from vocabulary?");
	if (r == true) {
	  DeleteCurrentTextVocabulary();
	}
}

function ButtonDeleteAllSubmit()
{

	var r = confirm("Delete all words from vocabulary?");
	if (r == true) {
	  DeleteAllVocabulary();
	}
}


function DeleteAllVocabulary()
{
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.getAll();
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
			var selectedVocab=[];
	        request.onsuccess = function(event) {  
	          if(request.result) {
			  		var req = request.result;
					for(var i=0;i<req.length;i++)
					{
						var w = req[i].word;
						if(!w.includes("$"))
						{
							selectedVocab.push(w);
						}
				  }
			  }
			  
					for(var i=0;i<selectedVocab.length;i++)
					{
						var transaction2 = db.transaction(["wordsdb"], "readwrite");
						transaction2.onerror = function(event) {
						  };
						var objectStore2 = transaction2.objectStore("wordsdb");
						var objectStoreRequest2 = objectStore2.delete(selectedVocab[i]);
					}
					OnInput();					
			  };										
}

function DeleteCurrentTextVocabulary()
{
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        /*var request = objectStore.getAll();
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
			var selectedVocab=[];
	        request.onsuccess = function(event) {  
	          if(request.result) {
			  		var req = request.result;
					for(var i=0;i<req.length;i++)
					{
						var w = req[i].word;
						if(!w.includes("$"))
						{
							selectedVocab.push(w);
						}
				  }
			  }
			  */
					var pasteArea = document.getElementById ("pasteArea");
					var words = pasteArea.innerText;
						words=words.replace(replaceCharacters," ");
	
						var wordArray = words.trim().split(/[, ]+/);
						//for(var j=0;j<wordArray.length;j++)
						//{
						//	setCurrentColour(wordArray[j],toMark[i]);
						//}
			  
			  
					for(var i=0;i<wordArray.length;i++)
					{
						var transaction2 = db.transaction(["wordsdb"], "readwrite");
						transaction2.onerror = function(event) {
						  };
						var objectStore2 = transaction2.objectStore("wordsdb");
						var objectStoreRequest2 = objectStore2.delete(wordArray[i]);
					}
					OnInput();					
			  //};										
}


function ChangeStartingMark()
{
		var mySelect = document.getElementById('startingMarkOption');
		var s = mySelect.value;
		var sIndex = 0;
		//var toDelete = false;
		
		switch(s)
		{
						case "Unknown": sIndex = 0;  break;
						case "Learning": sIndex = 1; break;
						case "Known": sIndex = 2; break;
						default: sIndex = 0; 
		}
		//console.log(sIndex +" "+startingMark);
		
		//console.log(sIndex);
		
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("startingmark$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {          
					if(request.result) {
					//console.log("putting word "+sIndex);
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "startingmark$",appearances: sIndex});
					}
					else
					{
						//console.log("adding to db "+sIndex);
						addwordtodb("startingmark$",sIndex);
					}
				}
				startingMark = sIndex;
				unknownWordsTabUpToDate = false;
				learningWordsTabUpToDate = false;
				knownWordsTabUpToDate = false;	
}

function CountAndDrawAchievements()
{
	var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.getAll();
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
			var count=0;
	        request.onsuccess = function(event) {  
	          if(request.result) {
			  		var reqe = request.result;
					for(var i=0;i<reqe.length;i++)
					{
						var w = reqe[i].word;
						var a = reqe[i].appearances;
						
						if(!w.includes("$"))
						{
							var remainder = a%3;
							if(remainder==2)
							{
								count++;
								
							}
						}
				  }
				  DrawAchievements(count);
			  }
			};
			
}

function DrawAchievements(count)
{
		var awardEvery = 1000;

		var tttt = $('#achievementsDataTable').DataTable();
		if(openedTab=="AchievementsTab")
		{
			//tttt.draw();
			tttt.clear();
		}
		
		var achievementsArray;

		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("achievements$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) 
				{
					if(request.result) {
						achievementsArray = request.result.appearances;
					}
					else
					{
						achievementsArray=[];
					}
					
					var c = count;
					c = c/awardEvery;
					for(var i=achievementsArray.length;i<c;i++)
					{
						var d = new Date();
						achievementsArray.push(d);
					}
					
					
					for(var i=1;i<achievementsArray.length;i++)
					{
						tttt.row.add( [
							i*awardEvery, DateFormat(achievementsArray[i])
						] );
					}
					
				if(request.result) {
				request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "achievements$",appearances: achievementsArray});
					}
					else
					{
						addwordtodb("achievements$",achievementsArray);
					}
					if(openedTab=="AchievementsTab")
					{
						var text = document.getElementById ("achievementsText");
						text.innerText = "Current known word count: "+count + " words";
						tttt.draw();
					}  
					
				};
}

function DateFormat(d)
{
	var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
	var minutes = d.getMinutes();
	if(minutes<10)
	{
		minutes = "0"+minutes;
	}
	var string = d.getHours()+":"+minutes+"   "+months[d.getMonth()] + " "+d.getDate()+" "+d.getFullYear();
	return string;
}

function ButtonDeleteAchievementsSubmit()
{
	var r = confirm("Delete all achievements?");
	if (r == true) {
	  DeleteAllAchievements();
	}
	
}

function DeleteAllAchievements()
{
	clearTimeout(achievementsTimeout);


	var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("achievements$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				var emptyArray = [];
				request.onsuccess = function(event) 
				{
				if(request.result) {
				request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "achievements$",appearances: emptyArray});
					}
					else
					{
						//console.log("adding to db "+sIndex);
						addwordtodb("achievements$",emptyArray);
					}

	var tttt = $('#achievementsDataTable').DataTable();
	tttt.clear().draw();
	};
}

function ButtonExportWordlistSubmit()
{
	var mySelect = document.getElementById('filterExportWordlistOption');
	var selectText = mySelect.value;
	
	switch(selectText)
	{
		case "Vocabulary - All": CalculateVocabulary(); toExport="Vocabulary - All"; break;
		case "Vocabulary - Unknown": CalculateVocabulary(); toExport="Vocabulary - Unknown"; break;
		case "Vocabulary - Learning": CalculateVocabulary(); toExport="Vocabulary - Learning"; break;
		case "Vocabulary - Known": CalculateVocabulary(); toExport="Vocabulary - Known"; break;
		case "Current Text - All":CalculateStatistics(); toExport="Current Text - All"; break;
		case "Current Text - Unknown":CalculateStatistics(); toExport="Current Text - Unknown"; break;
		case "Current Text - Learning":CalculateStatistics(); toExport="Current Text - Learning"; break;
		case "Current Text - Known":CalculateStatistics(); toExport="Current Text - Known"; break;
		default: return;
	}
}

function ChangeFilterExportWordlist()
{
	var mySelect = document.getElementById('filterExportWordlistOption');
	chosenExportWordlist=mySelect.value;
}

function InitialiseExportWordlist()
{
	var mySelect = document.getElementById('filterExportWordlistOption');
	mySelect.value = chosenExportWordlist;
}

function HC1OnInput()
{
	var primaryField = document.getElementById("fieldHC1");
		if(ValidateColour(primaryField.value))
		{
			primaryField.style.backgroundColor=primaryField.value;
		}
}

function HC2OnInput()
{
	var secondaryField = document.getElementById("fieldHC2");
		if(ValidateColour(secondaryField.value))
		{
			secondaryField.style.backgroundColor=secondaryField.value;
		}
}

function HC3OnInput()
{
	var tertiaryField = document.getElementById("fieldHC3");
		if(ValidateColour(tertiaryField.value))
		{
			tertiaryField.style.backgroundColor=tertiaryField.value;
		}
}

function HC4OnInput()
{
	var jumpField = document.getElementById("fieldHC4");
		if(ValidateColour(jumpField.value))
		{
			jumpField.style.backgroundColor=jumpField.value;
		}
}

function ChangeFilterImport()
{

	var importDropDown = document.getElementById("filterImportOption");
	importWordlistFilter=importDropDown.value;
}

function ButtonImportSubmit()
{
	var w = document.getElementById("importTextArea").value;
	
	var replace = /[\n]/g;
	var wordArray = w.replace(replace,' ');
	wordArray = wordArray.trim().split(/[, ]+/);
	
	if(wordArray.length>0)
	{
		var state = 0;
		switch(importWordlistFilter)
		{
			case "Unknown": state = 0;break;
			case "Learning": state = 1;break;
			case "Known": state = 2; break;
		}
		
		QuickImport(wordArray,state);
		
		
		document.getElementById("importTextArea").value="";
	}
}

function ReadFile(f) 
{
  
  if (!f) {
        alert("Failed to load file");
    } else if (!f.type.match('text.*')) {
		    alert(f.name + " is not a valid text file.");
    }
	else
	{
		var reader = new FileReader();
		reader.onload = function(event)
		{
			var words = reader.result;
			words=words.replace(replaceCharacters," ");
			document.getElementById("importTextArea").value=words;
			//console.log('here-1 ' +document.getElementById("importTextArea").value);
		};
		
		reader.readAsText(f);
	}
}

function InitialiseImport()
{
	var importDropDown = document.getElementById("filterImportOption");
	importDropDown.value=importWordlistFilter;
}

function UpdateOrAddDBRow(w,a)
{

			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.get(w);
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
	        request.onsuccess = function(event) {          
	          if(request.result) {
					
					request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: w,appearances: a});
	
	          } else
			  {
					
					addwordtodb(w,a);
					
	          }
	        };
}

function ClearImportSubmit()
{
	document.getElementById("importTextArea").value="";
	fileSelector.value="";
}

function ChangeUILanguage()
{
	var mySelect = document.getElementById('uiLanguageOption');
		var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("uilanguage$");
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
				request.onsuccess = function(event) {          
					if(request.result)
					{
						request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "uilanguage$",appearances: mySelect.value});
					}
					else
					{
						addwordtodb("uilanguage$",mySelect.value);	
					}
					SetUILanguage(mySelect.value);
				}
}

function InitialiseUILanguage()
{
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
		var request = objectStore.get("uilanguage$");
		var uilanguage="";
		request.onerror = function(event) {
			alert("Unable to retrieve data from database!");
		};
					
					
				request.onsuccess = function(event) {
				if(request.result) {
						var a = request.result.appearances;
						uilanguage=a;
										
					}
					else
					{
						uilanguage = uidefault;
					}
					SetUILanguage(uilanguage);
					var dropDown = document.getElementById("uiLanguageOption");
					dropDown.value = uilanguage;
				};
}

function ChangeReaderLanguage()
{
	var lang = document.getElementById("readerLanguageOption").value;
	switch(lang)
	{
		case "English": window.open("https://lance388.github.io/reader/en/index.html"); break;
		case "Chinese": window.open("https://lance388.github.io/reader/zh/index.html"); break;
		case "Korean": break;
		case "Vietnamese": window.open("https://lance388.github.io/reader/vn/index.html"); break;
	}
}

function SetDefaultReaderLanguage()
{
	document.getElementById("readerLanguageOption").value = "Korean";
}

function PopulateGrammarTab()
{	
	var tt = $('#grammarDataTable1').DataTable();
	tt.clear();
	GrammarLookup(pendingLookup);
//	tt.row.add( [
//		"here1","here2","here3"
//	] );	
	
	var t = $('#grammarDataTable2').DataTable();
	t.clear();
	for(var i=0;i<grammarPoints.length;i++)
	{	
		t.row.add( [
			grammarPoints[i].num,grammarPoints[i].point,grammarPoints[i].des
		] );
	}
	tt.draw();
	t.draw();
}


function SetGrammarPoints()
{
	/*NOTE
	(?=\s) : look ahead 1 character, pass if that character is a space
	*/
	
	var numGrammar=396;
	
	for(var i=0;i<numGrammar;i++)
	{
		var n=[];
		n.num = i+1;
		var rx = [];
		
		switch(i)
		{
			
			case 0:
				rx.push(/-kke-seo/);
				n.point = "N께서";
				n.des="Subject marking particle, honorific form of 이/가";
			break;
			
			case 1:
				rx.push(/-kke-seo-neun/);
				n.point = "N께서는";
				n.des="Topic marking particle, honorific form of 은/는";
			break;
			
			case 2:
				rx.push(/-kke/);
				n.point = "N께";
				n.des="Particle denoting a recipient, honorific form of 에게(한테)";
			break;
			
			case 3:
				rx.push(/b-ni-da/);
				rx.push(/b-ni-kka/);
				n.point = "A/V-(스)ㅂ니다";
				n.des="Formal polite style";
			break;
			
			case 4:
				rx.push(/-yo /);
				rx.push(/-yong /);
				n.point = "A/V-아/어요";
				n.des="Informal polite style";
			break;
			
			case 5:
				rx.push(/ass-/);
				rx.push(/eoss-/);
				rx.push(/haess-/);
				rx.push(/yess-/);
				rx.push(/ess-/);
				n.point = "A/V-았/었어(요)";
				n.des="Past tense";
			break;
			case 6:
				rx.push(/l geo/);
				rx.push(/l-geo/);
				rx.push(/l kkeo/);
				rx.push(/l-kkeo/);
				n.point = "V-(으)ㄹ 거예요/V-(으)ㄹ 거야";
				n.des="Future tense";
			break;
			case 7:
				rx.push(/go i/);
				rx.push(/gu i/);
				n.point = "V-고 있다";
				n.des="Progressive tense";
			break;
			case 8:
				rx.push(/ass-eoss/);
				rx.push(/eoss-eoss/);
				rx.push(/aess-eoss/);
				n.point = "A/V-았/었었어(요)";
				n.des="Past perfect tense";
			break;
			case 9:
				rx.push(/ji an/);
				rx.push(/ji mos/);
				n.point = "A/V-지 않아(요) / V-지 못해(요)";
				n.des="Negation with 지";
			break;
			case 10:
				rx.push(/-i /);
				rx.push(/-ga /);
				n.point = "N이/가";
				n.des="Subject marking particle";
			break;
			case 11:
				rx.push(/-eun /);
				rx.push(/-neun /);
				n.point = "N은/는";
				n.des="Topic marking particle";
			break;
			case 12:
				rx.push(/(?<!ja)l /);
				n.point = "N을/를";
				n.des="Object marking particle";
			break;
			case 13:
				rx.push(/ oa-/);
				rx.push(/ oa /);
				rx.push(/-oa-/);
				rx.push(/-oa /);
				rx.push(/goa-/);
				rx.push(/goa /);
				n.point = "N와/과";
				n.des="Particle denoting 'and'";
			break;
			case 14:
				rx.push(/lang/);
				n.point = "N(이)랑";
				n.des="Particle denoting 'and'";
			break;
			case 15:
				rx.push(/hago/);
				rx.push(/hagu/);
				n.point = "N하고";
				n.des="Particle denoting 'and'";
			break;
			case 16:
				rx.push(/eui /);
				n.point = "N의";
				n.des="Particle denoting possession";
			break;
			case 17:
				rx.push(/-e-(?!seo)/);
				rx.push(/-e /);
				rx.push(/ e-(?!seo)/);
				rx.push(/ e /);
				n.point = "N에";
				n.des="Particle denoting direction or time";
			break;
			case 18:
				rx.push(/e-seo /);
				rx.push(/e-seo-/);
			
				n.point = "N에서";
				n.des="Particle denoting location, 'from...'";
			break;
			case 19:
				rx.push(/kka-ji/);
				n.point = "N까지";
				n.des="Particle denoting 'until'";
			break;
			case 20:
				rx.push(/-bu-teo/);
				n.point = "N부터";
				n.des="Particle denoting 'from...'";
			break;
			case 21:
				rx.push(/-e-ge /);
				rx.push(/-e-gen /);
				n.point = "N에게";
				n.des="Particle denoting a recipient";
			break;
			case 22:
				rx.push(/-han-te/);
				n.point = "N한테";
				n.des="to someone, from someone";
			break;
			case 23:
				rx.push(/-do-/);
				rx.push(/-du-/);
				rx.push(/-do /);
				rx.push(/-du /);
				n.point = "N도, N도(요)";
				n.des="'Also', particle denoting the listing of something";
			break;
			case 24:
				rx.push(/-man/);
				n.point = "N만";
				n.des="Particle denoting 'only'";
			break;
			case 25:
				rx.push(/-bakk-e/);
				n.point = "N밖에";
				n.des="Particle denoting 'nothing but'";
			break;
			case 26:
				rx.push(/-lo/);
				n.point = "N(으)로";
				n.des="Particle denoting direction/method/way/means";
			break;
			case 27:
				rx.push(/-na /);
				n.point = "N(이)나";
				n.des="Particle denoting 'or'";
			break;
			case 28:
				rx.push(/-jjeum/);
				n.point = "N쯤";
				n.des="Particle denoting approximation";
			break;
			case 29:
				rx.push(/-cheo-leom/);
				n.point = "N처럼";
				n.des="Particle denoting similarity";
			break;
			case 30:
				rx.push(/-gat-i/);
				n.point = "N같이";
				n.des="Particle denoting similarity";
			break;
			case 31:
				rx.push(/-bo-da/);
				n.point = "N보다";
				n.des="Particle denoting comparision";
			break;
			case 32:
				rx.push(/-ma-da/);
				n.point = "N마다";
				n.des="Particle denoting 'every'";
			break;
			case 33:
				rx.push(/-go /);
				rx.push(/-gu /);
				n.point = "A/V-고";
				n.des="'And'";
			break;
			case 34:
				rx.push(/-geo-na/);
				n.point = "V-거나";
				n.des="'Or'";
			break;
			case 35:
				rx.push(/-ji-man /);
				rx.push(/-ji-man-/);
				n.point = "A/V-지만, -기는 하지만, -기는 -지만";
				n.des="'But'";
			break;
			case 36:
				rx.push(/(?<!deo)n-de /);
				rx.push(/(?<!deo)n-de-/);
				n.point = "A/V-(으)ㄴ/는데";
				n.des="'But', 'so', 'therefore', 'and'";
			break;
			case 37:
				rx.push(/-jeon-e/);
				n.point = "N전에";
				n.des="'Before'";
			break;
			case 38:
				rx.push(/-gi jeon-e/);
				rx.push(/-gi-jeon-e/);
				n.point = "V-기 전에";
				n.des="'Before'";
			break;
			case 39:
				rx.push(/-hu-e/);
				n.point = "N후에";
				n.des="'After'";
			break;
			case 40:
				rx.push(/n hu-e/);
				n.point = "V-(으)ㄴ 후에";
				n.des="'After'";
			break;
			case 41:
				rx.push(/na-seo/);
				n.point = "V-고 나서";
				n.des="'And then'";
			break;
			case 42:
				rx.push(/ae-seo/);
				rx.push(/a-seo/);
				rx.push(/e-seo/);
				n.point = "V-아/어서";
				n.des="'(In order) to'";
			break;
			case 43:
				rx.push(/ttae-/);
				rx.push(/ttae /);
				n.point = "N때, A/V-(으)ㄹ 때";
				n.des="'When'";
			break;
			case 44:
				rx.push(/myeon-seo/);
				n.point = "V-(으)면서";
				n.des="'While'";
			break;
			case 45:
				rx.push(/jung/);
				n.point = "N중 V-는 중";
				n.des="'Currently doing', 'in the middle of'";
			break;
			case 46:
				rx.push(/ja-ma-ja/);
				n.point = "V-자마자";
				n.des="'As soon as', 'right after'";
			break;
			case 47:
				rx.push(/dong-an/);
				n.point = "N동안, V-는 동안";
				n.des="During";
			break;
			case 48:
				rx.push(/n ji/);
				n.point = "V-(으)ㄴ 지";
				n.des="'Since'";
			break;
			case 49:
				rx.push(/su /);
				n.point = "V-(으)ㄹ 수 있다/없다";
				n.des="'Can'";
			break;
			case 50:
				rx.push(/l jul al/);
				rx.push(/l jul mo/);
				n.point = "V-(으)ㄹ 줄 알다/모르다";
				n.des="'Know how to'/'not know how to'";
			break;
			case 51:
				rx.push(/se-yo/);
				n.point = "V-(으)세요";
				n.des="Polite request";
			break;
			case 52:
				rx.push(/sib-si-o/);
				n.point = "V-(으)십시오";
				n.des="Polite request";
			break;
			case 53:
				rx.push(/ma-se-/);
				rx.push(/ma-se /);
				n.point = "V-지 마세요";
				n.des="Polite request not to do something";
			break;
			case 54:
				rx.push(/ma-sib-si-o/);
				n.point = "V-지 마십시오";
				n.des="Polite request not to do something";
			break;
			case 55:
				rx.push(/-ya /);
				rx.push(/-ya-/);
				n.point = "A/V-아/어야 (되다/하다)";
				n.des="'Must', 'have to'";
			break;
			case 56:
				rx.push(/do doi/);
				rx.push(/do doae/);
				rx.push(/du doi/);
				rx.push(/du doae/);
				n.point = "A/V-아/어도 되다";
				n.des="'May', 'be allowed to'";
			break;
			case 57:
				rx.push(/myeon an doi/);
				rx.push(/myeon an doae/);
				rx.push(/myeon an-doi/);
				rx.push(/myeon an-doae/);
				n.point = "A/V-(으)면 안 되다";
				n.des="'May not', 'not allowed to'";
			break;
			case 58:
				rx.push(/ji anh-ado doi/);
				rx.push(/ji anh-a-do doae/);
				rx.push(/ji anh-a-do-doi/);
				rx.push(/ji anh-a-do-doae/);
				rx.push(/ji anh-a-du doi/);
				rx.push(/ji anh-a-du doae/);
				rx.push(/ji anh-a-du-doi/);
				rx.push(/ji anh-a-du-doae/);
				n.point = "A/V-지 않아도 되다";
				n.des="'Does not have to'";
			break;
			case 59:
				rx.push(/sip-/);
				n.point = "V-고 싶다";
				n.des="'Want to'";
			break;
			case 60:
				rx.push(/ss-eu-myeon joh-gess/);
				n.point = "A/V-았/었으면 좋겠다";
				n.des="'It would be good if something is true'";
			break;
			case 61:
				rx.push(/a-seo/);
				rx.push(/eo-seo/);
				rx.push(/e-seo/);
				n.point = "A/V-아/어서(요)";
				n.des="'Because'";
			break;
			case 62:
				rx.push(/ttae-mun-e/);
				n.point = "N 때문에, A/V-기 때문에";
				n.des="'Because'";
			break;
			case 63:
				rx.push(/ni-kka/);
				rx.push(/ni /);
				n.point = "A/V-(으)니까(요), A/V-(으)니";
				n.des="'Because', 'when', '(do something) only to discover'";
			break;
			
			case 64:
				rx.push(/ju-se/);
				n.point = "V-아/어 주세요";
				n.des="'Please'/'would you'";
			break;
			case 65:
				rx.push(/ju-si-gess/);
				n.point = "V-아/어 주시겠어요?";
				n.des="'Please', 'would you'";
			break;
			case 66:
				rx.push(/jul-ge/);
				n.point = "V-아/어 줄게(요)";
				n.des="'Shall I', 'allow me'";
			break;
			case 67:
				rx.push(/jul-kka/);
				n.point = "V-아/어 줄까(요)?";
				n.des="'Shall I', 'allow me'";
			break;
			case 68:
				rx.push(/a bo/);
				rx.push(/eo bo/);
				rx.push(/e bo/);
				n.point = "V-아/어 보다";
				n.des="Experesses trying something";
			break;
			case 69:
				rx.push(/n jeog-i iss/);
				n.point = "V-(으)ㄴ 적이 있다/없다";
				n.des="'Have done', 'haven't done'";
			break;
			
			case 70:
				rx.push(/l-kka/);
				n.point = "V-(으)ㄹ까(요)?";
				n.des="'Shall we', 'shall I'?";
			break;
			case 71:
				rx.push(/b-si-da/);
				n.point = "V-(으)ㅂ시다";
				n.des="'Let's', 'shall we'";
			break;
			case 72:
				rx.push(/si-gess/);
				n.point = "V-(으)시겠어(요)?";
				n.des="'Would you (mind/like to)', 'why not?'";
			break;
			case 73:
				rx.push(/l-lae/);
				n.point = "V-(으)ㄹ래(요)?";
				n.des="'Let's', 'how about?', 'be going to', 'will'";
			break;
			case 74:
				rx.push(/gess/);
				n.point = "A/V-겠어(요)";
				n.des="'(I) plan to', '(I) am going to'";
			break;
			case 75:
				rx.push(/l-ge/);
				n.point = "V-(으)ㄹ게(요)";
				n.des="	'Will (do)', indicates intention";
			break;
			case 76:
				rx.push(/ja-ni-gga/);
				rx.push(/da-ni-gga/);
				rx.push(/la-ni-gga/);
				rx.push(/nya-ni-gga/);
				n.point = "-(이/으)(자/다/라/냐)니까(요)";
				n.des="Emphasises something the speaker already said";
			break;
			case 77:
				rx.push(/-leo/);
				n.point = "V-(으)러 가다/오다/다니다...";
				n.des="'(Go/come/etc.) in order to'";
			break;
			case 78:
				rx.push(/lyeo-go/);
				rx.push(/lyeo-gu/);
				n.point = "V-(으)려고";
				n.des="'In order to', 'so that'";
			break;
			case 79:
				rx.push(/lyeo-go ha/);
				rx.push(/lyeo-gu ha/);
				n.point = "V-(으)려고 하다";
				n.des="'Plan to', 'intend to'";
			break;
			case 80:
				rx.push(/l ui-hae/);
				n.point = "N을/를 위해(서)";
				n.des="'For the sake of', 'in order to'";
			break;
			case 81:
				rx.push(/gi ui-hae/);
				n.point = "V-기 위해(서)";
				n.des="'For the sake of', 'in order to'";
			break;
			case 82:
				rx.push(/gi-lo/);
				n.point = "V-기로 (하다)";
				n.des="Indicates a decision or promise";
			break;
			case 83:
				rx.push(/myeon /);
				rx.push(/myeon-(?!seo)/);
				n.point = "A/V-(으)면";
				n.des="'If', 'when', 'once'";
			break;
			case 84:
				rx.push(/l-yeo-myeon/);
				n.point = "V-(으)려면";
				n.des="'If (you) want to', 'if (your) intention is to'";
			break;
			case 85:
				rx.push(/a-do/);
				rx.push(/eo-do/);
				rx.push(/ae-do/);
				rx.push(/a-du/);
				rx.push(/eo-du/);
				rx.push(/ae-du/);
				n.point = "A/V-아/어도";
				n.des="'Even if', 'regardless whether'";
			break;
			case 86:
				rx.push(/gess-/);
				rx.push(/gess /);
				n.point = "A/V-겠(어)(요)";
				n.des="'Appears that'";
			break;
			case 87:
				rx.push(/dam/);
				n.point = "담";
				n.des="'Next', shortened form of 다음";
			break;
			case 88:
				rx.push(/l-kka/);
				n.point = "A/V-(으)ㄹ까(요)?";
				n.des="'Do (you) think...?'";
			break;
			case 89:
				rx.push(/geos gat-/);
				n.point = "A/V-(으)ㄴ/는/(으)ㄹ 것 같다";
				n.des="'Appears that'";
			break;
			case 90:
				rx.push(/(?<!deo)n /);
				rx.push(/(?<!ja)l /);
				n.point = "A/V-(으)ㄴ/-는/-(으)ㄹ N";
				n.des="Noun modifying form";
			break;
			case 91:
				rx.push(/gi-/);
				rx.push(/gi /);
				n.point = "A/V-기";
				n.des="Particle that turns adjectives and verbs into nouns";
			break;
			case 92:
				rx.push(/ge /);
				rx.push(/ge-/);
				n.point = "A-게";
				n.des="'To', 'in a...manner'";
			break;
			case 93:
				rx.push(/a-ha/);
				rx.push(/eo-ha/);
				rx.push(/ae-ha/);
				n.point = "A-아/어하다";
				n.des="'Appears to be', 'seems'";
			break;
			case 94:
				rx.push(/a iss/);
				rx.push(/eo iss/);
				rx.push(/e iss/);
				n.point = "V-아/어 있다";
				n.des="Expresses a continuing state of a completed action";
			break;
			case 95:
				rx.push(/a-ji/);
				rx.push(/eo-ji/);
				rx.push(/ae-ji/);
				rx.push(/a-jyeo/);
				rx.push(/eo-jyeo/);
				rx.push(/ae-jyeo/);
				n.point = "A-아/어지다";
				n.des="Expresses a change in state over time";
			break;
			case 96:
				rx.push(/ge doi/);
				rx.push(/ge doae/);
				n.point = "V-게 되다";
				n.des="Expresses a change from one state to another";
			break;
			case 97:
				rx.push(/n-ji /);
				rx.push(/n-ji-/);
				n.point = "A/V-(으)ㄴ/는지";
				n.des="Connects a clause requiring additional information";
			break;
			case 98:
				rx.push(/n de/);
				n.point = "V-는 데 걸리다/들다";
				n.des="takes/requires, costs...to do";
			break;
			case 99:
				rx.push(/ji-yo /);
				rx.push(/ji /);
				rx.push(/jyo /);
				n.point = "A/V-지(요)/죠?";
				n.des="'Isn't it?', indicates a tag question";
			break;
			case 100:
				rx.push(/gu-na /);
				rx.push(/gu-na-/);
				rx.push(/gun /);
				rx.push(/gun-/);
				rx.push(/neun-gun/);
				n.point = "A/V-군(요)/는군(요)/구나/군";
				n.des="Expresses wonder or surprise";
			break;
			case 101:
				rx.push(/ne-/);
				rx.push(/ne /);
				n.point = "A/V-네(요)";
				n.des="Expresses wonder or surprise";
			break;
			case 102:
				rx.push(/n-ga-neun/);
				rx.push(/n-ga-leul/);
				rx.push(/n-ga/);
				n.point = "A-(으)ㄴ가(요)";
				n.des="Used to politely and gently ask a question";
			break;
			case 103:
				rx.push(/lyeon-man/);
				rx.push(/lyeon-ma-neun/);
				n.point = "A/V-(으)련만/-(으)련마는";
				n.des="'Would, but...'";
			break;
			case 104:
				rx.push(/(?<!deo)n-de-/);
				rx.push(/(?<!deo)n-de /);
				n.point = "A/V-(으)ㄴ/는데(요)";
				n.des="Expresses one's disagreement";
			break;
			case 105:
				rx.push(/ha-g/);
				rx.push(/la-g/);
				rx.push(/lan /);
				rx.push(/lan-/);
				n.point = "-하고/-라고";
				n.des="Direct quotation";
			break;
			case 106:
				rx.push(/ja-/);
				rx.push(/da-/);
				rx.push(/nya-/);
				rx.push(/la-/);
				rx.push(/dae-/);
				rx.push(/jae-/);
				rx.push(/lae-/);
				rx.push(/nyae-/);
				rx.push(/jan-/);
				rx.push(/dan-/);
				rx.push(/nyan-/);
				rx.push(/lan-/);
				rx.push(/daen-/);
				rx.push(/jaen-/);
				rx.push(/laen-/);
				rx.push(/nyaen-/);
				rx.push(/jan /);
				rx.push(/dan /);
				rx.push(/nyan /);
				rx.push(/lan /);
				rx.push(/daen /);
				rx.push(/jaen /);
				rx.push(/laen /);
				rx.push(/nyaen /);
				rx.push(/ja /);
				rx.push(/da /);
				rx.push(/nya /);
				rx.push(/la /);
				rx.push(/dae /);
				rx.push(/jae /);
				rx.push(/lae /);
				rx.push(/nyae /);
				n.point = "-자고/-다고/-라고/냐고/-재/-대/-래/-냬";
				n.des="Indirect quotation";
			break;
			case 107:
				rx.push(/bo-i/);
				n.point = "A-아/어 보이다";
				n.des="Indicates one's conjecture based on the outward appearance of something";
			break;
			case 108:
				rx.push(/mo-yang-/);
				n.point = "A/V-(으)ㄴ/는 모양이다";
				n.des="'shape'/'appearance'";
			break;
			case 109:
				rx.push(/ten-de /);
				rx.push(/ten-de-/);
				n.point = "A/V-(으)ㄹ 텐데";
				n.des="Expresses a future situation or intention";
			break;
			case 110:
				rx.push(/te-ni-/);
				rx.push(/te-ni /);
				n.point = "A/V-(으)ㄹ 테니까";
				n.des="Expresses a reason for giving a particular suggestion or advice";
			break;
			case 111:
				rx.push(/l-geol/);
				n.point = "A/V-(으)ㄹ걸(요)";
				n.des="Expresses an unconfirmed assumption about a future event";
			break;
			case 112:
				rx.push(/jul mol-lass/);
				n.point = "A/V-(으)ㄴ/는/(으)ㄹ 줄 몰랐다";
				n.des="Expresses something the speaker was not aware of or did not anticipate";
			break;
			case 113:
				rx.push(/jul al-ass/);
				n.point = "A/V-(으)ㄴ/는/(으)ㄹ 줄 알았다";
				n.des="Expresses the speaker's realisation that their assumption was incorrect";
			break;
			case 114:
				rx.push(/l-ji-/);
				rx.push(/l-ji /);
				n.point = "A/V-ㄹ지(도) (모르다)";
				n.des="Expresses the speaker's view that something might happen or be true";
			break;
			case 115:
				rx.push(/n ban-myeon-e/);
				n.point = "A/V-(으)ㄴ/는 반면에";
				n.des="Expresses that two things are opposites";
			break;
			case 116:
				rx.push(/n-de-do/);
				rx.push(/n-de-du/);
				n.point = "A/V-(으)ㄴ/는데도";
				n.des="Expresses an unexpected state of affairs";
			break;
			case 117:
				rx.push(/da /);
				rx.push(/ss-da /);
				rx.push(/n-da /);
				rx.push(/l geos/);
				n.point = "-았/었다, -다, -(느)ㄴ다, -(으)ㄹ 것이다";
				n.des="Narration";
			break;
			case 118:
				rx.push(/oa /);
				rx.push(/ueo /);
				rx.push(/-a /);
				rx.push(/-eo /);
				rx.push(/-hae /);
				rx.push(/-ya /);
				rx.push(/-ni /);
				rx.push(/ a /);
				rx.push(/ eo /);
				rx.push(/ hae /);
				rx.push(/ ya /);
				rx.push(/ ni /);
				n.point = "-아/어, -(이)야, -니";
				n.des="Casual speech";
			break;
			case 119:
				rx.push(/eo la-/);
				rx.push(/a la-/);
				rx.push(/e la-/);
				rx.push(/ji ma-/);
				rx.push(/ji-ma-/);
				rx.push(/ma-la-/);
				rx.push(/eo la /);
				rx.push(/a la /);
				rx.push(/e la /);
				rx.push(/ji ma /);
				rx.push(/ji-ma /);
				rx.push(/ma-la /);
				n.point = "-아/어 라, -지 마, -지 마라";
				n.des="Casual speech - imperative";
			break;
			case 120:
				rx.push(/ja /);
				n.point = "-자, 지 말자";
				n.des="Casual speech - propositive";
			break;
			case 121:
				rx.push(/-en-/);
				rx.push(/-en /);
				rx.push(/ en-/);
				rx.push(/ en /);
				n.point = "-엔";
				n.des="Declaritive form, shortened form of '-에는'";
			break;
			case 122:
				rx.push(/nae-/);
				rx.push(/nae /);
				n.point = "내";
				n.des="Contraction of 나의";
			break;
			case 123:
				rx.push(/je-/);
				rx.push(/je /);
				n.point = "제";
				n.des="Contraction of 저의";
			break;
			case 124:
				rx.push(/ne-/);
				rx.push(/ne /);
				n.point = "네";
				n.des="Contraction of 너의";
			break;
			case 125:
				rx.push(/-ya /);
				rx.push(/-a /);
				rx.push(/ ya /);
				rx.push(/ a /);
				n.point = "-야, -아";
				n.des="Particle used in casual speech when calling someone by name";
			break;
			case 126:
				rx.push(/geo-deun/);
				n.point = "A/V-거든(요)";
				n.des="Used to respond to a question or add to a statement";
			break;
			case 127:
				rx.push(/janh-/);
				rx.push(/janh /);
				n.point = "A/V-잖아(요)";
				n.des="Used to state a reason that the listener should be aware of";
			break;
			case 128:
				rx.push(/-neu-la/);
				n.point = "V-느라고";
				n.des="Used to state a reason";
			break;
			case 129:
				rx.push(/n ba-lam/);
				n.point = "V-는 바람에";
				n.des="Used to state a reason";
			break;
			case 130:
				rx.push(/n tas-e/);
				n.point = "A/V-(으)ㄴ/는 탓에";
				n.des="Used to state a reason";
			break;
			case 131:
				rx.push(/go hae-seo/);
				rx.push(/gu hae-seo/);
				n.point = "A/V-고 해서";
				n.des="Used to state a reason, while hinting that there are a number of other reasons";
			break;
			case 132:
				rx.push(/l-kka boa/);
				n.point = "A/V-(으)ㄹ까 봐";
				n.des="Indicates that the reason for an action was due to worry about something";
			break;
			case 133:
				rx.push(/da-myeon-s/);
				n.point = "A/V-다면서(요)?";
				n.des="Used to confirm what the speaker has heard from a third party";
			break;
			case 134:
				rx.push(/deon-de/);
				n.point = "A/V-던데";
				n.des="Indicates recollection";
			break;
			case 135:
				rx.push(/da-ni/);
				rx.push(/la-ni/);
				rx.push(/nya-ni/);
				rx.push(/ja-ni/);
				n.point = "A/V-다니(요)";
				n.des="Expresses surprise towards what somebody has said";
			break;
			case 136:
				rx.push(/l-kka/);
				n.point = "A/V-(으)ㄹ까";
				n.des="Indicates a reason";
			break;
			case 137:
				rx.push(/go-ja/);
				rx.push(/gu-ja/);
				n.point = "V-고자";
				n.des="Indicates a reason";
			break;
			case 138:
				rx.push(/lyeo-deon cham/);
				n.point = "V-(으)려던 참이다";
				n.des="Indicates that the speaker was already about to do what another person suggested";
			break;
			case 139:
				rx.push(/gyeom/);
				n.point = "V-(으)ㄹ 겸/N 겸";
				n.des="Indicates the speaker's intention to do a number of actions";
			break;
			case 140:
				rx.push(/ya-ji/);
				rx.push(/ya-jyo/);
				n.point = "V-아/어야지(요)";
				n.des="Used to make a promise to oneself or to tell someone that they need to do something";
			break;
			case 141:
				rx.push(/l manh/);
				n.point = "V-(으)ㄹ 만하다";
				n.des="Indicates that something is worth doing";
			break;
			case 142:
				rx.push(/do-log ha/);
				n.point = "V-도록 하다";
				n.des="Used to give a suggestion";
			break;
			case 143:
				rx.push(/ji geul/);
				n.point = "V-지 그래(요)";
				n.des="Used to give a suggestion";
			break;
			case 144:
				rx.push(/deon(?!-de)/);
				n.point = "A/V-았/었던";
				n.des="Indicates recollection";
			break;
			case 145:
				rx.push(/deo-la/);
				n.point = "A/V-더라고(요)";
				n.des="Indicates recollection";
			break;
			case 146:
				rx.push(/a-ji/);
				rx.push(/eo-ji/);
				rx.push(/ae-ji/);
				rx.push(/a-jyeo/);
				rx.push(/eo-jyeo/);
				rx.push(/ae-jyeo/);
				n.point = "V-아/어지다";
				n.des="Used when the subject's actions occur because of an action performed by somebody else";
			break;
			case 147:
				rx.push(/ge do/);
				n.point = "V-게 되다";
				n.des="Expresses the passive in cases in which the subject's will is not involved";
			break;
			case 148:
				rx.push(/ge ha/);
				n.point = "A/V-게 하다";
				n.des="Indicates that the subject makes somebody else do some behavior";
			break;
			case 149:
				rx.push(/a ya/);
				rx.push(/eo ya/);
				rx.push(/e ya/);
				n.point = "A/V-아/어야";
				n.des="Used to state a condition that must be met for a certain outcome";
			break;
			case 150:
				rx.push(/geo-deun/);
				n.point = "A/V-거든";
				n.des="Expresses if some statement is true, then...";
			break;
			case 151:
				rx.push(/(?<!deo)n-de /);
				rx.push(/(?<!deo)n-de-/);
				n.point = "A/V-(으)ㄴ/는데(요)";
				n.des="Used to give an explanation";
			break;
			case 152:
				rx.push(/l ppun-man a-ni/);
				n.point = "A/V-(으)ㄹ 뿐만 아니라";
				n.des="'Not only... but also...'";
			break;
			case 153:
				rx.push(/de-da/);
				n.point = "A/V-(으)ㄴ/는 데다가";
				n.des="Used to express actions occuring at the same time";
			break;
			case 154:
				rx.push(/jo-cha/);
				n.point = "N조차";
				n.des="'Even'";
			break;
			case 155:
				rx.push(/man hae-do/);
				rx.push(/man hae-du/);
				n.point = "N만 해도";
				n.des="Used to give examples to explain something";
			break;
			case 156:
				rx.push(/n gil-e/);
				n.point = "V-는 길에";
				n.des="Used when the speaker does an action while in the process of going somewhere";
			break;
			case 157:
				rx.push(/da-ga /);
				rx.push(/da /);
				n.point = "V-다가/-다";
				n.des="Expresses an interruption of action to immediately start doing another";
			break;
			case 158:
				rx.push(/l jeong-do-lo/);
				n.point = "A/V-(으)ㄹ 정도로";
				n.des="'To the extent'";
			break;
			case 159:
				rx.push(/man ha/);
				n.point = "N만 하다";
				n.des="Describes one object as approximately the same size, amount, or degree as another";
			break;
			case 160:
				rx.push(/man-keum/);
				n.point = "A/V-(으)ㄴ/는/(으)ㄹ 만큼, N만큼";
				n.des="Describes two objects as equivalent";
			break;
			case 161:
				rx.push(/a-mu/);
				n.point = "아무+(이)나";
				n.des="'Anyone'";
			break;
			case 162:
				rx.push(/a-mu/);
				n.point = "아무+도";
				n.des="'Nobody'";
			break;
			case 163:
				rx.push(/na /);
				n.point = "N(으)나";
				n.des="Indicates that something is dissatisfactory or not the best choice";
			break;
			case 164:
				rx.push(/la-do/);
				n.point = "N(으)라도";
				n.des="Indicates that something will suffice even though it is not the best choice, 'even N (must/are/have/do...)'";
			break;
			case 165:
				rx.push(/deun-/);
				rx.push(/deun /);
				n.point = "N/A/V-든(지), N/A/V-든(가)";
				n.des="'Regardless', 'no matter', indicates that any of the stated choices are fine";
			break;
			case 166:
				rx.push(/dae-sin/);
				n.point = "A/V-(으)ㄴ/는 대신에, N 대신에";
				n.des="Indicates that an action can be substituted by another action";
			break;
			case 167:
				rx.push(/man-e/);
				n.point = "N만에";
				n.des="Expresses that something happened a certain amount of time after a previous action";
			break;
			case 168:
				rx.push(/ga-ji-go/);
				rx.push(/ga-ji-gu/);
				n.point = "V-아/어 가지고";
				n.des="Indicates the doing of an action following the completion of another action";
			break;
			case 169:
				rx.push(/ae-da/);
				rx.push(/a-da/);
				rx.push(/eo-da/);
				n.point = "V-아/어다가";
				n.des="Indicates the doing of an action following the completion of another action";
			break;
			case 170:
				rx.push(/go-seo/);
				rx.push(/gu-seo/);
				n.point = "V-고서";
				n.des="Indicates that the first action completed before the second action started";
			break;
			case 171:
				rx.push(/go bo-ni/);
				rx.push(/gu bo-ni/);
				n.point = "V-고 보니";
				n.des="Indicates that the speaker learned something new";
			break;
			case 172:
				rx.push(/da bo-n/);
				rx.push(/da-ga bo-n/);
				n.point = "V-다 보니, V-다가 보니";
				n.des="Indicates that the speaker learned something new after doing some action continuously in the past";
			break;
			case 173:
				rx.push(/da bo-myeon/);
				rx.push(/da-ga bo-myeon/);
				n.point = "V-다 보면, V-다가 보면";
				n.des="Indicates that if an action continues, then over time the result will occur";
			break;
			case 174:
				rx.push(/deo-ni/);
				n.point = "A/V-더니, A/V-더니만";
				n.des="Used to refer to something directly experienced or seen in the past when describing how that thing subsequently changed";
			break;
			case 175:
				rx.push(/ss-deo-ni/);
				n.point = "V-았/었더니";
				n.des="Indicates that something happened as a result of something the speaker did or said previously";
			break;
			case 176:
				rx.push(/-da-ga-neun/);
				n.point = "A/V-다가는";
				n.des="Expresses that if an action continues, then an adverse result will occur in the future";
			break;
			case 177:
				rx.push(/n sen-/);
				n.point = "A/V-(으)ㄴ/는 센이다";
				n.des="Indicates that something could be considered equivalent";
			break;
			case 178:
				rx.push(/n chae-lo/);
				n.point = "V-(으)ㄴ 채로";
				n.des="Used to describe an action performed while in a certain state";
			break;
			case 179:
				rx.push(/eo noh-/);
				rx.push(/e noh-/);
				rx.push(/a noh-/);
				n.point = "V-아/어 놓다";
				n.des="Indicates the continuation of a state";
			break;
			case 180:
				rx.push(/eo du/);
				rx.push(/e du/);
				rx.push(/a du/);
				n.point = "V-아/어 두다";
				n.des="Indicates the continuation of a state following the completion of an action";
			break;
			case 181:
				rx.push(/dae-lo/);
				n.point = "V-(으)ㄴ/는 대로, N대로";
				n.des="'In accordance with'";
			break;
			case 182:
				rx.push(/n pyeon/);
				n.point = "A/V-(으)ㄴ/는 편이다";
				n.des="Used to state a characteristic";
			break;
			case 183:
				rx.push(/seu-leob/);
				n.point = "N스럽다";
				n.des="Expresses having the same qualities of a certain noun";
			break;
			case 184:
				rx.push(/dab/);
				n.point = "N답다";
				n.des="Expresses having the same qualities of a certain noun";
			break;
			case 185:
				rx.push(/n-ji mol/);
				n.point = "얼마나 A/V-(으)ㄴ/는지 모르다";
				n.des="Used to exphasise the degree of a particular situation or state of affairs";
			break;
			case 186:
				rx.push(/l su-bakk-e eobs-/);
				n.point = "A/V-(으)ㄹ 수밖에 없다";
				n.des="Expresses there is no other choice but to do the action";
			break;
			case 187:
				rx.push(/l ppun/);
				rx.push(/l-ppun/);
				n.point = "A/V-(으)ㄹ 뿐이다";
				n.des="Expresses there is only one available course of action or state";
			break;
			case 188:
				rx.push(/ya-mal-lo/);
				n.point = "N(이)야말로";
				n.des="Strongly emphasises the meaning of a noun";
			break;
			case 189:
				rx.push(/ge /);
				rx.push(/ge-/);
				n.point = "A/V-게";
				n.des="Indicates the following action is necessary to realise the preceding action or state";
			break;
			case 190:
				rx.push(/do-log/);
				n.point = "A/V-도록";
				n.des="Indicates the following action is necessary to realise the preceding action or state";
			break;
			case 191:
				rx.push(/ss-da-ga/);
				n.point = "V-았/었다가";
				n.des="Indicates that the subject performs the second action after the first action is complete";
			break;
			case 192:
				rx.push(/na ma-na/);
				rx.push(/na-ma-na/);
				n.point = "V-(으)나 마나";
				n.des="Expresses that an action is of no value or use";
			break;
			case 193:
				rx.push(/eo beo-l/);
				rx.push(/e beo-l/);
				rx.push(/a beo-l/);
				rx.push(/eo-beo-l/);
				rx.push(/e-beo-l/);
				rx.push(/a-beo-l/);
				n.point = "V-아/어 버리다";
				n.des="Indicates the complete and thorough finishing of an action or event";
			break;
			case 194:
				rx.push(/go mal/);
				rx.push(/gu mal/);
				rx.push(/gu-mal/);
				rx.push(/go-mal/);
				n.point = "V-고 말다";
				n.des="Refers to an unplanned action or event that continued until it was complete and thoroughly finished";
			break;
			case 195:
				rx.push(/boass-ja/);
				n.point = "A/V-아/어 봤자";
				n.des="Expresses that there is no use even to try to do a certain action";
			break;
			case 196:
				rx.push(/da-myeon(?!-seo)/);
				n.point = "A/V-(느)ㄴ다면";
				n.des="Used to refer to a hypothetical situation";
			break;
			case 197:
				rx.push(/ss-deo-la-myeon/);
				n.point = "A/V-았/었더라면";
				n.des="Used to refer to a hypothetical situation in the past that is opposite of what actually happened";
			break;
			case 198:
				rx.push(/l ppeon-ha/);
				n.point = "V-(으)ㄹ 뻔하다";
				n.des="Indicates that an action almost happened, but did not";
			break;
			case 199:
				rx.push(/l-geol geu-laess-/);
				n.point = "V-(으)ㄹ걸 그랬다";
				n.des="Used to express regret";
			break;
			case 200:
				rx.push(/ss-eo-ya haess-neun-de/);
				n.point = "A/V-았/었어야 했는데";
				n.des="Used to express regret";
			break;
			case 201:
				rx.push(/gon ha/);
				rx.push(/go-neun ha/);
				rx.push(/gu-neun ha/);
				rx.push(/gun ha/);
				n.point = "V-곤 하다, V-고는 하다";
				n.des="Used to describe something that occurs repeatedly";
			break;
			case 202:
				rx.push(/gi-neun/);
				rx.push(/gin-yo/);
				n.point = "A/V-기는(요), N(이)기는(요)";
				n.des="Expresses a polite disagreement";
			break;
			case 203:
				rx.push(/n cheog-ha/);
				n.point = "A/V-(으)ㄴ/는 척하다, N인 척하다";
				n.des="'To act','to pretend'";
			break;
			case 204:
				rx.push(/neu-ni/);
				n.point = "V-느니";
				n.des="Expresses the best choice out of two poor choices";
			break;
			case 205:
				rx.push(/l bae-ya/);
				n.point = "V-(으)ㄹ 바에야";
				n.des="Expresses the speaker's preference out of two poor choices";;
			break;
			case 206:
				rx.push(/geon/);
				rx.push(/geo-na/);
				n.point = "A/V-건 -건";
				n.des="Lists two comparable or contrasting clauses, and indicates that choosing either one will have the same result";
			break;
			case 207:
				rx.push(/gi-bo-da-neun/);
				n.point = "A/V-(느)ㄴ다기보다는";
				n.des="Indicates a more appropriate description of a subject";
			break;
			case 208:
				rx.push(/bo-go/);
				rx.push(/bo-gu/);
				n.point = "-보고";
				n.des="Indicates a person to whom a question, order, request, or suggestion is verbally directed";
			break;
			case 209:
				rx.push(/n-da-ni/);
				rx.push(/n-da-go ha-ni-kka/);
				n.point = "A/V-(느)ㄴ다니까";
				n.des="Indicates the speaker's response to a statement heard from somebody else";
			break;
			case 210:
				rx.push(/n-da-myeon-seo/);
				rx.push(/ha-myeon-seo/);
				n.point = "A/V-(느)ㄴ다면서";
				n.des="Expresses doing an action while saying something, expresses connecting of one statement to a previously mentioned statement";
			break;
			case 211:
				rx.push(/e-ui-ha-myeon/);
				rx.push(/e tta-leu-myeon/);
				n.point = "A/V-에 의하면, A/V-에 따르면";
				n.des="Expresses the basis or grounds of a fact";
			break;
			case 212:
				rx.push(/-o-/);
				rx.push(/-so-/);
				rx.push(/-o /);
				rx.push(/-so /);
				rx.push(/ o-/);
				rx.push(/ so-/);
				rx.push(/ o /);
				rx.push(/ so /);
				n.point = "A/V-오/소";
				n.des="Honorific - imperative";
			break;
			case 213:
				rx.push(/n de/);
				n.point = "V-는 데";
				n.des="Has the meaning of -는 일, -는 것, -는 경우, and -는 상황";
			break;
			case 214:
				rx.push(/n ba/);
				n.point = "V-는 바";
				n.des="Indicates the immediately preceding content";
			break;
			case 215:
				rx.push(/in-hae-seo/);
				n.point = "A/V-(이)로 인해서";
				n.des="Indicates the cause  or reason for a state of affairs";
			break;
			case 216:
				rx.push(/n tong-e/);
				n.point = "A/V-는 통에";
				n.des="Indicates the cause  or reason for a negative state of affairs";
			break;
			case 217:
				rx.push(/mal-mi-am-a/);
				n.point = "-(으)로 말미암아";
				n.des="Indicates that the thing stated in the preceding clause is the cause for the result stated in the following clause";
			break;
			case 218:
				rx.push(/neu-ni-man-keum/);
				n.point = "A/V-느니만큼";
				n.des="Indicates that the preceding clause forms the reason or basic for the following clause";
			break;
			case 219:
				rx.push(/n i-sang/);
				n.point = "A/V-는 이상";
				n.des="Indicates that due to the preceding clause being already decided or obvious, then the next course of action is obvious";
			break;
			case 220:
				rx.push(/gi-lo-seo-ni/);
				n.point = "A/V-기로서니";
				n.des="Expresses that while the speaker acknowledges the fact stated in the preceding clause, it is unsufficient as a reason or condition for the action given in the following clause";
			break;
			case 221:
				rx.push(/mang-jeong-i-ji/);
				n.point = "A/V-기에 망정이지";
				n.des="Indicates that although an embarassing or confusing situation occured, the situation did not end in a negative result thanks to the content stated in the preceding clause";
			break;
			case 222:
				rx.push(/n-dab-si-go/);
				rx.push(/n-dab-si-gu/);
				n.point = "V-(느)ㄴ답시고";
				n.des="Used to sarcastically express that while the subject of the sentence had intended to do something correctly, the effort ended in an unexpected and unsatisfactory result";
			break;
			case 223:
				rx.push(/eu-lo-sseo/);
				n.point = "A/V-(으)ㅁ으로써";
				n.des="Indicates that the movement described in the preceding clause is a means by which some action occurs in the following clause";
			break;
			case 224:
				rx.push(/-gi-e/);
				n.point = "A/V-기에";
				n.des="Indicates that the content in the preceding clause forms the cause, reason, or basis for the following clause";
			break;
			case 225:
				rx.push(/-gil-lae/);
				n.point = "A/V-길래";
				n.des="Indicates that the content stated by the speaker in the preceding clause forms the cause, reason, or basis for an action taken in the following clause";
			break;
			case 226:
				rx.push(/deo-la-do/);
				rx.push(/deo-la-du/);
				n.point = "A/V-더라도";
				n.des="Indicated that while the speaker acknowledges and accepts the possibility of the content in the preceding clause, it does not have any affect on the following clause";
			break;
			case 227:
				rx.push(/l-ji-la-do/);
				rx.push(/l-ji-la-du/);
				n.point = "A/V-(으)ㄹ지라도";
				n.des="Indicated that even if the speaker acknowledges or hypothesises the content in the preceding clause, it does not have any affect on the situation or event stated in the following clause";
			break;
			case 228:
				rx.push(/n-deul/);
				n.point = "-(으)ㄴ들";
				n.des="Indicates that even if the speaker acknowledges some hypothetical condition in the preceding clause, the result in the following clause will still be different than expected";
			break;
			case 229:
				rx.push(/l-mang-jeong/);
				n.point = "A/V-(으)ㄹ망정";
				n.des="Hypothesises the content in the preceding clause";
			break;
			case 230:
				rx.push(/da-go ch/);
				rx.push(/da-gu ch/);
				n.point = "A/V-(느)ㄴ다고 치다";
				n.des="Used to acknowledge or assume someone's behavior or assertion";
			break;
			case 231:
				rx.push(/sem-ch/);
				n.point = "V-는 셈치다";
				n.des="Used to hypothesise doing some action, or to hypothesise some state of affairs as true";
			break;
			case 232:
				rx.push(/mu-seob-ge/);
				n.point = "A/V-기가 무섭게";
				n.des="Emphasises the fact that something occurs immediately after something else ends";
			break;
			case 233:
				rx.push(/-ja /);
				n.point = "A/V-자";
				n.des="Indicates that some action occurs immediately after the completion of another action";
			break;
			case 234:
				rx.push(/n han/);
				n.point = "V-는 한";
				n.des="Indicates a premise or condition";
			break;
			case 235:
				rx.push(/la-chi-myeon/);
				n.point = "A/V-(으)ㄹ라치면";
				n.des="Indicates that a situation occurs every time the subject tries to do a particular task";
			break;
			case 236:
				rx.push(/no-la-myeon/);
				n.point = "V-노라면";
				n.des="Indicates that if the subject keeps or maintains a particular state of affairs, then the situation stated in the following clause will occur";
			break;
			case 237:
				rx.push(/neu-nya-e dal-lyeo/);
				n.point = "A/V-느냐에 달려 있다";
				n.des="Indicates that the circumstance or situation in the preceding clause depends on the content stated in the following clause";
			break;
			case 238:
				rx.push(/gi na-leum/);
				n.point = "A/V-기 나름이다";
				n.des="Indicates that the result of some situation can end up differently depending on how the situation unfolds";
			break;
			case 239:
				rx.push(/n dae-lo/);
				n.point = "N은/는 대로";
				n.des="Indicates that each noun has its own different characteristic with respect to the following content";
			break;
			case 240:
				rx.push(/n gim-e/);
				n.point = "V-는 김에";
				n.des="Expresses that the action or state of affairs resulting from the action in the preceding clause becomes an opportunity to do another unplanned but related action";
			break;
			case 241:
				rx.push(/geon-man/);
				n.point = "A/V-건만";
				n.des="Expresses that the content in the following clause is the opposite of the result expected based on the content in the preceding clause";
			break;
			case 242:
				rx.push(/go-do/);
				rx.push(/gu-do/);
				rx.push(/go-du/);
				rx.push(/gu-du/);
				n.point = "V-고도";
				n.des="Indicates that some unexpected action or situation occurs in the following clause after the completion of the action in the preceding clause";
			break;
			case 243:
				rx.push(/bul-gu-ha-go/);
				rx.push(/bul-gu-ha-gu/);
				n.point = "A/V-(으)ㅁ에도 불구하고";
				n.des="Indicates that the content in the following clause is the opposite result than what was expected based on the action or circumstance described in the preceding clause";
			break;
			case 244:
				rx.push(/deus/);
				n.point = "A/V-듯이";
				n.des="Indicates that the contents in the preceding and following clause are almost the same";
			break;
			case 245:
				rx.push(/da-si-pi/);
				n.point = "A/V-다시피 하다";
				n.des="Indicates that some action is actually very close to another action but not exactly the same";
			break;
			case 246:
				rx.push(/geo-ni-oa/);
				n.point = "A/V-거니와";
				n.des="Acknowledges the statement in the preceding clause, but at the same time adding the statement in the following clause";
			break;
			case 247:
				rx.push(/gi-neun-keo-nyeong/);
				n.point = "A/V-기는커녕";
				n.des="Expresses that the content in the preceding clause is easily realised, but also the content in the following clause is even more so";
			break;
			case 248:
				rx.push(/ne-/);
				rx.push(/ne /);
				n.point = "A/V-네";
				n.des="Honorific - declarative";
			break;
			case 249:
				rx.push(/na /);
				rx.push(/n-ga /);
				n.point = "A/V-(으)ㄴ/는가?, V-나?";
				n.des="Honorific - inquisitive, used to politely and gently ask a question or to confirm something";
			break;
			case 250:
				rx.push(/l-ppun-deol/);
				n.point = "A/V-(으)ㄹ뿐더러";
				n.des="Expresses additional facts";
			break;
			case 251:
				rx.push(/doi/);
				n.point = "A/V-되";
				n.des="Acknowledges the statement in the preceding clause, but at the same time adding an additional explanation or condition in the following clause";
			break;
			case 252:
				rx.push(/ma-jeo/);
				n.point = "N마저";
				n.des="Expresses that a particular noun is the last thing remaining from a group of included things";
			break;
			case 253:
				rx.push(/l bi-los-ha/);
				n.point = "N을/를 비롯해서";
				n.des="Indicates that a particular noun is the first in a series";
			break;
			case 254:
				rx.push(/dae/);
				n.point = "V-아/어 대다";
				n.des="Expresses that an action is done excessively and continuously";
			break;
			case 255:
				rx.push(/gi il-ssu/);
				rx.push(/gi-ga il-ssu/);
				n.point = "V-기 일쑤이다";
				n.des="Indicates that an action occurs regularly";
			break;
			case 256:
				rx.push(/n dung ha/);
				n.point = "V-는 둥 하다";
				n.des="Expresses that the subject only partially or half-heartedly does some action";
			break;
			case 257:
				rx.push(/li-man-chi/);
				n.point = "A/V-(으)리만치";
				n.des="Used to emphasise the content in the following clause by indicating the degree to which the situation or state of affairs in the preceding clause describes it";
			break;
			case 258:
				rx.push(/da mos-ha/);
				n.point = "A/V-다 못해";
				n.des="Expresses that the action or state of affairs in the preceding clause has reached an extreme degree and can no longer be maintained";
			break;
			case 259:
				rx.push(/n-da-neun ge/);
				n.point = "V-(느)ㄴ다는 것이";
				n.des="Indicates that the result stated in the following clause is not the result of the intention stated in the preceding clause";
			break;
			case 260:
				rx.push(/l-yeo-go deu/);
				rx.push(/l-yeo-gu deu/);
				rx.push(/l-yeo deu/);
				n.point = "V-(으)려고 들다";
				n.des="Expresses the subject's strong and active effort to achieve some goal";
			break;
			case 261:
				rx.push(/l-yeo-da-ga/);
				n.point = "A/V-(으)려다가";
				n.des="Indicates that the subject had intended to do some action but then decided to quit";
			break;
			case 262:
				rx.push(/n deus/);
				n.point = "A/V-는 듯이";
				n.des="Used for speculating that the action or situation expressed in the following clause is, or appears to be, just like the action or situation described in the preceding clause";
			break;
			case 263:
				rx.push(/n-da-neun deus/);
				n.point = "A/V-(느)ㄴ다는 듯이";
				n.des="Used to indicate that the action or situation expressed in the following clause is just like the action or situation described in the preceding clause";
			break;
			case 264:
				rx.push(/n deus-ha/);
				n.point = "A/V-는 듯하다";
				n.des="Used when the speaker is speculating about some event or situation";
			break;
			case 265:
				rx.push(/l ge ppeon-ha/);
				n.point = "A/V-(으)ㄹ 게 뻔하다";
				n.des="Expresses that one can predict the result of some future action or situation based on previous similar experience";
			break;
			case 266:
				rx.push(/l beob-ha/);
				n.point = "A/V-(으)ㄹ 법하다";
				n.des="Indicates that it seems to the speaker that there is a strong possibility or reason that will occur in the future";
			break;
			case 267:
				rx.push(/l li-ga eobs-/);
				rx.push(/l li eobs-/);
				n.point = "A/V-(으)ㄹ 리가 없다";
				n.des="Expresses that the speaker knows from past experience that the following content is clearly not true";
			break;
			case 268:
				rx.push(/gi sib-sang-/);
				n.point = "A/V-기 십상이다";
				n.des="Indicates that under the current circumstances, it is probable or easy for something to happen";
			break;
			case 269:
				rx.push(/gi ma-lyeon-/);
				n.point = "A/V-기 마련이다";
				n.des="Indicates that the occurance of something is inevitable";
			break;
			case 270:
				rx.push(/n beob-i/);
				n.point = "A/V-는 법이다";
				n.des="Indicates that some action or state of affairs is already decided or is inevitable";
			break;
			case 271:
				rx.push(/n-ga ha-myeon/);
				n.point = "A/V-는가 하면";
				n.des="Expresses that the contents of the preceding and following clauses are contrary or different to eachother";
			break;
			case 272:
				rx.push(/eu-ni/);
				rx.push(/ni ha/);
				n.point = "A/V-느니 -느니 하다";
				n.des="Used when listing a number of statements said by the subject";
			break;
			case 273:
				rx.push(/lya/);
				n.point = "V-(으)랴 -(으)랴";
				n.des="Used when listing a number of actions, all of which the subject is making a great effort to try to finish";
			break;
			case 274:
				rx.push(/myeo /);
				rx.push(/myeo-/);
				n.point = "A/V-(이)며 -(이)며";
				n.des="Used when listing a number of things or statements, implying that the list is large and there are other things that belong to the list that are not stated";
			break;
			case 275:
				rx.push(/n kkeut-e/);
				n.point = "A/V-(으)ㄴ 끝에";
				n.des="Indicates that a result wasn't obtained until after a long period of time or a difficult process";
			break;
			case 276:
				rx.push(/eo nae/);
				rx.push(/e nae/);
				rx.push(/a nae/);
				rx.push(/eo-nae/);
				rx.push(/e-nae/);
				rx.push(/a-nae/);
				n.point = "A/V-아/어 내다";
				n.des="Indicates that the subject was able to complete a particular task after experiencing some difficulty";
			break;
			case 277:
				rx.push(/n na-meo-j/);
				n.point = "A/V-(으)ㄴ 나머지";
				n.des="Indicates that continuing a particular action or situation eventually results in some other situation or state of affairs";
			break;
			case 278:
				rx.push(/(?<!deon-|neun-)de-/);
				rx.push(/(?<!deon-|neun-)de /);
				n.point = "A/V-데(요)";
				n.des="Expresses recollection";
			break;
			case 279:
				rx.push(/ga-un-de/);
				n.point = "A/V-는 가운데";
				n.des="Expresses that the content of the following clause occurs while the action or state described in the first clause continues";
			break;
			case 280:
				rx.push(/n ma-dang-e/);
				n.point = "A/V-는 마당에";
				n.des="Expresses that the preceding clause describes the context in which the action in the following clause occurs";
			break;
			case 281:
				rx.push(/chi-go/);
				rx.push(/chi-gu/);
				n.point = "N치고";
				n.des="Indicates that something is the case in every instance of a particular noun";
			break;
			case 282:
				rx.push(/tta-la/);
				n.point = "A/V-(으)ㅁ에 따라";
				n.des="Indicates that the result stated in the following clause is based on the standard stated in the preceding clause";
			break;
			case 283:
				rx.push(/yeo-gan/);
				n.point = "여간 -지 않다";
				n.des="Emphasises a meaning";
			break;
			case 284:
				rx.push(/i-leul de eobs-/);
				rx.push(/i-leul de-ga eobs-/);
				n.point = "A/V-기가 이를 데 없다";
				n.des="Emphasises the fact that the degree of some state of affairs defies description in terms of being great, immense, or tremendous";
			break;
			case 285:
				rx.push(/su-ga eobs-/);
				n.point = "V-(으)ㄹ래야 -(으)ㄹ 수가 없다";
				n.des="Emphasises the fact that the speaker is not able to do something no matter how hard he or she tries due to some circumstance";
			break;
			case 286:
				rx.push(/se /);
				rx.push(/se-/);
				n.point = "V-세";
				n.des="Honorific - propositive";
			break;
			case 287:
				rx.push(/gu-meon/);
				n.point = "A/V-(는)구먼";
				n.des="Honorific - assertive";
			break;
			case 288:
				rx.push(/-ge /);
				rx.push(/-ge-/);
				n.point = "V-게, V-지 말게";
				n.des="Honorific - imperative";
			break;
			case 289:
				rx.push(/-meu-lo/);
				n.point = "A/V-(으)므로";
				n.des="Indicates a cause or reason";
			break;
			case 290:
				rx.push(/-na /);
				n.point = "A/V-(으)나";
				n.des="Indicates a situation or action in the following clause that is contrary or opposite to the one stated in the preceding clause";
			break;
			case 291:
				rx.push(/-myeo /);
				rx.push(/-myeo-/);
				n.point = "A/V-(으)며";
				n.des="Used for listing multiple actions or states in equal terms";
			break;
			case 292:
				rx.push(/-doi/);
				rx.push(/-doae/);
				n.point = "N되다";
				n.des="Attaches to certain nouns, mainly Sino-Korean, to express the passive form in which the action or state expressed was performed by some other subject";
			break;
			case 293:
				rx.push(/-dang-ha/);
				n.point = "-당하다";
				n.des="Attaches to words to express the passive form in which the action or state expressed was performed by some other subject";
			break;
			case 293:
				rx.push(/-si-k/);
				n.point = "N시키다";
				n.des="Attaches to nouns to express a causative meaning, such as when the subject makes another somebody or something else do something, or causes some state of affairs";
			break;
			case 294:
				rx.push(/l-se-la/);
				n.point = "A/V-(으)ㄹ세라";
				n.des="Indicates that the speaker's worry about the occurance of the content in the preceding clause forms the basis for doing the action in the following clause";
			break;
			case 295:
				rx.push(/n yang/);
				n.point = "A/V-는 양";
				n.des="Indicates that the action or situation described in the following clause is, or appears to be, just like the one described in the preceding clause";
			break;
			case 296:
				rx.push(/n han-pyeon/);
				n.point = "V-는 한편";
				n.des="Expresses simultaneously doing two actions, or the simultaneous occurance of two actions";
			break;
			case 297:
				rx.push(/l teog-i eobs-/);
				n.point = "A/V-(으)ㄹ 턱이 없다";
				n.des="Used to strongly indicate the speaker's belief that something is clearly not the case, based on the speaker's prior experience";
			break;
			case 298:
				rx.push(/-la-/);
				rx.push(/-la /);
				n.point = "V-아/어라, V-너라, V-거라";
				n.des="Indicates a command";
			break;
			case 299:
				rx.push(/-go-/);
				rx.push(/-gu-/);
				rx.push(/-go /);
				rx.push(/-gu /);
				n.point = "A/V-고(요)";
				n.des="Used to add additional information to something stated earlier";
			break;
			case 300:
				rx.push(/-geub/);
				n.point = "N급";
				n.des="Indicates the class or grade of a noun";
			break;
			case 301:
				rx.push(/n-da-neun/);
				rx.push(/n-ja-neun/);
				rx.push(/n-nya-neun/);
				rx.push(/n-la-neun/);
				n.point = "-은/는다는 것";
				n.des="Indirect quotation";
			break;
			case 302:
				rx.push(/tto-han/);
				n.point = "또한";
				n.des="'Also'";
			break;
			case 303:
				rx.push(/n geos/);
				rx.push(/n-geos/);
				n.point = "V-는 것";
				n.des="'-ing', turns a verb into a noun clause";
			break;
			case 304:
				rx.push(/n ge/);
				rx.push(/n-ge/);
				n.point = "V-는 게";
				n.des="Shortened form of -는 것이, '-ing', turns a verb into a noun clause";
			break;
			case 305:
				rx.push(/n geol/);
				rx.push(/n-geol/);
				n.point = "V-는 걸";
				n.des="Shortened form of -는 것을, '-ing', turns a verb into a noun clause";
			break;
			case 306:
				rx.push(/n geo/);
				rx.push(/n-geo/);
				n.point = "V-는 거";
				n.des="Shortened form of -는 것, -는 것이, or -는 것을, '-ing', turns a verb into a noun clause";
			break;
			case 307:
				rx.push(/(?<!myeon-)seo/);
				n.point = "N서";
				n.des="Shortened form of 에서, particle denoting location, 'from...'";
			break;
			case 308:
				rx.push(/ga-bo/);
				rx.push(/ga bo/);
				n.point = "-(으)ㄴ/는가 보다, -(으)ㄴ/는가보다";
				n.des="'Seems that', 'looks like', expresses a guess";
			break;
			case 309:
				rx.push(/na bo/);
				rx.push(/na-bo/);
				n.point = "-나 보다, -나보다";
				n.des="Shortened form of -(으)ㄴ/는가 보다, 'seems that', 'looks like', expresses a guess";
			break;
			case 310:
				rx.push(/tto-neun/);
				n.point = "또는";
				n.des="'or'";
			break;
			case 311:
				rx.push(/e-neun/);
				n.point = "N에는";
				n.des="Declaritive form";
			break;
			case 312:
				rx.push(/-da /);
				n.point = "V-ㄴ/는다, A-다";
				n.des="Declaritive form";
			break;
			case 313:
				rx.push(/tta-la/);
				n.point = "따라서";
				n.des="Therefore";
			break;
			case 314:
				rx.push(/geo-/);
				rx.push(/geo /);
				n.point = "거";
				n.des="'Thing', shortened form of 것, 것이, or 것을";
			break;
			case 315:
				rx.push(/geol/);
				n.point = "걸";
				n.des="'Thing', shortened form of 것을";
			break;
			case 316:
				rx.push(/ge-/);
				rx.push(/ge /);
				n.point = "게";
				n.des="'Thing', shortened form of 것이";
			break;
			case 317:
				rx.push(/-dan-da/);
				rx.push(/-lan-da/);
				n.point = "-단다, -란다";
				n.des="Quotation usually used in story-telling for kids";
			break;
			case 318:
				rx.push(/-la-neun/);
				n.point = "-(이)라는";
				n.des="Direct or indirect quotation， shortened form of -(이)라고 하는";
			break;
			case 319:
				rx.push(/-da-neun/);
				n.point = "-(이)다는";
				n.des="Indirect quotation， shortened form of -(이)다고 하는";
			break;
			case 320:
				rx.push(/-ja-neun/);
				n.point = "-(이)자는";
				n.des="Indirect quotation， shortened form of -(이)자고 하는";
			break;
			case 321:
				rx.push(/-nya-neun/);
				n.point = "-(이)냐는";
				n.des="Indirect quotation， shortened form of -(이)냐고 하는";
			break;
			case 322:
				rx.push(/-seong/);
				n.point = "-성";
				n.des="'性', used with certain Sino-Korean words to indicate something's property or essense";
			break;
			case 323:
				rx.push(/mueol/);
				n.point = "뭘";
				n.des="'What', shortened form of 무엇을";
			break;
			case 324:
				rx.push(/mueo-/);
				rx.push(/mueo /);
				n.point = "뭐";
				n.des="'What', shortened form of 무엇";
			break;
			case 325:
				rx.push(/eo-ttae/);
				n.point = "어때";
				n.des="'How is...', shortened form of 어떻다 or 어떻게";
			break;
			case 326:
				rx.push(/geul-go/);
				rx.push(/geul-gu/);
				n.point = "글고";
				n.des="'And', shortened form of 그리고";
			break;
			case 327:
				rx.push(/cheom/);
				n.point = "첨";
				n.des="'First', shortened form of 처음";
			break;
			case 328:
				rx.push(/il-yol/);
				n.point = "일욜";
				n.des="'Sunday', shortened form of 일요일";
			break;
			case 329:
				rx.push(/nael/);
				n.point = "낼";
				n.des="'Tomorrow', shortened form of 내일";
			break;
			case 330:
				rx.push(/gyang/);
				n.point = "걍";
				n.des="'Just', shortened form of 그냥";
			break;
			case 331:
				rx.push(/al-sseo/);
				n.point = "알써";
				n.des="'(I) Know', shortened form of 알았어";
			break;
			case 332:
				rx.push(/mol-gess-/);
				rx.push(/mol-gess /);
				n.point = "몰겠어";
				n.des="'(I) don't know', shortened form of 모르겠어";
			break;
			case 333:
				rx.push(/neom/);
				n.point = "넘";
				n.des="'Very', shortened form of 너무";
			break;
			case 334:
				rx.push(/jim/);
				n.point = "짐";
				n.des="'Now', shortened form of 지금";
			break;
			case 335:
				rx.push(/si-/);
				rx.push(/syeo/);
				rx.push(/se-/);
				rx.push(/si /);
				rx.push(/se /);
				n.point = "-(으)시-/(으)셔-/(으)세-";
				n.des="Honorific";
			break;
			case 336:
				rx.push(/ya-gess/);
				n.point = "A/V-아/어야겠다";
				n.des="'Had better', '(I) guess (I) have to'";
			break;
			case 337:
				rx.push(/(?<!ss-)a-y/);
				rx.push(/(?<!ss-)o-y/);
				rx.push(/(?<!ss-)e-y/);
				rx.push(/(?<!ss-)ab-/);
				rx.push(/(?<!ss-)ob-/);
				rx.push(/(?<!ss-)eb-/);
				rx.push(/(?<!ss-)a /); 
				rx.push(/(?<!ss-)o /);
				rx.push(/(?<!ss-)e /);
				n.point = "V-아/어";
				n.des="Present tense";
			break;
			case 338:
				rx.push(/-kki-li/);
				n.point = "-끼리";
				n.des="'Among', 'between'";
			break;
			case 339:
				rx.push(/-ssig/);
				n.point = "-씩";
				n.des="'Apiece', 'per'";
			break;
			case 340:
				rx.push(/-na /);
				n.point = "N(이)나";
				n.des="Particle denoting 'no less than'";
			break;
			case 341:
				rx.push(/geu-leoh-ge/);
				rx.push(/geu-leoh-ge/);
				n.point = "그렇게";
				n.des="'So', 'that'";
			break;
			case 342:
				rx.push(/-ji-la /);
				rx.push(/-ji-la-/);
				n.point = "A/V-은/는지라";
				n.des="'Because'";
			break;
			case 343:
				rx.push(/geon/);
				n.point = "건";
				n.des="Shortened form of '것은'";
			break;
			case 344:
				rx.push(/-nya-/);
				rx.push(/-nya /);
				n.point = "A/V-느냐?, A/V-(으)냐?";
				n.des="Formal non-polite - inquisitive";
			break;
			case 345:
				rx.push(/-gu-man/);
				n.point = "A/V-구만";
				n.des="Expresses surprise at a realisation";
			break;
			case 346:
				rx.push(/-ha-go-neun/);
				rx.push(/-ha-gu-neun/);
				n.point = "하고는";
				n.des="Indicates something that is displeasing and deserves to be criticized";
			break;
			case 347:
				rx.push(/a-mu-li/);
				n.point = "아무리";
				n.des="'However'";
			break;
			case 348:
				rx.push(/-myeo /);
				rx.push(/-myeo-/);
				n.point = "V-(으)며";
				n.des="'While'";
			break;
			case 349:
				rx.push(/-lop/);
				n.point = "N롭다";
				n.des="Turns a noun into an adjective";
			break;
			case 350:
				rx.push(/-ppun/);
				n.point = "N뿐, A/V-뿐";
				n.des="'Only', 'just'";
			break;
			case 351:
				rx.push(/-kkeos/);
				n.point = "-껏";
				n.des="'To the full extent of'";
			break;
			case 352:
				rx.push(/(?<!eom-)ma /);
				n.point = "V-(으)마";
				n.des="	'Will (do)', indicates intention or a promise, typically spoken from an older person to somebody younger";
			break;
			case 353:
				rx.push(/han-te-seo/);
				n.point = "한테서";
				n.des="'From (someone)'";
			break;
			case 354:
				rx.push(/mich/);
				n.point = "N 및 N";
				n.des="'And'";
			break;
			case 355:
				rx.push(/mueon-ga/);
				n.point = "뭔가";
				n.des="'Something'";
			break;
			case 356:
				rx.push(/-byeol/);
				n.point = "-별";
				n.des="Denotes a class of something, 'classified by'";
			break;
			case 357:
				rx.push(/-gi-do/);
				rx.push(/-gi-du/);
				n.point = "V-기도 하다";
				n.des="'As well as'";
			break;
			case 358:
				rx.push(/-la-seo/);
				n.point = "N(이)라서";
				n.des="'Therefore', 'because of'";
			break;
			case 359:
				rx.push(/-deul-/);
				rx.push(/-deul /);
				n.point = "N들";
				n.des="Turns certain nouns into plural form";
			break;
			case 360:
				rx.push(/geo-na /);
				rx.push(/geo-na-/);
				n.point = "거나";
				n.des="'Anything'";
			break;
			case 361:
				rx.push(/de-na /);
				rx.push(/de-na-/);
				n.point = "데나";
				n.des="'Anywhere'";
			break;
			case 362:
				rx.push(/ttae-na /);
				rx.push(/ttae-na-/);
				n.point = "때나";
				n.des="'Anytime'";
			break;
			case 363:
				rx.push(/geu-chi/);
				n.point = "그치";
				n.des="'Isn't it?', shortened form of 그렇지";
			break;
			case 364:
				rx.push(/geu-chyo/);
				n.point = "그쵸";
				n.des="'Isn't it?', shortened form of 그렇죠";
			break;
			case 365:
				rx.push(/nu-gun-ga /);
				rx.push(/nu-gun-ga-/);
				n.point = "누군가";
				n.des="'Somebody', 누구 + ㄴ가";
			break;
			case 366:
				rx.push(/mueon-ga /);
				rx.push(/mueon-ga-/);
				n.point = "뭔가";
				n.des="'Something', 뭐 + ㄴ가";
			break;
			case 367:
				rx.push(/eo-din-ga /);
				rx.push(/eo-din-ga-/);
				n.point = "어딘가";
				n.des="'Somewhere', 어디 + ㄴ가";
			break;
			case 368:
				rx.push(/eon-jen-ga /);
				rx.push(/eon-jen-ga-/);
				n.point = "언젠가";
				n.des="'Sometime', 언제 + ㄴ가";
			break;
			case 369:
				rx.push(/gess-ji /);
				rx.push(/gess-ji-/);
				n.point = "-겠지?";
				n.des="'It must be, right?' ";
			break;
			case 370:
				rx.push(/da-go-/);
				rx.push(/da-go /);
				n.point = "A/V-(ㄴ/는)다고 (해서/해도)";
				n.des="'Even if...'";
			break;
			case 371:
				rx.push(/la-go-/);
				rx.push(/la-go /);
				n.point = "N-(이)라고 (해서/해도)";
				n.des="'Even if somebody is...'";
			break;
			case 372:
				rx.push(/(?<!si|yeo-leu|ma-eu|i-leu)m-(?!ma)/);
				rx.push(/(?<!si|yeo-leu|ma-eu|i-leu)m /);
				n.point = "A/V-ㅁ/음";
				n.des="Noun form of a verb or adjective";
			break;
			case 373:
				rx.push(/seu-leo/);
				n.point = "N스럽다";
				n.des="Changes certain nouns into adjectives";
			break;
			case 374:
				rx.push(/na /);
				rx.push(/na-/);
				n.point = "A/V-나(요)";
				n.des="Expresses wonder or surprise";
			break;
			case 375:
				rx.push(/la /);
				rx.push(/la-/);
				n.point = "A/V-아/어라";
				n.des="Expresses a exclamation";
			break;
			case 376:
				rx.push(/la /);
				rx.push(/la-/);
				n.point = "N(이)라";
				n.des="Shortened form of N(이)라서, 'therefore', 'because of'";
			break;
			case 377:
				rx.push(/ban-deu-si/);
				n.point = "반드시";
				n.des="'Surely'";
			break;
			case 378:
				rx.push(/ge-da-ga/);
				n.point = "게다가";
				n.des="'Besides', 'furthermore'";
			break;
			case 379:
				rx.push(/da-ueo/);
				rx.push(/dab/);
				n.point = "N답다";
				n.des="'Be like', 'be worthy of'";
			break;
			case 380:
				rx.push(/deo-gu-na/);
				n.point = "A/V-더구나";
				n.des="Used to notify someone of a fact that one learned anew from a personal experience";
			break;
			case 381:
				rx.push(/deu-lil/);
				n.point = "A/V-아/어 드릴(까)";
				n.des="'Shall I...?'";
			break;
			case 382:
				rx.push(/(?<!g|b|l|s|-o| o)s-/);
				rx.push(/(?<!g|b|l|s|-o| o)s /);
				n.point = "-ㅅ";
				n.des="In a compound word made up of two individual words, -ㅅ is added to the first word if that word ends in a batchim";
			break;
			case 383:
				rx.push(/noh /);
				rx.push(/noh-/);
				n.point = "A/V-아/어 놓다";
				n.des="Indicates that one completes an action and leaves it in that state";
			break;
			case 384:
				rx.push(/n-geol/);
				n.point = "A/V-ㄴ걸(요)";
				n.des="Shows protestation or regret";
			break;
			case 385:
				rx.push(/su-ga /);
				n.point = "V-(으)ㄹ 수가 있다/없다";
				n.des="'Can', emphasises the verb more than in the V-(으)ㄹ 수 있다/없다 grammar pattern";
			break;
			case 386:
				rx.push(/seon /);
				rx.push(/seon-/);
				n.point = "-선";
				n.des="Shortened form of -서는";
			break;
			case 387:
				rx.push(/lyeom /);
				rx.push(/lyeom-/);
				rx.push(/lyeo-mu /);
				rx.push(/lyeo-mu-/);
				n.point = "A/V-(으)렴, A/V-(으)려무나";
				n.des="Imperative, typically spoken from an adult to a child";
			break;
			case 388:
				rx.push(/goaen-hi/);
				n.point = "괜히";
				n.des="'In vain'";
			break;
			case 389:
				rx.push(/eol-ma-/);
				rx.push(/eol-ma /);
				n.point = "얼마나";
				n.des="'How much/many'";
			break;
			case 390:
				rx.push(/li-/);
				rx.push(/li /);
				n.point = "-리";
				n.des="'Way', common combinations include '이리', '그리', '저리' ('in this way/ like this', 'in that way/ like that') ";
			break;
			case 391:
				rx.push(/syeo-/);
				rx.push(/syeo /);
				n.point = "N(이)셔";
				n.des="Honorific sentence ender for somebody's name, shortened form of N(이)시어)";
			break;
			case 392:
				rx.push(/noass/);
				n.point = "놨";
				n.des="Shortened past-tense form of 놓다";
			break;
			case 393:
				rx.push(/nae-ge /);
				rx.push(/nae-ge-/);
				n.point = "내게";
				n.des="Shortened form of 나에게, 'to me'";
			break;
			case 394:
				rx.push(/jil /);
				rx.push(/jil-/);
				n.point = "-질";
				n.des="(The act of) doing";
			break;
			case 395:
				rx.push(/n-da-myeon /);
				rx.push(/la-myeon /);
				rx.push(/n-da-myeon-/);
				rx.push(/la-myeon-/);
				n.point = "V-ㄴ/는다면, V-(이)라면";
				n.des="'If V happens, then...'";
			break;

			
			
			
			
		
		
			
			
			default: console.log("index out of bounds");
			
		}
		n.regex=rx;
		grammarPoints.push(n);
	}
}

function GrammarLookup(word)
{
	//TODO also check the hangul for certain words that often give false positives, e.g. -에
	//var wordHangul = word.replace(replaceCharacters," ");
	//wordHangul = wordHangul.trim();
	//wordHangul = " "+wordHangul+" ";

	if(openedTab!="GrammarTab")
	{
		return;
	}
	var w = word.replace(replaceCharacters," ");
	w=w.trim();
	w=" "+w+" ";
	var wordRomanised = RomaniseTextWithSeperators(w);
	
	var tt = $('#grammarDataTable1').DataTable();
	tt.clear();
	
	console.log(wordRomanised);
	
	for(var i=0;i<grammarPoints.length;i++)
	{	for(var j=0;j<grammarPoints[i].regex.length;j++)
		{
			
			var regex = RegExp(grammarPoints[i].regex[j]);
			var result = regex.test(wordRomanised);
			
			if(result)
			{
				//console.log('MATCHED '+grammarPoints[i].regex[j]);
					
				tt.row.add( [
					grammarPoints[i].num,grammarPoints[i].point,grammarPoints[i].des
				] );
				break;
			}
		}
	}
	
	/*
	for(var i=0;i<grammarPointsHangul.length;i++)
	{	for(var j=0;j<grammarPointsHangul[i].regex.length;j++)
		{
			//console.log("conparing: "+wordHangul+" and "+grammarPointsHangul[i].regex[j]);
			var regex = RegExp(grammarPointsHangul[i].regex[j]);
			var result = regex.test(wordHangul);
			
			if(result)
			{
				//console.log('MATCHED '+grammarPointsHangul[i].regex[j]);
					//TODO make sure not already added earlier
				tt.row.add( [
					grammarPointsHangul[i].num,grammarPointsHangul[i].point,grammarPointsHangul[i].des
				] );
				break;
			}
		}
	}
	*/
	tt.draw();
	
}

function ChangeChart()
{
	var chartDropDown = document.getElementById("chartOption");
	chartFilter=chartDropDown.value;
	SwapChart();
}

function SwapChart()
{
	if(myChart)
	{
		myChart.destroy();
	}
	if(myChart3)
	{
		myChart3.destroy();
	}
	
	var  myChart = document.getElementById("myChart");
	var  myChart3 = document.getElementById("myChart3");
	myChart.style.display = "none";
	myChart3.style.display = "none";

	switch(chartFilter)
			{
				case "chart1": 
				myChart.style.display = "block";
				CreateGraph(allArray,knownArray); break;
				case "chart3":
				var hskKnownArray = [];
				for(var i=0;i<allArray.length;i++)
				{
					//console.log("<"+allArray[i].topik+">");
					if(allArray[i].topik!="")
					{
						hskKnownArray.push(allArray[i]);
					}
				}
				myChart3.style.display = "block";
				CreateGraph3(allArray,hskKnownArray); break;
			}
}



function toggleSignIn() {
      if (firebase.auth().currentUser) {
        // [START signout]
		handleSignOut();
        //firebase.auth().signOut();
		ShowSigninElements(true);
        // [END signout]
      } else {
        var email = document.getElementById('email').value;
        var password = document.getElementById('password').value;
        if (email.length < 4) {
          alert('Please enter an email address.');
          return;
        }
        if (password.length < 4) {
          alert('Please enter a password.');
          return;
        }
        // Sign in with email and pass.
        // [START authwithemail]
        firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
          // Handle Errors here.
          var errorCode = error.code;
          var errorMessage = error.message;
          // [START_EXCLUDE]
          if (errorCode === 'auth/wrong-password') {
            alert('Wrong password.');
          } else {
            alert(errorMessage);
          }
          console.log(error);
          document.getElementById('quickstart-sign-in').disabled = false;
          // [END_EXCLUDE]
        });
        // [END authwithemail]
		ShowSigninElements(false);
      }
    }

    /**
     * Handles the sign up button press.
     */
    function handleSignUp() {
      var email = document.getElementById('email').value;
      var password = document.getElementById('password').value;
      if (email.length < 4) {
        alert('Please enter an email address.');
        return;
      }
      if (password.length < 4) {
        alert('Please enter a password.');
        return;
      }
      // Create user with email and pass.
      // [START createwithemail]
      firebase.auth().createUserWithEmailAndPassword(email, password).catch(function(error) {
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        // [START_EXCLUDE]
        if (errorCode == 'auth/weak-password') {
          alert('The password is too weak.');
        } else {
          alert(errorMessage);
        }
        console.log(error);
        // [END_EXCLUDE]
      });
	  
	  sendEmailVerification();
      // [END createwithemail]
    }

    /**
     * Sends an email verification to the user.
     */
    function sendEmailVerification() {
      // [START sendemailverification]
      firebase.auth().currentUser.sendEmailVerification().then(function() {
        // Email Verification sent!
        // [START_EXCLUDE]
        alert('Email Verification Sent!');
        // [END_EXCLUDE]
      });
      // [END sendemailverification]
    }

    function sendPasswordReset() {
      var email = document.getElementById('email').value;
      // [START sendpasswordemail]
      firebase.auth().sendPasswordResetEmail(email).then(function() {
        // Password Reset Email Sent!
        // [START_EXCLUDE]
        alert('Password Reset Email Sent!');
        // [END_EXCLUDE]
      }).catch(function(error) {
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        // [START_EXCLUDE]
        if (errorCode == 'auth/invalid-email') {
          alert(errorMessage);
        } else if (errorCode == 'auth/user-not-found') {
          alert(errorMessage);
        }
        console.log(error);
        // [END_EXCLUDE]
      });
      // [END sendpasswordemail];
    }
	
			 // [START googlecallback]
    function onSignIn(googleUser) {
      console.log('Google Auth Response', googleUser);
      // We need to register an Observer on Firebase Auth to make sure auth is initialized.
      var unsubscribe = firebase.auth().onAuthStateChanged(function(firebaseUser) {
		ShowSigninElements(false);
        unsubscribe();
        // Check if we are already signed-in Firebase with the correct user.
        if (!isUserEqual(googleUser, firebaseUser)) {
          // Build Firebase credential with the Google ID token.
          // [START googlecredential]
          var credential = firebase.auth.GoogleAuthProvider.credential(
              googleUser.getAuthResponse().id_token);
          // [END googlecredential]
          // Sign in with credential from the Google user.
          // [START authwithcred]
          firebase.auth().signInWithCredential(credential).catch(function(error) {
            // Handle Errors here.
            var errorCode = error.code;
            var errorMessage = error.message;
            // The email of the user's account used.
            var email = error.email;
            // The firebase.auth.AuthCredential type that was used.
            var credential = error.credential;
            // [START_EXCLUDE]
            if (errorCode === 'auth/account-exists-with-different-credential') {
              alert('You have already signed up with a different auth provider for that email.');
              // If you are using multiple auth providers on your app you should handle linking
              // the user's accounts here.
            } else {
              console.error(error);
            }
            // [END_EXCLUDE]
          });
		  
			ShowSigninElements(false);
			
          // [END authwithcred]
        } else {
          console.log('User already signed-in Firebase.');
        }
      });
    }
    // [END googlecallback]

    /**
     * Check that the given Google user is equals to the given Firebase user.
     */
    // [START checksameuser]
    function isUserEqual(googleUser, firebaseUser) {
      if (firebaseUser) {
        var providerData = firebaseUser.providerData;
        for (var i = 0; i < providerData.length; i++) {
          if (providerData[i].providerId === firebase.auth.GoogleAuthProvider.PROVIDER_ID &&
              providerData[i].uid === googleUser.getBasicProfile().getId()) {
            // We don't need to reauth the Firebase connection.
            return true;
          }
        }
      }
      return false;
    }
    // [END checksameuser]

    /**
     * Handle the sign out button press.
     */
    function handleSignOut() {
      var googleAuth = gapi.auth2.getAuthInstance();
      googleAuth.signOut().then(function() {
        firebase.auth().signOut();
		ShowSigninElements(true);
      });
    }
			
function CalculateVocabularyAndCreateDocument(collection,_type,lang,uid,docid)
{
			var arrLearning = [];
			var arrKnown = [];
			var arrUnknown = [];
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.getAll();
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
	        request.onsuccess = function(event) {  
	          if(request.result) {
			  		var req = request.result;
					for(var i=0;i<req.length;i++)
					{
						var w = req[i].word;
						var a = req[i].appearances;
						
						if(!w.includes("$"))
						{
							var remainder = a%3;
							
							if(remainder==0)
								{
								arrUnknown.push(w);
							}
							else if(remainder==1)
								{
								arrLearning.push(w);
							}
							else if(remainder==2)
							{
								arrKnown.push(w);
							}
						}
				  }
			  }
			  
				if(docid=="false")
				{
					switch(_type)
					{
						case "unknown":CreateDocument(collection,_type,lang,uid,arrUnknown); break;
						case "learning":CreateDocument(collection,_type,lang,uid,arrLearning); break;
						case "known":CreateDocument(collection,_type,lang,uid,arrKnown); break;
					}
				}
				else
				{	switch(_type)
					{
						case "unknown":UpdateDocument(collection,_type,lang,uid,arrUnknown,docid); break;
						case "learning":UpdateDocument(collection,_type,lang,uid,arrLearning,docid); break;
						case "known":UpdateDocument(collection,_type,lang,uid,arrKnown,docid); break;
					}
				}
			  
			  };
}

function UpdateDocument(collection,_type,lang,uid,w,docid)
{
	dbfire.collection(collection).doc(docid).update({
		words: w
	})
	.then(function() {
		console.log("Document successfully Updated!");
	})
	.catch(function(error) {
		console.error("Error updating document: ", error);
	});
}

function LogUser(user)
{
	dbfire.collection("users").doc(user.uid).set({
		name: user.displayName,
		email: user.email,
		verified: user.emailVerified,
		author_uid: user.uid
	})
	.then(function() {
		console.log("User logged in");
	})
	.catch(function(error) {
		console.error("Error writing document: ", error);
	});
}


function CreateDocument(collection,_type,lang,uid,w)
{
	dbfire.collection(collection).add({
		words: w,
		language: lang,
		type: _type,
		author_uid: uid
	})
	.then(function() {
		console.log("Document successfully written!");
	})
	.catch(function(error) {
		console.error("Error writing document: ", error);
	});
		switch(_type)
		{
			case "unknown": unknownFireDBDocumentLoaded=true; break;
			case "learning": learningFireDBDocumentLoaded=true; break;
			case "known": knownFireDBDocumentLoaded=true; break;
		} 
}

function ImportVocabularyFromFireDB(words,s)
{
	if(words.length>0)
	{
		var state = 0;
		switch(s)
		{
			case "unknown": state = 0;break;
			case "learning": state = 1;break;
			case "known": state = 2; break;
		}
		
				switch(s)
		{
			case "unknown": unknownFireDBDocumentLoaded=true; break;
			case "learning": learningFireDBDocumentLoaded=true; break;
			case "known": knownFireDBDocumentLoaded=true; break;
		}
		
		QuickImport(words,state);

		//if(unknownFireDBDocumentLoaded&&learningFireDBDocumentLoaded&&knownFireDBDocumentLoaded)
		//{
		//	OnInput();
		//}
	}
}

function SaveFireDB()
{
	if(unknownFireDBDocumentLoaded==false||learningFireDBDocumentLoaded==false||knownFireDBDocumentLoaded==false)
	{
		return;
	}
	
	var user = firebase.auth().currentUser;
	var lang = "korean";
	if(user)
	{
		console.log("Saving fireDB");
		dbfire.collection("vocabulary").where("author_uid", "==", user.uid).where("type", "==", "known").where("language", "==", lang)
	.get()
	.then(function(querySnapshot) {
        querySnapshot.forEach(function(doc) {
            //console.log(doc.id, " => ", doc.data());
			//console.log(doc.id, " => ", doc.data().words);
			CalculateVocabularyAndCreateDocument("vocabulary","known",lang,user.uid,doc.id);
			
        });
		if(querySnapshot.empty)
		{
			CalculateVocabularyAndCreateDocument("vocabulary","known",lang,user.uid,"false");
		}
		})
		.catch(function(error) {
			console.log("Error getting documents: ", error);
		});
		
		
			dbfire.collection("vocabulary").where("author_uid", "==", user.uid).where("type", "==", "learning").where("language", "==", lang)
		.get()
		.then(function(querySnapshot) {
			querySnapshot.forEach(function(doc) {
				//console.log(doc.id, " => ", doc.data());
				//console.log(doc.id, " => ", doc.data().words);
				CalculateVocabularyAndCreateDocument("vocabulary","learning",lang,user.uid,doc.id);
			});
			if(querySnapshot.empty)
			{
				CalculateVocabularyAndCreateDocument("vocabulary","learning",lang,user.uid,"false");
			}
		})
		.catch(function(error) {
			console.log("Error getting documents: ", error);
		});
		
		
				dbfire.collection("vocabulary").where("author_uid", "==", user.uid).where("type", "==", "unknown").where("language", "==", lang)
		.get()
		.then(function(querySnapshot) {
			querySnapshot.forEach(function(doc) {
				//console.log(doc.id, " => ", doc.data());
				//console.log(doc.id, " => ", doc.data().words);
				CalculateVocabularyAndCreateDocument("vocabulary","unknown",lang,user.uid,doc.id);
			});
			if(querySnapshot.empty)
			{
				CalculateVocabularyAndCreateDocument("vocabulary","unknown",lang,user.uid,"false");
			}
		})
		.catch(function(error) {
			console.log("Error getting documents: ", error);
		});
	}
}

function LoadAccountData(uid)
{
	var user = firebase.auth().currentUser;
	var lang = "korean";
	
	if(user)
	{
		LogUser(user);
	
		ShowSigninElements(false);
		dbfire.collection("vocabulary").where("author_uid", "==", user.uid).where("type", "==", "known").where("language", "==", lang)
		.get()
		.then(function(querySnapshot) {
			querySnapshot.forEach(function(doc) {
				//console.log(doc.id, " => ", doc.data());
				//console.log(doc.id, " => ", doc.data().words);
				ImportVocabularyFromFireDB(doc.data().words,"known");
				
			});
			if(querySnapshot.empty)
			{
				CalculateVocabularyAndCreateDocument("vocabulary","known",lang,user.uid,"false");
			}
		})
		.catch(function(error) {
			console.log("Error getting documents: ", error);
		});
		
		
			dbfire.collection("vocabulary").where("author_uid", "==", user.uid).where("type", "==", "learning").where("language", "==", lang)
		.get()
		.then(function(querySnapshot) {
			querySnapshot.forEach(function(doc) {
				//console.log(doc.id, " => ", doc.data());
				//console.log(doc.id, " => ", doc.data().words);
				ImportVocabularyFromFireDB(doc.data().words,"learning");
			});
			if(querySnapshot.empty)
			{
				CalculateVocabularyAndCreateDocument("vocabulary","learning",lang,user.uid,"false");
			}
		})
		.catch(function(error) {
			console.log("Error getting documents: ", error);
		});
		
		
				dbfire.collection("vocabulary").where("author_uid", "==", user.uid).where("type", "==", "unknown").where("language", "==", lang)
		.get()
		.then(function(querySnapshot) {
			querySnapshot.forEach(function(doc) {
				//console.log(doc.id, " => ", doc.data());
				//console.log(doc.id, " => ", doc.data().words);
				ImportVocabularyFromFireDB(doc.data().words,"unknown");
			});
			if(querySnapshot.empty)
			{
				CalculateVocabularyAndCreateDocument("vocabulary","unknown",lang,user.uid,"false");
			}
		})
		.catch(function(error) {
			console.log("Error getting documents: ", error);
		});
	}
}

function ShowSigninElements(show)
{
	if(show)
	{
				document.getElementById("email").style.display = 'block';
		document.getElementById("password").style.display = 'block';
		document.getElementById("quickstart-sign-up").style.display = 'block';
		document.getElementById("quickstart-password-reset").style.display = 'block';
		document.getElementById("fireSigninText").style.display = 'block';
		document.getElementById("googleSignin").style.display = 'block';
		document.getElementById("googleSigninText").style.display = 'block';
		document.getElementById("LoginTabButton").innerHTML='<b>Login</b>';		
	}
	else
	{
		document.getElementById("email").style.display = 'none'; 
		document.getElementById("password").style.display = 'none'; 
		document.getElementById("quickstart-sign-up").style.display = 'none'; 
		document.getElementById("quickstart-password-reset").style.display = 'none'; 
		document.getElementById("fireSigninText").style.display = 'none'; 
		document.getElementById("googleSignin").style.display = 'none'; 
		document.getElementById("googleSigninText").style.display = 'none';

		document.getElementById("LoginTabButton").innerHTML='<b>Logged-in</b>';
	}
}

function QuickImport(words,state)
{
	var arrLearning = [];
			var arrKnown = [];
			var arrUnknown = [];
			var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.getAll();
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
	        request.onsuccess = function(event) {  
	          if(request.result) {
			  		var req = request.result;
					for(var i=0;i<req.length;i++)
					{
						var w = req[i].word;
						var a = req[i].appearances;
						
						if(!w.includes("$"))
						{
							var remainder = a%3;
							
							if(remainder==0)
								{
								arrUnknown.push(w);
								
						
							}
							else if(remainder==1)
								{
								arrLearning.push(w);

							}
							else if(remainder==2)
							{
								arrKnown.push(w);
	
							}
						}
				  }
			  }
	
				var arr;
				switch(state)
				{
					case 0:  arr=arrUnknown; break;
					case 1:  arr=arrLearning; break;
					case 2:  arr=arrKnown; break;
					default: console.log("state out of range");
				}
				for(var j=0;j<words.length;j++)
					{
						if(!arr.includes(words[j]))
						{
							UpdateOrAddDBRow(words[j],state);
						}
							
					}
					if(unknownFireDBDocumentLoaded&&knownFireDBDocumentLoaded&&learningFireDBDocumentLoaded)
					{
						OnInput();
					}
			}
}

function OpenGoogleImages()
{
	window.open("https://www.google.com/search?q="+pendingLookup+"&sxsrf=ALeKk01CGhV9YShWwU3Knh1qjMdDQcYXHQ:1602295138342&source=lnms&tbm=isch&sa=X&ved=2ahUKEwiS_K7E9qjsAhXhlEsFHS36BooQ_AUoAXoECA8QAw&cshid=1602295160675088&biw=1920&bih=937");
}

function OpenYahooImages()
{
	window.open("https://images.search.yahoo.com/search/images;_ylt=Awr9Fqy0F4FfPGgAKy6LuLkF;_ylc=X1MDOTYwNTc0ODMEX3IDMgRmcgMEZ3ByaWQDYk0xRDBROWVTVUtJNnhpTllYaHIwQQRuX3N1Z2cDMTAEb3JpZ2luA2ltYWdlcy5zZWFyY2gueWFob28uY29tBHBvcwMwBHBxc3RyAwRwcXN0cmwDBHFzdHJsAzcEcXVlcnkDcG9rZW1vbgR0X3N0bXADMTYwMjI5NTc0Mw--?fr2=sb-top-images.search&p="+pendingLookup+"&ei=UTF-8&iscqry=&fr=sfp");
}

function OpenGoogleTranslate()
{
	window.open("https://translate.google.com/#view=home&op=translate&sl=ko&tl=en&text="+pendingLookup);
}

function OpenPapagoTranslate()
{
	window.open("https://papago.naver.com/?sk=auto&tk=ko&st="+pendingLookup);
}

function CreateSentences()
{
	var t = $('#sentencesDataTable').DataTable();
	t.clear();
	var oldHTML = pasteArea.innerText;
	var replace = /[\n\.\!\?\。\！\?]/g;
	var split = oldHTML.replace(replace,'<br>');
	var count=1;
	var sentenceUnknownWords = [];
	var sentenceLearningWords = [];
	var optionsPrimary = {
						"accuracy": {
							"value": "exactly",
							"limiters": limiters
						}, "className": 'primary'
					};
					
	var optionsSecondary = {
						"accuracy": {
							"value": "exactly",
							"limiters": limiters
						}, "className": 'secondary'
					};				
	
	split = split.split('<br>');
	for(var i=0;i<split.length;i++)
	{
		var wordsplit = split[i].replace(replaceCharacters," ");
		wordsplit=wordsplit.trim();
		if(wordsplit.length>0)
		{
			var wordsInSentence = 0;
			var difficulty = 0;
			wordsplit = wordsplit.split(' ');
			for(var j=0;j<wordsplit.length;j++)
			{
				wordsplit[j]=wordsplit[j].trim();
				if(wordsplit[j].length>0)
				{
					var found = knownArray.findIndex(w => w.word === wordsplit[j]);
					if(found == -1)
					{
						difficulty++;
					}
					
					wordsInSentence++;
				}
			}
			var ratio=(Math.round((difficulty/wordsInSentence)* 100)/100).toFixed(2);
			
			var text = split[i];
			
			if(hideKnownSentences && difficulty==0)
			{
			
			}
			else
			{
				t.row.add( [
					count,text,wordsInSentence,difficulty,ratio
				] );
				
				count++;
			}
		}
	}
	t.draw();
}

function toggleHideKnownSentences()
{
	if(document.getElementById("hideKnownSentences").checked)
			{
				hideKnownSentences=true;
			
				var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("hideKnownSentences$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
						request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "hideKnownSentences$",appearances: 1});
						HideKnownSentences();
					}
					else
					{
						addwordtodb("hideKnownSentences$",1);
						HideKnownSentences();
					}
					
				}
	
						
			}
			else
			{
				hideKnownSentences=false;
				
				var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("hideKnownSentences$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
						request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "hideKnownSentences$",appearances: 0});
						HideKnownSentences();
					}
					else
					{
						addwordtodb("hideKnownSentences$",0);
						HideKnownSentences();
					}
					
				}
				
			}
			
}

function InitialiseHideKnownSentences()
{
	var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.get("hideKnownSentences$");
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
	        request.onsuccess = function(event) {          
	          if(request.result) {
					var a = request.result.appearances;
					if(a==0)
					{
						hideKnownSentences=false;
						document.getElementById("hideKnownSentences").checked = false;
					}
					else
					{
						hideKnownSentences=true;
						document.getElementById("hideKnownSentences").checked = true;
					}
			}
					else
					{
						if(hideKnownSentences)
						{
							
							addwordtodb("hideKnownSentences$",1);
							document.getElementById("hideKnownSentences").checked = true;
						}
						else
						{
							
							addwordtodb("hideKnownSentences$",0);
							document.getElementById("hideKnownSentences").checked = false;
						}
						
					}
					
			};
		
}

function HideKnownSentences()
{
	CalculateStatistics();
}

function SavePageLocation(pageTop)
{
				var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
				var request = objectStore.get("pageLocation$");
				request.onerror = function(event) {
				  alert("Unable to retrieve data from database!");
				};
				request.onsuccess = function(event) {          
					if(request.result) {
						request = db.transaction(["wordsdb"], "readwrite").objectStore("wordsdb").put({ word: "pageLocation$",appearances: pageTop});
					}
					else
					{
						addwordtodb("pageLocation$",pageTop);
					}
					
				}
}

function JumpToSavedPageLocation()
{
	var objectStore = db.transaction(["wordsdb"]).objectStore("wordsdb");
	        var request = objectStore.get("pageLocation$");
	        request.onerror = function(event) {
	          alert("Unable to retrieve data from database!");
	        };
	        request.onsuccess = function(event) {
						
				if(request.result)
				{
					var a = request.result.appearances;	
						setTimeout(function() {
							scrollTo({
								top: a,
								behavior: 'auto'
							});
						}, 500);
					
				}		
			};
}

function SetUILanguage(lang) //TODO
{
	
}



	</script>
</head>

<body onload="BrowserCheck()" id="body" onscroll="onScroll()">
	<div class="wrapper">
		<div class="box content" id="content">
			<div class="editCell " contentEditable="false" data-text="Paste text here" id="pasteArea" type="text" oninput="OnInput()">
			</div>


			</div>
		
		
		<div class="box sidebar2 topright" id="sidebar2">
			<div class="wrapper3">
				<div class="tab">
					<div class="tab2">
						<button id="UnknownWordsTabButton" class="tablinks" onclick="openTab(event, 'UnknownWordsTab','tablinks')">Unknown Words <sup>[4]</sup></button>
						<button id="LearningWordsTabButton" class="tablinks"  onclick="openTab(event, 'LearningWordsTab','tablinks')">Learning Words <sup>[5]</sup></button>
						<button id="KnownWordsTabButton" class="tablinks"  onclick="openTab(event, 'KnownWordsTab','tablinks')">Known Words <sup>[6]</sup></button>
						<button id="AllWordsTabButton" class="tablinks"  onclick="openTab(event, 'AllWordsTab','tablinks')">All Words <sup>[7]</sup></button>
						<button id="VocabularyTabButton" class="tablinks"  onclick="openTab(event, 'VocabularyTab','tablinks')">Vocabulary <sup>[8]</sup></button>
					</div>
					<div class="tab3">
						<button id="CompareTabButton" class="tablinks"onclick="openTab(event, 'CompareTab','tablinks')">TOPIK <sup>[9]</sup></button>
						<button id="GraphTabButton" class="tablinks" onclick="openTab(event, 'GraphTab','tablinks')">Graph <sup>[0]</sup></button>
						<button id="AchievementsTabButton" class="tablinks" onclick="openTab(event, 'AchievementsTab','tablinks')">Achievements <sup>[-]</sup></button>
						<button id="SentencesTabButton" class="tablinks" onclick="openTab(event, 'SentencesTab','tablinks')">Sentences <sup>[s]</sup></button>
					</div>
				</div>
				<div class="tabContainer">
				
					<div id="LoadingTab" class="tabcontent">
						<div id="LoadingText">Loading data, please wait...</div>
					</div>
					
					<div id="GrammarTab" class="tabcontent">
						<h2>Grammar</h2>
						<small>
						Highlight some text, and detected grammar points will appear below.
						</small>
						<br><br>
						<table id="grammarDataTable1" class="cell-border compact hover" width="100%"></table>
						<br><br>
						<small>Full list:</small><br><br>
						<table id="grammarDataTable2" class="cell-border compact" width="100%"></table>
						<br><br>
						<hr>
						<br>
						<small>
						Note: the results include some false positives, so please use your own discretion.
						</small>
						<br><br>
						<small>
						The list of grammar rules has been collected from Korean Grammar in Use, https://www.howtostudykorean.com/, https://koreanwikiproject.com, and others.
						The list is frequently updated. If you find a grammar rule that is missing, please send an email to <a href="mailto:readerwebsite@gmail.com?subject=Feedback%20for%20Korean%20Reader">readerwebsite@gmail.com</a>
						</small>
						<br><br>
						
					</div>
				
					<div id="LanguageTab" class="tabcontent">
					<h2>Language Settings</h2><hr><br>
					<form>User Interface Language:
							<select id="uiLanguageOption" onchange="ChangeUILanguage();">
								<option selected="selected">English</option>
							</select>	
						</form>
					<br><br>
					
						<form>Dictionary Language:
							<select id="dictLanguageOption" onchange="ChangeDictLanguage();">
								<option>Korean-Korean</option>
								<option selected="selected">English</option>
								<option>Japanese</option>
								<option>Chinese</option>
								<option>French</option>
								<option>Spanish</option>
								<option>German</option>
								<option>Vietnamese</option>
								<option>Nepali</option>
								<option>Mongolian</option>
								<option>Burmese</option>
								<option>Swahili</option>
								<option>Arabic</option>
								<option>Uzbek</option>
								<option>Bahasa Indonesian</option>
								<option>Cambodian</option>
								<option>Thai</option>
								<option>Tetum</option>
								<option>Persian</option>
								<option>Ancient Hebrew</option>
								<option>Hindi</option>
								<option>Modern Greek</option>
								<option>Ancient Greek</option>
								<option>Dutch</option>
								<option>Latin</option>
								<option>Russian</option>
								<option>Romanian</option>
								<option>Swedish</option>
								<option>Albanian</option>
								<option>Ukrainian</option>
								<option>Italian</option>
								<option>Gruziya</option>
								<option>Czech</option>
								<option>Turkish</option>
								<option>Portuguese</option>
								<option>Polish</option>
								<option>Finnish</option>
								<option>Hungarian</option>
							</select>	
						</form>
						<br><br>
						<form>Reader Language:
							<select id="readerLanguageOption" onchange="ChangeReaderLanguage();">
								<option>English</option>
								<option>Chinese</option>
								<option selected="selected">Korean</option>
								<option>Vietnamese</option>
							</select>	
						</form>
					<br>
					</div>
					<div id="DictionaryTab" class="tabcontent">
					<iframe id="naverIframe" src="https://en.dict.naver.com"></iframe>
					<div id="dictionaryOptionsArea">
					<hr>
						<button id="googleTranslateLink" onclick="OpenGoogleTranslate();">Google Translate (shortcut: t)</button>
						<br><br>
						<button id="papagoTranslateLink" onclick="OpenPapagoTranslate();">Papago Translate (shortcut: p)</button>
						<br>
						<br>
						<form>Dictionary Language:
								<select id="dictLanguageOption2" onchange="ChangeDictLanguage2();">
									<option>Korean-Korean</option>
									<option selected="selected">English</option>
									<option>Japanese</option>
									<option>Chinese</option>
									<option>French</option>
									<option>Spanish</option>
									<option>German</option>
									<option>Vietnamese</option>
									<option>Nepali</option>
									<option>Mongolian</option>
									<option>Burmese</option>
									<option>Swahili</option>
									<option>Arabic</option>
									<option>Uzbek</option>
									<option>Bahasa Indonesian</option>
									<option>Cambodian</option>
									<option>Thai</option>
									<option>Tetum</option>
									<option>Persian</option>
									<option>Ancient Hebrew</option>
									<option>Hindi</option>
									<option>Modern Greek</option>
									<option>Ancient Greek</option>
									<option>Dutch</option>
									<option>Latin</option>
									<option>Russian</option>
									<option>Romanian</option>
									<option>Swedish</option>
									<option>Albanian</option>
									<option>Ukrainian</option>
									<option>Italian</option>
									<option>Gruziya</option>
									<option>Czech</option>
									<option>Turkish</option>
									<option>Portuguese</option>
									<option>Polish</option>
									<option>Finnish</option>
									<option>Hungarian</option>
								</select>	
							</form>
						
					</div>
						
					</div>
					<div id="ImagesTab" class="tabcontent">
					<iframe id="imagesIframe" src=""></iframe>
						<div id="imagesOptionsArea">
						<hr>
							<br>
							<button id="googleImagesLink" onclick="OpenGoogleImages();">Google Images (shortcut: o)</button>
							<br><br>
							<button id="yahooImagesLink" onclick="OpenYahooImages();">Yahoo Images (shortcut: y)</button>
							<br>
							
						</div>
						
					</div>
					<div id="StatisticsTab" class="tabcontent"></div>
					<div id="UnknownWordsTab" class="tabcontent">
						<h4>List of unknown words from the current text.</h4>
						<table id="unknownWordsDataTable" class="cell-border compact hover" width="100%"></table>
						<br>
						<table id="unknownWordsDataTableSummary" class="cell-border compact" width="100%"></table>
						
					</div>
					<div id="KnownWordsTab" class="tabcontent">
						<h4>List of known words from the current text.</h4>
						<table id="knownWordsDataTable" class="cell-border compact hover" width="100%"></table>
						<br>
						<table id="knownWordsDataTableSummary" class="cell-border compact" width="100%"></table>
						
					</div>
					<div id="LearningWordsTab" class="tabcontent">
						<h4>List of learning words from the current text.</h4>
						<table id="learningWordsDataTable" class="cell-border compact hover" width="100%"></table>
						<br>
						<table id="learningWordsDataTableSummary" class="cell-border compact" width="100%"></table>
					</div>
					<div id="AllWordsTab" class="tabcontent">
						<h4>List of all words from the current text.</h4>
						<table id="allWordsDataTable" class="cell-border compact hover" width="100%"></table>
						<br>
						<table id="allWordsDataTableSummary" class="cell-border compact" width="100%"></table>
					</div>
					<div id="VocabularyTab" class="tabcontent">
						<h4>A complete list of collected vocabulary items.</h4>
		<p>To delete entries, select rows then press DEL key.</p>
						<form>Filter:
							<select id="filterVocabularyOption" onchange="ChangeVocabularyFilter();">
								<option>Unknown</option>
								<option>Learning</option>
								<option selected="selected">Known</option>
								<option>All</option>
							</select>
						</form>
						<table id="vocabularyDataTable" class="cell-border compact hover" width="100%"></table>
						<br>
						<table id="vocabularyDataTableSummary" class="cell-border compact" width="100%"></table>
						
						<br>
						<br>
						<hr><br>
						<button id="deleteVocabularyCurrentTextButton" onclick="ButtonDeleteCurrentTextSubmit();">
						Clear Vocabulary - Current Text</button><br>Deletes all words that are present in the current text from vocabulary.<br><br>
						<button id="deleteVocabularyAllTextButton" onclick="ButtonDeleteAllSubmit();">Clear Vocabulary - All</button><br>Deletes all words from vocabulary.
						<br>
						
					</div>
					<div id="CompareTab" class="tabcontent">
						<h4>See how one's vocabulary compares with past TOPIK papers.</h4>
						<table id="compareDataTable" class="cell-border compact" width="100%"></table>
					</div>
					
					<div id="GraphTab" class="tabcontent">
						<canvas id="myChart" width="100%" height="100%"></canvas>
						<canvas id="myChart3" width="100%" height="100%"></canvas>
						<br>
						<select id="chartOption" onchange="ChangeChart();">
								<option value="chart1" selected="selected">Cumulative words in current text + known words</option>
								<option value="chart3">Cumulative words in current text + words from TOPIK I and TOPIK II</option>
							</select>
					</div>
					
					<div id="AchievementsTab" class="tabcontent">
						<h4>List of vocabulary milestones.</h4><br>
						<div id="achievementsText">
						</div>
						<br>
						<table id="achievementsDataTable" class="cell-border compact" width="100%"></table>
						<br><br>
						<br>
						<button id="deleteAchievementsButton" onclick="ButtonDeleteAchievementsSubmit();">Clear Achievements</button><br><br>
					</div>
					
					<div id="SentencesTab" class="tabcontent">
						<h4>List of sentences.</h4>
						
						<input checked type="checkbox" id="hideKnownSentences" name="hideKnownSentences" checked onclick="toggleHideKnownSentences();">
						<label for="hideKnownSentences">Hide sentences that are fully known</label>
						<br><br>
						
						<table id="sentencesDataTable" class="SentenceTable cell-border compact hover" width="100%"></table>
						<br>
						<small>n: number of words in the sentence.</small><br>
						<small>?: number of 'learning' or 'unknown' words in the sentence.</small><br>
						<small>%: the percentage of 'learning' or 'unknown' words in the sentence.</small><br>
					</div>
					
					<div id="AboutTab" class="tabcontent">
					<h2>About</h2><hr>
					<h3>Usage Guide</h3>
						Paste a text in the text area. All new words start as <b>unknown</b> (unless you change this in settings). Click to mark them as <b>learning</b>, and again to mark them as <b>known</b>.<br><br>
						<h4>Suggested Interpretations:</h4>
						&nbsp&nbsp&nbsp <b id="unknownCircle">Unknown</b> words may be unknown, difficult, or not important to remember for the timebeing.<br><br>
						&nbsp&nbsp&nbsp <b id="learningCircle">Learning</b> words are words that feel fuzzy. The meaning can be guessed without confidence and perhaps needs to be confirmed with a dictionary lookup.<br><br>
						&nbsp&nbsp&nbsp <b id="knownCircle">Known</b> words are words where the meaning is known instantly and accurately.<br><br>
						<br>
						<br>
						<hr>
						<br>
						
						Data will be saved in the browser's local folder. Logging-in is recommended in order to save your accumulated vocabulary online.   
						<br>
						<br>
						Turn on "Voice" in settings if you would like to listen to text-to-speech.
						<br>
						<br>
						
						Report bugs or give suggestions here: <a href="mailto:readerwebsite@gmail.com?subject=Feedback%20for%20Korean%20Reader">readerwebsite@gmail.com</a><br><br>
						
						If you would like to donate to help with the website hosting costs and to support the development of Korean Reader, please click below:
						<br><br>
						<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
						<input type="hidden" name="cmd" value="_donations" />
						<input type="hidden" name="business" value="GAJYAPJCG8KLS" />
						<input type="hidden" name="item_name" value="Support the development of Korean Reader" />
						<input type="hidden" name="currency_code" value="AUD" />
						<input type="image" src="https://www.paypalobjects.com/en_AU/i/btn/btn_donateCC_LG.gif" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Donate with PayPal button" />
						<img alt="" border="0" src="https://www.paypal.com/en_AU/i/scr/pixel.gif" width="1" height="1" />
						</form>
						<br>
						<hr>
						<br>
						<a href="https://koreanreader.com/privacy.html">Privacy policy</a>
						<br>
					</div>
					
					<div id="LoginTab" class="tabcontent">
						<br>
						Sign in to access your saved vocabulary from other computers.
						<br>
						
						<div class="mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-grid" id="fireLoginArea">

							  <!-- Container for the demo -->
							  <div class="mdl-card mdl-shadow--2dp mdl-cell mdl-cell--12-col mdl-cell--12-col-tablet mdl-cell--12-col-desktop">
								<div class="mdl-card__title mdl-color--light-blue-600 mdl-color-text--white">
								  <h2 class="mdl-card__title-text">Login</h2>
								</div>
								<div class="mdl-card__supporting-text mdl-color-text--grey-600">
								  <p id="fireSigninText">Enter an email and password below and either sign in to an existing account or sign up</p>

								  <input class="mdl-textfield__input" style="display:inline;width:auto;" type="text" id="email" name="email" placeholder="Email"/>
								  &nbsp;&nbsp;&nbsp;
								  <input class="mdl-textfield__input" style="display:inline;width:auto;" type="password" id="password" name="password" placeholder="Password"/>
								  <br/><br/>
								  <button disabled class="mdl-button mdl-js-button mdl-button--raised" id="quickstart-sign-in" name="signin">Sign In</button>
								  &nbsp;&nbsp;&nbsp;
								  <br><br><button class="mdl-button mdl-js-button mdl-button--raised" id="quickstart-sign-up" name="signup">Sign Up</button>
								  <br><br>
								  &nbsp;&nbsp;&nbsp;
								  <button class="mdl-button mdl-js-button mdl-button--raised" id="quickstart-password-reset" name="verify-email">Send Password Reset Email</button>
									<br><br>      
								  <p id="googleSigninText">Sign in with your Google account below.</p>
								  <!-- [START google_button] -->
								  <div class="g-signin2" id="googleSignin" data-onsuccess="onSignIn" data-theme="dark"></div>
								  <!-- [END google_button] -->
								  <br>
								
								
								  <!-- Container where we'll display the user details -->
								  <div class="quickstart-user-details-container">
									Sign-in status: <span id="quickstart-sign-in-status">Unknown</span>
									<!--<div>Firebase auth <code>currentUser</code> object value:</div>
									<pre><code id="quickstart-account-details">null</code></pre>-->
								  </div>
								</div>
							  </div>

							</div>
						
						<br>				
						<br>
						<hr>
						<br>
						<a href="https://koreanreader.com/privacy.html">Privacy policy</a>
						<br>
					</div>
					
					<div id="ImportTab" class="tabcontent">
					<h2>Import</h2><hr>
					<br><br>
					Choose a wordlist to import, or paste words into the text box:
					
						<br><br>
						
						<input type="file" id="importWordlistButton">
						</input> &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp <button id="clearImportButton" onclick="ClearImportSubmit();">Clear</button>
						<br><br>
							<textarea id="importTextArea" style="width: 100%; padding: 10px; height: 200px; 
							display: block; font-family:Sans-serif; font-size:1.2em;">
							</textarea><br><br>
						<form>
							Import to:
							<select id="filterImportOption" onchange="ChangeFilterImport();">
								<option>Unknown</option>
								<option>Learning</option>
								<option selected="selected">Known</option>
							</select>
						</form><br><br><button id="importButton" onclick="ButtonImportSubmit();">Import</button> &nbsp
						<br>
					</div>
					
					<div id="ExportTab" class="tabcontent">
					<h2>Export</h2><hr>
					<br><br>
					<form>Choose a wordlist:
							<select id="filterExportWordlistOption" onchange="ChangeFilterExportWordlist();">
								<option>Vocabulary - All</option>
								<option>Vocabulary - Unknown</option>
								<option selected="selected">Vocabulary - Learning</option>
								<option>Vocabulary - Known</option>
								<option>Current Text - All</option>
								<option>Current Text - Unknown</option>
								<option>Current Text - Learning</option>
								<option>Current Text - Known</option>
							</select>
						</form>
						<br>
						<button id="exportWordlistButton" onclick="ButtonExportWordlistSubmit();">Download</button>&nbsp
					</div>
					
					<div id="OptionsTab" class="tabcontent">
					<h2>Settings</h2><hr>
						<input type="checkbox" id="enableHighlighting" name="enableHighlighting" checked onclick="toggleEnableHighlighting();">
						<label for="enableColours">Enable Highlighting</label>
						<br><br>
						<input type="checkbox" id="enableHighlightingKnown" name="enableHighlightingKnown" checked onclick="ToggleEnableHighlightingKnown();">
						<label for="enableHighlightingKnown">Show Highlighting For Known Words</label>
						<br>
						<br>Unknown Words Highlight Colour:
						<input class="colourInputField" type="textField" pattern="^#+([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$" id="fieldHC1" name="fieldHC1" oninput="HC1OnInput()" onkeydown="if (event.keyCode == 13) { HC1Submit(); return false;}">
						<button id="colorpicker1">Pick</button>
						<button id="HC1SubmitButton" onclick="HC1Submit();">Submit</button>
						<br>
						<br>Learning Words Highlight Colour:&nbsp
						<input class="colourInputField" type="textField" pattern="^#+([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$"  id="fieldHC2" name="fieldHC2" oninput="HC2OnInput()" onkeydown="if(event.keyCode == 13){ HC2Submit(); return false;}">
						<button id="colorpicker2">Pick</button>
						<button id="HC2SubmitButton" onclick="HC2Submit();">Submit</button>
						<br>
						<br>Known Words Highlight Colour:&nbsp&nbsp&nbsp&nbsp
						<input class="colourInputField" type="textField" pattern="^#+([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$" id="fieldHC3" name="fieldHC3" oninput="HC3OnInput()" onkeydown="if (event.keyCode == 13) { HC3Submit(); return false;}">
						<button id="colorpicker3">Pick</button>
						<button id="HC3SubmitButton" onclick="HC3Submit();">Submit</button>
						<br>
						<br>Jump Highlight Colour:&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
						<input class="colourInputField" type="textField" id="fieldHC4" pattern="^#+([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$" name="fieldHC4" oninput="HC4OnInput()" onkeydown="if (event.keyCode == 13) { HC4Submit(); return false;}">
						<button id="colorpicker4">Pick</button>
						<button id="HC4SubmitButton" onclick="HC4Submit();">Submit</button>
						<br><br>
						<hr>
						<br>
						Background Colour:&nbsp&nbsp&nbsp&nbsp
						<input class="colourInputField" type="textField" pattern="^#+([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$" id="fieldHC5" name="fieldHC5" oninput="HC5OnInput()" onkeydown="if (event.keyCode == 13) { HC5Submit(); return false;}">
						<button id="colorpicker5">Pick</button>
						<button id="HC5SubmitButton" onclick="HC5Submit();">Submit</button>
												<br>
						<br>Text Colour:&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
						<input class="colourInputField" type="textField" id="fieldHC6" pattern="^#+([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$" name="fieldHC6" oninput="HC6OnInput()" onkeydown="if (event.keyCode == 13) { HC6Submit(); return false;}">
						<button id="colorpicker6">Pick</button>
						<button id="HC6SubmitButton" onclick="HC6Submit();">Submit</button>
						<br>
						<br>Border Colour:&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp
						<input class="colourInputField" type="textField" id="fieldHC7" pattern="^#+([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$" name="fieldHC7" oninput="HC7OnInput()" onkeydown="if (event.keyCode == 13) { HC7Submit(); return false;}">
						<button id="colorpicker7">Pick</button>
						<button id="HC7SubmitButton" onclick="HC7Submit();">Submit</button>
						<br>
						<br>
						<hr>
						<br>
						<form>Font Size:
							<select id="fontSizeOption" onchange="ChangeFont();">
								<option>0.5</option>
								<option>1</option>
								<option>1.5</option>
								<option>2</option>
								<option>2.5</option>
								<option>3</option>
								<option>3.5</option>
								<option>4</option>
								<option>4.5</option>
								<option>5</option>
								<option>5.5</option>
								<option selected="selected">6</option>
								<option>6.5</option>
								<option>7</option>
								<option>7.5</option>
								<option>8</option>
							</select>
						</form>
						<br>
						<form>Font:
							<select id="fontTypeOption" onchange="ChangeFontType();">
								
							</select>
						</form>
						<br>
						<hr><br>Romanisation:
						<select id="romanisationOption" onchange="ChangeRomanisation();">
							<option selected="selected">Off</option>
							<option>On</option>
						</select>
						</form>&nbsp(For large texts this will take a while).
						<br><br>
						<hr>
						<br>
						<input type="checkbox" id="enableVoice" name="enableVoice" onclick="toggleEnableVoice();">
						<label for="enableVoice">Enable Voice</label>
						<br>
						<br>
						<form>Voice:
							<select id="voiceOption" onchange="ChangeVoice();"></select>&nbsp(Local and browser-specific TTS voices)</form>
						<br>
						<div class="wrapper2">
							<div>Volume:</div>
							<div id="volumeOutput">0</div>
							<div class="slidecontainer">
								<input type="range" min="0" max="10" value="10" class="slider" id="voiceVolumeSlider">
							</div>
						</div>
						<br>
						<div class="wrapper2">
							<div>Speed:</div>
							<div id="speedOutput">0</div>
							<div class="slidecontainer">
								<input type="range" min="1" max="20" value="10" class="slider" id="voiceSpeedSlider">
							</div>
						</div>
						<br>
						<div class="wrapper2">
							<div>Pitch:</div>
							<div id="pitchOutput">0</div>
							<div class="slidecontainer">
								<input type="range" min="0" max="20" value="10" class="slider" id="voicePitchSlider">
							</div>
						</div>
						<br>
						<br>
						<hr>
						<br>
						<form>All new words are initially marked: 
							<select id="startingMarkOption" onchange="ChangeStartingMark();">
								<option selected="selected">Unknown</option>
								<option>Learning</option>
								<option>Known</option>
							</select>
						</form> <br> Changes how words encountered for the first time will be initially marked. Words previously encountered will not be altered - to acheive this consider <b>clearing vocabulary</b>.
						<br><br>
						<hr>
						<br>
						<button id="deleteVocabularyCurrentTextButton" onclick="ButtonDeleteCurrentTextSubmit();">
						Clear Vocabulary - Current Text</button><br>Deletes all words that are present in the current text from vocabulary.<br><br>
						<button id="deleteVocabularyAllTextButton" onclick="ButtonDeleteAllSubmit();">Clear Vocabulary - All</button><br>Deletes all words from vocabulary.
						<br><br>
						<button id="deleteAchievementsButton" onclick="ButtonDeleteAchievementsSubmit();">Clear Achievements</button><br><br><br><br>
					</div>
				</div>
			</div>
		</div>
 <div class="topbar" id="topbar">
		 <div class="empty"></div>
		 <div class="topbarbutton toptabs" onclick="Reset(true)"><b>Clear <sup>[ESC]</sup></b></div>
		 <div class="empty"></div>
		 <div class="logo"><b>Korean Reader</b></div>
		 <div class="empty"></div>
		 <div class="topbarbutton toptabs" id="DictionaryTabButton" onclick="openTab(event, 'DictionaryTab','toptabs')"><b>Dictionary <sup>[1]</sup></b></div>
		 <div class="empty"></div>
		 <div class="topbarbutton toptabs" id="ImagesTabButton" onclick="openTab(event, 'ImagesTab','toptabs')"><b>Images <sup>[2]</sup></b></div>
		 <div class="empty"></div>
		 <div class="topbarbutton toptabs" id="StatisticsTabButton" onclick="openTab(event, 'StatisticsTab','toptabs')"><b>Statistics <sup>[3]</sup></b></div>
		 <div class="empty"></div>
		 <div class="topbarbutton toptabs" id="GrammarTabButton" onclick="openTab(event, 'GrammarTab','toptabs')"><b>Grammar <sup>[g]</sup></b></div>
		 <div class="empty"></div>
		 <div class="topbarbutton toptabs" id="LanguageTabButton" onclick="openTab(event, 'LanguageTab','toptabs')">
		 <img id="languageicon" src="icons/languageicon.png"></img>
		 </div>
		 <div class="empty"></div>
		 <div class="container" onclick="ToggleOpenMenu()">
			<div class="empty"></div>	
			<div class="bar"></div>
			<div class="empty"></div>
			<div class="bar"></div>
			<div class="empty"></div>
			<div class="bar"></div>
			<div class="empty"></div>
		 </div>
		 <div class="empty"></div>
		 
		<div class="menu" id="menu">
			<div class="topbarbutton2 toptabs" id="OptionsTabButton" onclick="openTab(event, 'OptionsTab','toptabs')"><b>Settings</b></div>
			<div class="empty"></div>
			<div class="topbarbutton2 toptabs" id="ImportTabButton" onclick="openTab(event, 'ImportTab','toptabs')"><b>Import</b></div>
			<div class="empty"></div>
			<div class="topbarbutton2 toptabs" id="ExportTabButton" onclick="openTab(event, 'ExportTab','toptabs')"><b>Export</b></div>
			<div class="empty"></div>
			<div class="topbarbutton2 toptabs" id="AboutTabButton" onclick="openTab(event, 'AboutTab','toptabs')"><b>About</b></div>
			<div class="empty"></div>
			<div class="topbarbutton2 toptabs" id="LoginTabButton" onclick="openTab(event, 'LoginTab','toptabs')"><b>Login</b></div>
			<div class="empty"></div>
		</div>
	 </div>
	 


	<script>
	  // Your web app's Firebase configuration
	  var firebaseConfig = {
		apiKey: "AIzaSyDOZA0ojbWAaeWwx0gL7kenlNm94Fo38BY",
		authDomain: "korean-reader.firebaseapp.com",
		databaseURL: "https://korean-reader.firebaseio.com",
		projectId: "korean-reader",
		storageBucket: "korean-reader.appspot.com",
		messagingSenderId: "410562108352",
		appId: "1:410562108352:web:f42d6c8b329d8e54460625"
	  };
	  // Initialize Firebase
	  firebase.initializeApp(firebaseConfig);
	</script>
</body>




</html>
